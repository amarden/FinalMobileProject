//Bootstraps our angular app
angular.module('ehrDashboard', [
    'ngAnimate',
    'ngAria',
    'ngMaterial',
    //'ui-router'
])
.config(["$mdThemingProvider", function ($mdThemingProvider) {
    $mdThemingProvider.theme('default')
      .primaryPalette('blue')
      .accentPalette('green');
}])

//Angular Service used to calculate all of the information we show on the dashboard
angular.module("ehrDashboard")
    .service("Calculate", function () {
        this.getMetrics = function (patient, provider) {
            var metric = {};
            metric.ageAverage = patient
                .map(function (d) { return d.Age })
                .reduce(function (a, b) { return a + b; })
                / patient.length;

            metric.chatAverage = patient
                .map(function (d) { return d.chatCount })
                .reduce(function (a, b) { return a + b; })
                / patient.length;

            metric.imageAverage = patient
                .map(function (d) { return d.imageCount })
                .reduce(function (a, b) { return a + b; })
                / patient.length;

            metric.providerAverage = patient
                .map(function (d) { return d.providerCount })
                .reduce(function (a, b) { return a + b; })
                / patient.length;

            var groupDiag = _.groupBy(patient, "diagnosis");
            metric.topDiagnoses = _.map(groupDiag, function (data, key) {
                return {
                    group:  key.length > 32 ? key.substring(0,32)+"..." : key,
                    number: data.length
                };
            });

            var procDiag = _.groupBy(_.flatten(patient.map(function (d) { return d.procedures; })));
            metric.topProcedures = _.map(procDiag, function (data, key) {
                return {
                    group: key,
                    number: data.length
                };
            });

            var roleGroup = _.groupBy(provider.map(function (d) { return d.Role; }));
            metric.roleCount = _.map(roleGroup, function (data, key) {
                return {
                    group: key.length > 32 ? key.substring(0,32)+"..." : key,
                    number: data.length
                };
            });

            var statusGroup = _.groupBy(patient.map(function (d) { return d.MedicalStatus; }));
            metric.statusCount = _.map(statusGroup, function (data, key) {
                return {
                    group: key,
                    number: data.length
                };
            });

            return metric;
        };
    });
//Data Service that makes the api call to our server to get dashboard data
angular.module("ehrDashboard")
    .service("Data", ["$http", function($http){
        this.getData = function () {
            return $http.get("api/Dashboard")
                .then(function (data) {
                    return data;
                });
        };
    }]);

//Angular controller that governs the business logic on our home page
angular.module("ehrDashboard")
    .controller("MainCtrl", ["Data", "Calculate", function(Data, Calculate) {
        var vm = this;
        vm.data = {};
        vm.groupDiag = "group";
        vm.unit = "number";
        //Call data service and then process data and assign it to view model
        Data.getData().then(function (data) {
            console.log(data.data);
            vm.processed = Calculate.getMetrics(data.data.patients, data.data.providers);
            console.log(vm.processed);
        });
    }]);  
angular.module("ehrDashboard")
.directive("barSpark", function(){
    return {
        restrict : 'E',
        scope: {
            data: '=',
            prop: '=',
            group: '='
        },
        template: '',
        link: function(scope, elem) {
            var drawChart = function(data,prop,group) {
                var color = d3.scale.category10();
                var div = elem[0];
                var w = div.offsetWidth;
                var h = Math.max(div.offsetHeight, 280);
                var xScale = d3.scale.linear().domain([0, Math.ceil(d3.max(data, function(d) { return d[prop]; }))]).range([0,w/1.6]);
                var yScale = d3.scale.ordinal().domain(data.map(function(d) { return d[group]; })).rangeRoundBands([10,h-50], 0.2);
                var svg = d3.select(div).append("svg").attr("height",h).attr("width",w);
                var graph = svg.append("g").attr("transform","translate(0,20)");
                var g = graph.selectAll("g").data(data)
                    .enter().append("g")
                    .attr("transform", function(d) { return "translate(30,"+yScale(d[group])+")"; });

                var xAxisNum = d3.svg.axis()
                    .scale(xScale)
                    .orient("bottom");

                svg.append("g")
                    .attr("class","x axis")
                    .attr("transform","translate(30," +(h - 25)+")")
                    .call(xAxisNum);

                g.append("rect")
                    .attr("class","spark")
                    .attr("width", function(d) { return xScale(d[prop])})
                    .attr("height", yScale.rangeBand())
                    .style("fill", "steelblue")
                    .style("stroke", "#386890")
                    .style("stroke-width",2);

                g.append("text")
                    .attr("dy", yScale.rangeBand()/2)
                    .attr("dx", 4)
                    .style("fill","white")
                    .style("font-size",12)
                    .style("text-anchor","start")
                    .text(function(d) { return d[group]; });

                g.append("text")
                    .attr("dy", yScale.rangeBand()/2)
                    .style("font-size",15)
                    .style("fill","white")
                    .attr("dx", function(d) { return (xScale(d[prop])-5); })
                    .style("text-anchor","end")
                    .text(function(d) { return d[prop]+"%"; });

                //line chart
                var parseDate = d3.time.format("%m/%d/%Y").parse;
                var xScaleTime = d3.time.scale().range([w/1.5,w-100]).domain(d3.extent(data[0].time, function(d) { return parseDate(d.quarter);}));
                var xAxis = d3.svg.axis()
                    .scale(xScaleTime)
                    .ticks(d3.time.month, 3)
                    .tickFormat(d3.time.format("%b"))
                    .orient("bottom");

                var yTimes = {};

                var line = d3.svg.line()
                    .interpolate("linear")
                    .x(function(d) { return xScaleTime(parseDate(d.quarter)); })
                    .y(function(d) { return yTimes[d.type](d[prop]); });

                g.append("path")
                    .attr("fill","none")
                    .attr("stroke","steelblue")
                    .attr("stroke-width",2)
                    .datum(function(d) {
                        if (!yTimes[d.type]) {
                            yTimes[d.type] = d3.scale.linear()
                                .range([yScale.rangeBand(),10])
                                .domain([-10, 10]);
                                //.domain([(d3.min(d.time, function(d) { return d[prop];})-1), (d3.max(d.time, function(d) { return d[prop];})+1)]);
                        }
                        return d.time;
                    })
                    .attr("d",line);

                g.append("line")
                    .style("stroke-dasharray", ("3", "3"))
                    .style("stroke", "black")
                    .attr("x1", xScaleTime.range()[0])
                    .attr("x2", xScaleTime.range()[1])
                    .attr("y1", function(d) { return yTimes[d.type](0)})
                    .attr("y2", function(d) { return yTimes[d.type](0)});

                g.append("text")
                    .attr("transform", function(d) {
                        return "translate(" + (xScaleTime.range()[1] + 16) + "," + (yTimes[d.type](0) + 5) + ")";
                    })
                    .attr("text-anchor", "middle")
                    .style("font-size", "13px")
                    .text("0%");

                g.selectAll("circle")
                    .data(function(d) { return d.time; })
                .enter().append("circle")
                    .attr("cx", function(d) {
                        return xScaleTime(parseDate(d.quarter));
                    })
                    .attr("cy", function(d) { return yTimes[d.type](d[prop]); })
                    .attr("r", "3px")
                    .attr("fill", "#386890")
                    .attr("stroke", "none");

                svg.append("g")
                    .attr("class","x axis")
                    .attr("transform","translate(30," +(h - 25)+")")
                    .call(xAxis);

                svg.append("text")
                    .attr("y", 15)
                    .attr("x", 30+(w/1.6)/2)
                    .style("text-anchor","middle")
                    .text("Prevalence of Metric - Current Quarter");

                svg.append("text")
                    .attr("y", 15)
                    .style("text-anchor","middle")
                    .attr("x",5+(w/1.6)+((w-(w/1.6))/2))
                    .text("Percent Change From Baseline");
            };

            scope.$watch('data', function() {
                if (scope.data){
                    drawChart(scope.data, scope.prop, scope.group);
                }
            }), true;
        }
    };
});

angular.module("ehrDashboard")
.directive("bubbleChart", function(){
    return {
        restrict : 'E',
        scope: {
            data: '='
        },
        template: '',
        link: function(scope, elem) {
            var drawChart = function(data) {
                var div = elem[0];
                var w = div.offsetWidth;
                var h = div.offsetHeight;
                var svg = d3.select(div).append("svg").attr("height",h).attr("width",w);
                var graph = svg.append("g").attr("transform","translate(0,20)");
                //line chart
                var xScaleTime = d3.time.scale().range([60,w-50]).domain(d3.extent(data, function(d) { return parseDate(d.date); }));
                var xAxis = d3.svg.axis()
                    .scale(xScaleTime)
                    .ticks(d3.time.month, 3)
                    .tickFormat(d3.time.format("%b"))
                    .orient("bottom");

                var yScaleTime = d3.scale.linear().range([h-50,0])
                    .domain([d3.min(types, function(d) { return d3.min(d.values, function(x) { return x.value; }); }),
                        d3.max(types, function(d) { return d3.max(d.values, function(x) { return x.value; }); })]);
                var yAxis = d3.svg.axis()
                    .scale(yScaleTime)
                    .orient("left");

                var line = d3.svg.line()
                    .interpolate("basis")
                    .x(function(d) { return xScaleTime(parseDate(d.date)); })
                    .y(function(d) { return yScaleTime(d.value); });

                graph.append("g")
                    .attr("class","x-axis")
                    .attr("transform","translate(0,"+(h-60)+")")
                    .call(xAxis);

                svg.append("g")
                    .attr("transform","translate(60,0)")
                    .attr("class", "x-axis")
                    .call(yAxis)
                    .append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 6)
                    .attr("dy", ".71em")
                    .style("text-anchor", "end")
                    .text("USD $");

                var type = svg.selectAll("g.multi")
                    .data(types)
                    .enter().append("g")
                    .attr("class","multi");

                type.append("path")
                    .attr("class", "line")
                    .attr("d", function(d) { return line(d.values); })
                    .style("stroke", function(d) { return color(d.name); })
                    .attr("fill","none");

                type.append("text")
                    .datum(function(d) { return {name: d.name, value: d.values[d.values.length - 1]}; })
                    .attr("transform", function(d) { return "translate(" + (xScaleTime(parseDate(d.value.date))-50) + "," + (yScaleTime(d.value.value)-10) + ")"; })
                    .attr("x", 3)
                    .attr("dy", ".35em")
                    .style("font-size",11)
                    .text(function(d) { return d.name === 'totalMoney' ? "Money Recovered" : "Money Outstanding"; });
            };

            scope.$watch('data', function() {
                if (scope.data){
                    drawChart(scope.data);
                }
            }, true);
        }
    };
});

angular.module('ehrDashboard')
    .factory("ChartOptions", function () {
    return {
        defaults: [
        { 'propName': 'margin', 'defaultValue': { "top": 0, "left": 0, "right": 0, "bottom": 0 } },
        { 'propName': 'colorScale', 'defaultValue': d3.scale.category10() },
        { 'propName': 'drawLegend', 'defaultValue': false },
        { 'propName': 'drawYAxis', 'defaultValue': false },
        { 'propName': 'tooltip', 'defaultValue': false },
        { 'propName': 'dateFormat', 'defaultValue': d3.time.format("%m/%d/%Y") },
        { 'propName': 'tickFormat', 'defaultValue': d3.time.month },
        { 'propName': 'tickSpacing', 'defaultValue': 1 },
        { 'propName': 'dateAxisFormat', 'defaultValue': d3.time.format("%m-%y") },
        { 'propName': 'timeUnit', 'defaultValue': 'month' },
        { 'propName': 'min', 'defaultValue': 'min' },
        { 'propName': 'max', 'defaultValue': 'max' },
        { 'propName': 'yScaleLabel', 'defaultValue': '' },
        { 'propName': 'title', 'defaultValue': '' },
        { 'propName': 'onClick', 'defaultValue': '' },
        ],
        generateOptions: function (options) {
            var controls = options ? options : {};
            this.defaults.forEach(function (d) {
                if (!controls.hasOwnProperty(d.propName)) {
                    controls[d.propName] = d.defaultValue;
                }
            });
            return controls;
        }
    };
});

//Adds to array prototype to add filter and aggregate options for dashboard

Array.prototype.groupByAndSum = function (groupBy, unit) {
    var group = _.groupBy(this, groupBy);
    return _.map(group, function (g, key) {
        return {
            group: key,
            unit: pmdCalcHelpers.sum(g, unit)
        };
    });
};

angular.module("ehrDashboard")
    .directive("barChart", ["BarOptions", function (BarOptions) {
        return {
            restrict: 'E',
            scope: {
                data: '=',
                options: '=',
                group: '=',
                unit: '=',
            },
            link: function (scope, elem) {
                var config = BarOptions.generateOptions(scope.options);
                config.margin.left = 250;
                var w, h;
                var y = scope.group || 'group';
                var x = scope.unit || 'unit';
                var drawn = false;
                var barTip;
                var svg;

                var createChart = function () {
                    w = config.width ? config.width : elem[0].offsetWidth;
                    h = config.height ? config.height : elem[0].offsetHeight;
                    h = 185;
                    svg = d3.select(elem[0]).append("svg")
                        .attr("width", w).attr("height", h);

                    svg.append("text")
                       .attr("class", "title")
                       .attr("dx", w / 2)
                       .attr("dy", 10)
                       .style("font-size", 10)
                       .attr("text-anchor", "middle")
                       .text(config.chartTitle);

                    svg.append("g")
                        .attr("class", "chart")
                        .attr("transform", "translate(" + config.margin.left + "," + config.margin.top + ")");

                    svg.select("g.chart").append("g")
                        .attr("class", "axis")
                        .attr("transform", "translate(0,5)");

                    if (config.tooltip) {
                        createToolTip();
                    }

                    updateChart(scope.data);
                };

                var createToolTip = function () {
                    barTip = d3.tip().attr('class', 'd3-tip')
                        .offset(function () {
                            return [0, 2];
                        })
                        .direction('e')
                        .style("text-align", "center")
                        .html(function (d) {
                            return Math.round(d[x] * 100) / 100;
                        });
                    svg.call(barTip);
                };

                var updateChart = function (data) {
                    data.sort(function (a, b) {
                        return a[y] < b[y] ? 1  : -1;
                    });

                    var yScaleHeight = Math.max(h - config.margin.top, data.length * 13);
                    if (data.length * 13 > h - config.margin.top) {
                        svg.attr("height", (data.length * 13 + config.margin.top));
                    } else {
                        svg.attr("height", h);
                    }
                    d3.select(elem[0]).style("height", h + "px");

                    var xMax = config.maxX || d3.max(data.filter(function (d) { return d[x] !== Infinity; }), function (d) { return d[x]; });
                    var xScale = d3.scale.linear()
                        .domain([0, xMax])
                        .range([0, (w - config.margin.right - config.margin.left)]);

                    var yScale = d3.scale.ordinal()
                        .domain(data.map(function (d) { return d[y]; }))
                        .rangeBands([10, yScaleHeight - config.margin.bottom], 0.05);

                    var barHeight = yScale.rangeBand();

                    var xAxis = d3.svg.axis()
                       .scale(xScale)
                       .orient("top");

                    if (config.tickNumbers) {
                        xAxis.ticks(5);
                    }

                    svg.select("g.axis")
                        .transition().duration(500)
                        .call(xAxis);

                    var barContainer = svg.select("g.chart").selectAll("g.bars")
                        .data(data, function (d) { return d[y]; });

                    barContainer.exit()
                        .transition().duration(500)
                        .delay(function (d, i) { return i * 20; })
                        .attr("transform", "translate(0," + (h + 200) + ")")
                        .remove();

                    var barEnter = barContainer.enter().append("g")
                        .attr("class", "bars")
                        .attr("transform", function (d) {
                            return "translate(0," + yScale(d[y]) + ")";
                        })
                        .style("opacity", 0);

                    barEnter.append("rect")
                        .attr("class", "bar")
                        .attr("y", 0)
                        .attr("fill", function (d) {
                            return config.colorBy === 'none' ? config.color :
                                color(d[config.colorBy]);
                        })
                        .on("mouseover", barTip.show)
                        .on("mouseout", barTip.hide);

                    barEnter.append("text")
                        .attr("class", "bar-label")
                        .attr("text-anchor", "end")
                        .attr("font-size", "12")
                        .attr("dx", -1)
                        .attr("dy", ".35em");

                    barContainer.select("rect")
                        .transition().duration(500)
                        .attr("width", function (d) {
                            return d[x] === Infinity ? 0 : xScale(d[x]);
                        })
                        .attr("height", barHeight);

                    barContainer.select("text.bar-label")
                        .transition().duration(500)
                        .attr("y", barHeight / 2)
                        .text(function (d) {
                            return d[y];
                        });

                    barContainer.transition().duration(1000)
                        .style("opacity", 1)
                        .attr("transform", function (d) { return "translate(0," + yScale(d[y]) + ")"; });
                };

                scope.$watch('data', function () {
                    if (scope.data) {
                        if (!drawn) {
                            setTimeout(function () { createChart(); }, 250);
                        } else {
                            updateChart(scope.data);
                        }
                        drawn = true;
                    }
                }, true);
            }
        };
}]);

angular.module("ehrDashboard")
    .factory("BarOptions", function () {
        return {
            defaults: [
            { 'propName': 'margin', 'defaultValue': { "top": 50, "left": 100, "right": 150, "bottom": 50 } },
            { 'propName': 'chartTitle', 'defaultValue': ""},
            { 'propName': 'color', 'defaultValue': 'steelblue' },
            { 'propName': 'colorBy', 'defaultValue': 'none' },
            { 'propName': 'tooltip', 'defaultValue': true },
            { 'propName': 'fitToHeight', 'defaultValue': true },
            { 'propName': 'tickNumbers', 'defaultValue': null },
            { 'propName': 'width', 'defaultValue': null },
            { 'propName': 'height', 'defaultValue': null },
            { 'propName': 'maxX', 'defaultValue': null }
            ],
            generateOptions: function (options) {
                var controls = options ? options : {};
                this.defaults.forEach(function (d) {
                    if (!controls.hasOwnProperty(d.propName)) {
                        controls[d.propName] = d.defaultValue;
                    }
                });
                return controls;
            }
        };
});

angular.module('ehrDashboard')
    .directive("groupBar", ["$location", function ($location) {
    return {
        restrict: 'E',
        templateNameSpace: 'svg',
        link: function (scope, elem) {
            var createChart = function (data) {
                var margin = { top: 10, right: 20, bottom: 80, left: 40 };
                var width = elem[0].offsetWidth - margin.right - margin.left;
                var height = elem[0].offsetHeight - margin.top - margin.bottom;

                console.log(width, height);
                var x0 = d3.scale.ordinal()
                    .rangeRoundBands([0, width], 0.1);

                var x1 = d3.scale.ordinal();

                var y = d3.scale.linear()
                    .range([height, 0]);

                var color = d3.scale.ordinal()
                    .range(["red", "blue", "purple"])
                    .domain(["Overhead", "Billable", "Proposal"]);

                var xAxis = d3.svg.axis()
                    .scale(x0)
                    .orient("bottom");

                var yAxis = d3.svg.axis()
                    .scale(y)
                    .orient("left")
                    .tickFormat(d3.format(".2s"));

                var svg = d3.select(elem[0]).append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                  .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
                var options = _.uniq(_.pluck(data, 'chargeType')).sort();
                var groupByPerson = _.groupBy(data, 'employee');
                var groupedData = _.map(groupByPerson, function (d, key) {
                    return {
                        name: key,
                        empId: d[0].empId,
                        data: d
                    };
                });

                x0.domain(groupedData.map(function (d) { return d.name; }));
                x1.domain(options).rangeRoundBands([0, x0.rangeBand()]);
                y.domain([0, d3.max(groupedData, function (d) { return d3.max(d.data, function (d) { return d.hours; }); })]);

                svg.append("g")
                  .attr("class", "x axis")
                  .attr("transform", "translate(0," + height + ")")
                  .call(xAxis);

                svg.append("g")
                    .attr("class", "y axis")
                    .call(yAxis)
                  .append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 6)
                    .attr("dy", ".71em")
                    .style("text-anchor", "end")
                    .text("Hours");

                var state = svg.selectAll(".state")
                    .data(groupedData)
                  .enter().append("g")
                    .attr("class", "g")
                    .attr("transform", function (d) { return "translate(" + x0(d.name) + ",0)"; })
                    .on("click", function (d) {
                        console.log(d.empId, d);
                        scope.$apply(function () {
                            $location.path("timesheet/" + d.empId);
                        });
                    });

                state.selectAll("rect")
                    .data(function (d) { return d.data; })
                  .enter().append("rect")
                    .attr("width", x1.rangeBand())
                    .attr("x", function (d) { return x1(d.chargeType); })
                    .attr("y", function (d) { return y(d.hours); })
                    .attr("height", function (d) { return height - y(d.hours); })
                    .style("fill", function (d) { return color(d.chargeType); });

                var legend = svg.selectAll(".legend")
                    .data(options.slice().reverse())
                  .enter().append("g")
                    .attr("class", "legend")
                    .attr("transform", function (d, i) { return "translate(0," + i * 20 + ")"; });

                legend.append("rect")
                    .attr("x", width - 18)
                    .attr("width", 18)
                    .attr("height", 18)
                    .style("fill", color);

                legend.append("text")
                    .attr("x", width - 24)
                    .attr("y", 9)
                    .attr("dy", ".35em")
                    .style("text-anchor", "end")
                    .text(function (d) { return d; });
            };

            scope.$watch('billingData', function () {
                if (scope.billingData) {
                    setTimeout(function () { createChart(scope.billingData); }, 100);
                }
            }, true);
        }
    };
}]);

angular.module('ehrDashboard')
    .directive("stackBarChart", ["$timeout", "ChartOptions", function ($timeout, ChartOptions) {
        return {
            restrict: 'E',
            scope: {
                data: '=',
                options: '=',
                date: '=',
                group: '=',
                unit: '='
            },
            link: function (scope, elem) {
                var stackBar = function () {
                    var svg, chart, width, height, yAxis;
                    var config = ChartOptions.generateOptions(scope.options);
                    var color = config.colorScale;
                    var toolTip;
                    //var formatDate = config.dateFormat;
                    var unit = scope.unit;
                    var date = scope.date;
                    var group = scope.group;
                    var stack = d3.layout.stack()
                       .values(function (d) { return d.values; })
                       .x(function (d) { return d.realDate; })
                       .y(function (d) { return d.unit; });

                    var margin = config.margin;

                    var drawYAxis = function () {
                        chart.append("g")
                            .attr("class", "y axis")
                            .attr("transform", "translate(50,0)")
                            .call(yAxis)
                          .append("text")
                            .attr("transform", "rotate(-90)")
                            .attr("y", -45)
                            .attr("dx", -(height - 100) / 2)
                            .attr("dy", ".71em")
                            .style("text-anchor", "middle")
                            .text(config.yScaleLabel);
                    };

                    var drawLegend = function (data) {
                        //Legend
                        var onlyValues = data.filter(function (d) { return d.unit !== 0; });
                        var legend = chart.selectAll(".legend")
                            .data(_.uniq(_.pluck(onlyValues, 'group')))
                          .enter().append("g")
                            .attr("class", "legend")
                            .attr("transform", function (d, i) { return "translate(0," + i * 20 + ")"; });

                        legend.append("rect")
                            .attr("x", width - 72)
                            .attr("width", 18)
                            .attr("height", 18)
                            .style("fill", color);

                        legend.append("text")
                            .attr("x", width - 96)
                            .attr("y", 9)
                            .attr("dy", ".35em")
                            .style("text-anchor", "end")
                            .text(function (d) { return d; });
                    };

                    var createToolTip = function () {
                        toolTip = d3.tip().attr('class', 'd3-tip')
                            .offset(function () {
                                return [config.toolTipAdjustTop, 0];
                            })
                            .direction('e')
                            .style("text-align", "center")
                            .html(function (d) {
                                return d.group + "<br /> " + d.unit + " " + config.toolTipUnit;
                            });
                        svg.call(toolTip);
                    };

                    var createChart = function (data) {
                        data = data.map(function (d) {
                            return {
                                unit: d[unit],
                                date: d[date],
                                group: d[group],
                                realDate: new moment(d[date])._d
                            };
                        });

                        var dates = _.uniq(data.map(function (d) { return d.date; }));
                        var categories = _.uniq(data.map(function (d) { return d.group; }));

                        dates.forEach(function (date) {
                            categories.forEach(function (cat) {
                                var match = _.find(data, function (d) { return d.date === date && d.group === cat; });
                                if (!match) {
                                    var dummy = { unit: 0, group: cat, realDate: new moment(date)._d, date: date };
                                    data.push(dummy);
                                }
                            });
                        });

                        data = _.sortBy(data, function (d) { return d.realDate; });
                        data = _.sortBy(data, function (d) { return d.group; });

                        var groups = d3.nest()
                            .key(function (d) { return d.group; }).entries(data);

                        var days = stack(groups);
                        width = elem[0].offsetWidth;
                        height = config.height ? config.height : elem[0].offsetHeight;
                        var chartHeight = height - margin.bottom;

                        svg = d3.select(elem[0]).append("svg")
                            .attr("class", "svg-chart")
                            .attr("width", width).attr("height", height);

                        chart = svg.append("g")
                            .attr("class", "chart")
                            .attr("transform", "translate(0,0)")
                            .on("mouseover", function () {
                                d3.select(this).selectAll(".to-show")
                                       .transition().duration(500)
                                       .style("opacity", 1);
                            })
                            .on("mouseout", function () {
                                d3.select(this).selectAll(".to-show")
                                    .transition().duration(500)
                                    .style("opacity", 0);
                            });

                        chart.append("text")
                            .attr("class", "title to-show")
                            .attr("dx", width / 2)
                            .attr("dy", margin.top - 10)
                            .style("font-size", 10)
                            .attr("text-anchor", "middle")
                            .text(config.titleText)
                            .style("opacity", 0);

                        var xScale = d3.scale.ordinal()
                            .rangeRoundBands([margin.left, width - margin.right], 0.08)
                            .domain(_.uniq(data.map(function (d) { return d.realDate; })));

                        var min = typeof (config.min) === 'number' ? config.min :
                            d3.min(data, function (d) { return d.unit; });

                        var totals = _.map(_.groupBy(data, 'date'),
                            function (data) { return _.reduce(data, function (m, x) { return m + x.unit; }, 0); });

                        var max = typeof (config.max) === 'number' ? config.max :
                            d3.max(totals, function (d) { return d; });

                        var yScale = d3.scale.linear()
                            .range([chartHeight, margin.top])
                            .domain([min, max]);

                        var xAxis = d3.svg.axis()
                            .scale(xScale)
                            .tickFormat(config.dateAxisFormat)
                            .orient("bottom");

                        yAxis = d3.svg.axis()
                            .scale(yScale)
                            .orient("left");

                        chart.append("g")
                            .attr("class", "x axis to-show")
                            .style("opacity", 0)
                            .attr("transform", "translate(0," + (height - margin.bottom - 5) + ")")
                            .call(xAxis);

                        // Add a group for each cause.
                        var barCont = chart.selectAll("g.day")
                            .data(days)
                          .enter().append("svg:g")
                            .attr("class", "day")
                            .style("fill", function (d) { return color(d.key); })
                            .style("stroke", function (d) { return d3.rgb(color(d.key)).darker(); });

                        // Add a rect for each date.
                        barCont.selectAll("rect")
                            .data(function (d) { return d.values; })
                          .enter().append("svg:rect")
                            .attr("x", function (d) { return xScale(d.realDate); })
                            .attr("y", function (d) { return yScale(d.y) - ((chartHeight) - yScale(d.y0)); })
                            .attr("height", function (d) { return (chartHeight) - yScale(d.y); })
                            .attr("width", xScale.rangeBand())
                            .on('mouseover', function (d) {
                                toolTip.show(d);
                            })
                            .on('mouseout', function (d) {
                                toolTip.hide(d);
                            });

                        createToolTip();
                        if (config.drawYAxis) {
                            drawYAxis(data);
                        }
                        if (config.drawLegend) {
                            drawLegend(data);
                        }
                    };

                    scope.$watch('data', function () {
                        if (scope.data) {
                            setTimeout(function () { createChart(scope.data); }, 250);
                        }
                    }, true);
                };
                $timeout(stackBar, 0);
            }
        };
    }]);

angular.module("ehrDashboard")
    .directive("vBarChart", ["BarOptions", function (BarOptions) {
        return {
            restrict: 'E',
            scope: {
                data: '=',
                options: '=',
                group: '=',
                unit: '=',
            },
            link: function (scope, elem) {
                var config = BarOptions.generateOptions(scope.options);
                var w, h;
                var y = scope.group || 'group';
                var x = scope.unit || 'unit';
                var drawn = false;
                var barTip;
                var svg;

                var createChart = function () {
                    w = config.width ? config.width : elem[0].offsetWidth;
                    h = config.height ? config.height : elem[0].offsetHeight;

                    svg = d3.select(elem[0]).append("svg")
                        .attr("width", w).attr("height", h);

                    svg.append("text")
                       .attr("class", "title")
                       .attr("dx", w / 2)
                       .attr("dy", 10)
                       .style("font-size", 10)
                       .attr("text-anchor", "middle")
                       .text(config.chartTitle);

                    svg.append("g")
                        .attr("class", "chart")
                        .attr("transform", "translate(" + config.margin.left + "," + config.margin.top + ")");

                    svg.select("g.chart").append("g")
                        .attr("class", "x-axis")
                        .attr("transform", "translate(0,5)");

                    if (config.tooltip) {
                        createToolTip();
                    }

                    updateChart(scope.data);
                };

                var createToolTip = function () {
                    barTip = d3.tip().attr('class', 'd3-tip')
                        .offset(function () {
                            return [0, 2];
                        })
                        .direction('e')
                        .style("text-align", "center")
                        .html(function (d) {
                            return Math.round(d[x] * 100) / 100;
                        });
                    svg.call(barTip);
                };

                var updateChart = function (data) {
                    data.sort(function (a, b) {
                        return a[y] < b[y] ? 1 : -1;
                    });

                    var yScaleHeight = Math.max(h - config.margin.top, data.length * 13);

                    if (data.length * 13 > h - config.margin.top) {
                        svg.attr("height", (data.length * 13 + config.margin.top));
                    }
                    else {
                        svg.attr("height", h);
                    }
                    d3.select(elem[0]).style("height", h + "px");

                    var xMax = config.maxX || d3.max(data.filter(function (d) { return d[x] !== Infinity; }), function (d) { return d[x]; });
                    var xScale = d3.scale.linear()
                        .domain([0, xMax])
                        .range([0, (w - config.margin.right - config.margin.left)]);

                    var yScale = d3.scale.ordinal()
                        .domain(data.map(function (d) { return d[y]; }))
                        .rangeBands([10, yScaleHeight - config.margin.bottom], 0.05);

                    var barHeight = yScale.rangeBand();

                    var xAxis = d3.svg.axis()
                       .scale(xScale)
                       .orient("top");

                    if (config.tickNumbers) {
                        xAxis.ticks(5);
                    }

                    //svg.select("g.x-axis")
                    //    .transition().duration(500)
                    //    .call(xAxis);

                    console.log(data, y, x);

                    var barContainer = svg.select("g.chart").selectAll("g.bars")
                        .data(data, function (d) { return d[y]; });

                    barContainer.exit()
                        .transition().duration(500)
                        .delay(function (d, i) { return i * 20; })
                        .attr("transform", "translate(0," + (h + 200) + ")")
                        .remove();

                    var barEnter = barContainer.enter().append("g")
                        .attr("class", "bars")
                        .attr("transform", function (d) {
                            return "translate(0," + yScale(d[y]) + ")";
                        })
                        .style("opacity", 0);

                    barEnter.append("rect")
                        .attr("class", "bar")
                        .attr("y", 0)
                        .attr("fill", function (d) {
                            return config.colorBy === 'none' ? config.color :
                                color(d[config.colorBy]);
                        })
                        .on("mouseover", barTip.show)
                        .on("mouseout", barTip.hide);

                    barEnter.append("text")
                        .attr("class", "bar-label")
                        .attr("text-anchor", "end")
                        .attr("font-size", "12")
                        .attr("dx", -1)
                        .attr("dy", ".35em");

                    barContainer.select("rect")
                        .transition().duration(500)
                        .attr("width", function (d) {
                            return d[x] === Infinity ? 0 : xScale(d[x]);
                        })
                        .attr("height", barHeight);

                    barContainer.select("text.bar-label")
                        .transition().duration(500)
                        .attr("y", barHeight / 2)
                        .text(function (d) {
                            return d[y];
                        });

                    barContainer.transition().duration(1000)
                        .style("opacity", 1)
                        .attr("transform", function (d) { return "translate(0," + yScale(d[y]) + ")"; });
                };

                scope.$watch('data', function () {
                    if (scope.data) {
                        if (!drawn) {
                            setTimeout(function () { createChart(); }, 250);
                        } else {
                            updateChart(scope.data);
                        }
                        drawn = true;
                    }
                }, true);
            }
        };
    }]);

angular.module('ehrDashboard')
    .directive("bulletChart", ["$timeout", function ($timeout) {
        return {
            restrict: 'E',
            scope: {
                data: '=',
                outerProp: '=',
                innerProp: '=',
                groupBy: '=',
                filter: '='
            },
            link: function (scope, elem) {
                var bulletChart = function () {
                    // directive variables
                    var svg, yScale, chart, xScale;
                    var outerProp = "staffed";
                    var innerProp = "charge";
                    var group = "project";
                    var drawn = false;
                    var monthsBack = 0;

                    var setTitle = function () {
                        var myDate = new moment().subtract("month", monthsBack).format('MMMM');
                        chart.select(".title")
                            .text(myDate + " Project Variance");
                    };

                    var createChart = function () {
                        // Set up the left side margin:
                        var margin = { top: 15, right: 50, bottom: 20, left: 40 };
                        var w = elem[0].offsetWidth;
                        var h = elem[0].offsetHeight;
                        svg = d3.select(elem[0])
                            .append("svg")
                            .attr("height", h)
                            .attr("width", w)
                            .on("mouseover", function () {
                                d3.select(this).selectAll(".to-show")
                                        .transition().duration(500)
                                        .style("opacity", 1);
                            })
                            .on("mouseout", function () {
                                d3.select(this).selectAll(".to-show")
                                    .transition().duration(500)
                                    .style("opacity", 0);
                            });

                        chart = svg.append("g")
                            .attr("transform", "translate(" + margin.left + "," + (0) + ")");

                        chart.append("text")
                            .attr("class", "backward to-show")
                            .attr("dx", -10)
                            .attr("dy", margin.top - 5)
                            .style("font-size", 10)
                            .attr("text-anchor", "middle")
                            .text('<')
                            .style("cursor", "pointer")
                            .on("click", function () {
                                scope.filter('backward');
                                monthsBack++;
                                scope.$apply();
                            })
                            .style("opacity", 0);

                        chart.append("text")
                           .attr("class", "forward to-show")
                           .attr("dx", w - margin.right - 5)
                           .attr("dy", margin.top - 5)
                           .style("font-size", 10)
                           .attr("text-anchor", "middle")
                           .text('>')
                           .style("cursor", "pointer")
                           .on("click", function () {
                               scope.filter('forward');
                               monthsBack--;
                               scope.$apply();
                           })
                           .style("opacity", 0);

                        chart.append("text")
                            .attr("class", "title to-show")
                            .attr("dx", (w - margin.right) / 2)
                            .attr("dy", margin.top - 5)
                            .style("font-size", 10)
                            .attr("text-anchor", "middle")
                            .style("opacity", 0);

                        // Set up the scales:
                        xScale = d3.scale.linear()
                            .range([0, w - margin.right]);

                        yScale = d3.scale.ordinal()
                            .rangeBands([margin.top, h - margin.bottom], 0.1);

                        //Set up axes:
                        chart.append("g")
                            .attr("class", "x axis to-show")
                            .attr("transform", "translate(0, " + (h - margin.bottom - 5) + ")")
                            .style("opacity", 0)
                            .append("text")
                            .style("font-size", "8")
                            .style("text-anchor", "middle")
                            .attr("dx", (w - margin.right) / 2)
                            .attr("dy", 25)
                            .text("Hours");
                        drawn = true;
                        updateChart(scope.data);
                    };

                    var updateChart = function (data) {
                        setTitle();
                        chart.select(".forward")
                            .style("display", function () { return monthsBack >= 1 ? "block" : "none"; });
                        chart.select(".backward")
                            .style("display", function () { return monthsBack >= 3 ? "none" : "block"; });

                        //Set up the SVG:
                        var maxX = d3.max(data, function (d) { return Math.max(d[innerProp], d[outerProp]); }) * 1.10;
                        xScale.domain([0, maxX]);

                        var xAxis = d3.svg.axis()
                           .scale(xScale)
                           .ticks(5)
                           .orient("bottom");

                        chart.select('.x')
                            .call(xAxis);

                        yScale.domain(data.map(function (d) { return d[group]; }));

                        var innerBarHeight = yScale.rangeBand() * 0.6;
                        // Data binding:
                        var barsCont = chart.selectAll("g.bars")
                            .data(data, function (d) { return d[group]; });

                        barsCont.transition().duration(500)
                            .attr("transform", function (d) { return "translate(0, " + yScale(d[group]) + ")"; });

                        barsCont.select("rect.outer-bar")
                            .attr("height", yScale.rangeBand())
                            .transition().duration(500)
                            .attr("width", function (d) { return xScale(d[outerProp]); });

                        barsCont.select("rect.inner-bar")
                           .attr("height", innerBarHeight)
                           .attr("y", (yScale.rangeBand() - innerBarHeight) / 2)
                           .transition().duration(500)
                           .attr("width", function (d) { return xScale(d[innerProp]); });

                        barsCont.select("text")
                          .attr("dy", yScale.rangeBand() / 2);
                        // Create container per observation:;
                        var barEnter = barsCont.enter().append("g")
                            .attr("class", "bars")
                            .attr("transform", function (d) { return "translate(0, " + yScale(d[group]) + ")"; });

                        // Add Outer bar
                        barEnter.append("rect")
                            .attr("class", "outer-bar")
                            .attr("height", yScale.rangeBand())
                            .attr("width", function (d) { return xScale(d[outerProp]); })
                            .attr("fill", "black")
                            .style("opacity", 0.3);

                        //Add InnerBar
                        barEnter.append("rect")
                           .attr("class", "inner-bar")
                           .attr("height", innerBarHeight)
                           .attr("y", (yScale.rangeBand() - innerBarHeight) / 2)
                           .attr("width", function (d) { return xScale(d[innerProp]); })
                           .attr("fill", "steelblue")
                           .style("opacity", 0.8);

                        // Add group name
                        barEnter.append("text")
                            .attr("class", "name-month")
                            .attr("text-anchor", "end")
                            .attr("dominant-baseline", "central")
                            .attr("font-size", "10")
                            .attr("dx", -1)
                            .attr("dy", yScale.rangeBand() / 2)
                            .text(function (d) { return d[group]; });

                        barsCont.exit().remove();
                    };

                    scope.$watch("data", function () {
                        if (scope.data && !drawn) {
                            createChart(scope.data);
                        } else {
                            updateChart(scope.data);
                        }
                    }, true);
                };
                $timeout(bulletChart, 0);
            }
        };
    }]);

angular.module("ehrDashboard")
.directive("boxWhisker", function(){
    return {
        restrict : 'E',
        scope: {
            data: '=',
            prop: '=',
            group: '='
        },
        template: '',
        link: function(scope, elem) {
            var drawChart = function(data,prop,group) {
                var div = elem[0];
                var width = div.offsetWidth / 3 - 5;
                var height = 300;

                var min = -10,
                    max = 110;

                var chart = d3.box()
                    .whiskers(iqr(1.5))
                    .width(width / 3 - 25)
                    .height(height - 15);

                chart.domain([min, max]);

                var svg = d3.select(div).selectAll('svg')
                  .data(data)
                .enter().append("svg")
                  .attr("class", "box")
                  .attr("width", width)
                  .attr("height", height)
                .append("g")
                    .attr("transform", "translate(100,10)")
                  .call(chart);

                svg.append("text")
                    .attr("transform", "translate(" + (width / 3 - 25) / 2 + "," + (height - 15) + ")")
                    .attr("text-anchor", "middle")
                    .style("font-size", "16px")
                    .text(function(d) {
                        return d.group;
                    });
            };
            var iqr = function(k) {
              return function(d, i) {
                var q1 = d.quartiles[0],
                    q3 = d.quartiles[2],
                    iqr = (q3 - q1) * k,
                    i = -1,
                    j = d.length;
                while (d[++i] < q1 - iqr);
                while (d[--j] > q3 + iqr);
                return [i, j];
              };
            }
            scope.$watch('data', function() {
                if (scope.data){
                    drawChart(scope.data, scope.prop, scope.group);
                }
            }), true;
        }
    };
});

(function() {

// Inspired by http://informationandvisualization.de/blog/box-plot
d3.box = function() {
  var width = 1,
      height = 1,
      duration = 0,
      domain = null,
      value = Number,
      whiskers = boxWhiskers,
      quartiles = boxQuartiles,
      tickFormat = null;

  // For each small multiple…
  function box(g) {
    g.each(function(d, i) {
        // LM: Replaced map(value) with unit
      d = d.unit.sort(d3.ascending);
      var g = d3.select(this),
          n = d.length,
          min = d[0],
          max = d[n - 1];

      // Compute quartiles. Must return exactly 3 elements.
      var quartileData = d.quartiles = quartiles(d);

      // Compute whiskers. Must return exactly 2 elements, or null.
      var whiskerIndices = whiskers && whiskers.call(this, d, i),
          whiskerData = whiskerIndices && whiskerIndices.map(function(i) { return d[i]; });

      // Compute outliers. If no whiskers are specified, all data are "outliers".
      // We compute the outliers as indices, so that we can join across transitions!
      var outlierIndices = whiskerIndices
          ? d3.range(0, whiskerIndices[0]).concat(d3.range(whiskerIndices[1] + 1, n))
          : d3.range(n);

      // Compute the new x-scale.
      var x1 = d3.scale.linear()
          .domain(domain && domain.call(this, d, i) || [min, max])
          .range([height, 0]);

      // Retrieve the old x-scale, if this is an update.
      var x0 = this.__chart__ || d3.scale.linear()
          .domain([0, Infinity])
          .range(x1.range());

      // Stash the new scale.
      this.__chart__ = x1;

      // Note: the box, median, and box tick elements are fixed in number,
      // so we only have to handle enter and update. In contrast, the outliers
      // and other elements are variable, so we need to exit them! Variable
      // elements also fade in and out.

      // Update center line: the vertical line spanning the whiskers.
      var center = g.selectAll("line.center")
          .data(whiskerData ? [whiskerData] : []);

      center.enter().insert("line", "rect")
          .attr("class", "center")
          .attr("x1", width / 2)
          .attr("y1", function(d) { return x0(d[0]); })
          .attr("x2", width / 2)
          .attr("y2", function(d) { return x0(d[1]); })
          .style("opacity", 1e-6)
        .transition()
          .duration(duration)
          .style("opacity", 1)
          .attr("y1", function(d) { return x1(d[0]); })
          .attr("y2", function(d) { return x1(d[1]); });

      center.transition()
          .duration(duration)
          .style("opacity", 1)
          .attr("y1", function(d) { return x1(d[0]); })
          .attr("y2", function(d) { return x1(d[1]); });

      center.exit().transition()
          .duration(duration)
          .style("opacity", 1e-6)
          .attr("y1", function(d) { return x1(d[0]); })
          .attr("y2", function(d) { return x1(d[1]); })
          .remove();

      // Update innerquartile box.
      var box = g.selectAll("rect.box")
          .data([quartileData]);

      box.enter().append("rect")
          .attr("class", "box")
          .attr("x", 0)
          .attr("y", function(d) { return x0(d[2]); })
          .attr("width", width)
          .attr("height", function(d) { return x0(d[0]) - x0(d[2]); })
        .transition()
          .duration(duration)
          .attr("y", function(d) { return x1(d[2]); })
          .attr("height", function(d) { return x1(d[0]) - x1(d[2]); });

      box.transition()
          .duration(duration)
          .attr("y", function(d) { return x1(d[2]); })
          .attr("height", function(d) { return x1(d[0]) - x1(d[2]); });

      // Update median line.
      var medianLine = g.selectAll("line.median")
          .data([quartileData[1]]);

      medianLine.enter().append("line")
          .attr("class", "median")
          .attr("x1", 0)
          .attr("y1", x0)
          .attr("x2", width)
          .attr("y2", x0)
        .transition()
          .duration(duration)
          .attr("y1", x1)
          .attr("y2", x1);

      medianLine.transition()
          .duration(duration)
          .attr("y1", x1)
          .attr("y2", x1);

      // Update whiskers.
      var whisker = g.selectAll("line.whisker")
          .data(whiskerData || []);

      whisker.enter().insert("line", "circle, text")
          .attr("class", "whisker")
          .attr("x1", 0)
          .attr("y1", x0)
          .attr("x2", width)
          .attr("y2", x0)
          .style("opacity", 1e-6)
        .transition()
          .duration(duration)
          .attr("y1", x1)
          .attr("y2", x1)
          .style("opacity", 1);

      whisker.transition()
          .duration(duration)
          .attr("y1", x1)
          .attr("y2", x1)
          .style("opacity", 1);

      whisker.exit().transition()
          .duration(duration)
          .attr("y1", x1)
          .attr("y2", x1)
          .style("opacity", 1e-6)
          .remove();

      // Update outliers.
      var outlier = g.selectAll("circle.outlier")
          .data(outlierIndices, Number);

      outlier.enter().insert("circle", "text")
          .attr("class", "outlier")
          .attr("r", 5)
          .attr("cx", width / 2)
          .attr("cy", function(i) { return x0(d[i]); })
          .style("opacity", 1e-6)
        .transition()
          .duration(duration)
          .attr("cy", function(i) { return x1(d[i]); })
          .style("opacity", 1);

      outlier.transition()
          .duration(duration)
          .attr("cy", function(i) { return x1(d[i]); })
          .style("opacity", 1);

      outlier.exit().transition()
          .duration(duration)
          .attr("cy", function(i) { return x1(d[i]); })
          .style("opacity", 1e-6)
          .remove();

      // Compute the tick format.
      var format = tickFormat || x1.tickFormat(8);

      // Update box ticks.
      var boxTick = g.selectAll("text.box")
          .data(quartileData);

      boxTick.enter().append("text")
          .attr("class", "box")
          .attr("dy", ".3em")
          .attr("dx", function(d, i) { return i & 1 ? 6 : -6 })
          .attr("x", function(d, i) { return i & 1 ? width : 0 })
          .attr("y", x0)
          .attr("text-anchor", function(d, i) { return i & 1 ? "start" : "end"; })
          .text(format)
        .transition()
          .duration(duration)
          .attr("y", x1);

      boxTick.transition()
          .duration(duration)
          .text(format)
          .attr("y", x1);

      // Update whisker ticks. These are handled separately from the box
      // ticks because they may or may not exist, and we want don't want
      // to join box ticks pre-transition with whisker ticks post-.
      var whiskerTick = g.selectAll("text.whisker")
          .data(whiskerData || []);

      whiskerTick.enter().append("text")
          .attr("class", "whisker")
          .attr("dy", ".3em")
          .attr("dx", 6)
          .attr("x", width)
          .attr("y", x0)
          .text(format)
          .style("opacity", 1e-6)
        .transition()
          .duration(duration)
          .attr("y", x1)
          .style("opacity", 1);

      whiskerTick.transition()
          .duration(duration)
          .text(format)
          .attr("y", x1)
          .style("opacity", 1);

      whiskerTick.exit().transition()
          .duration(duration)
          .attr("y", x1)
          .style("opacity", 1e-6)
          .remove();
    });
    d3.timer.flush();
  }

  box.width = function(x) {
    if (!arguments.length) return width;
    width = x;
    return box;
  };

  box.height = function(x) {
    if (!arguments.length) return height;
    height = x;
    return box;
  };

  box.tickFormat = function(x) {
    if (!arguments.length) return tickFormat;
    tickFormat = x;
    return box;
  };

  box.duration = function(x) {
    if (!arguments.length) return duration;
    duration = x;
    return box;
  };

  box.domain = function(x) {
    if (!arguments.length) return domain;
    domain = x == null ? x : d3.functor(x);
    return box;
  };

  box.value = function(x) {
    if (!arguments.length) return value;
    value = x;
    return box;
  };

  box.whiskers = function(x) {
    if (!arguments.length) return whiskers;
    whiskers = x;
    return box;
  };

  box.quartiles = function(x) {
    if (!arguments.length) return quartiles;
    quartiles = x;
    return box;
  };

  return box;
};

function boxWhiskers(d) {
  return [0, d.length - 1];
}

function boxQuartiles(d) {
  return [
    d3.quantile(d, .25),
    d3.quantile(d, .5),
    d3.quantile(d, .75)
  ];
}

})();

angular.module("ehrDashboard")
    .factory("LineOptions", function () {
        return {
            defaults: [
            { 'propName': 'margin', 'defaultValue': { "top": 0, "left": 0, "right": 0, "bottom": 0 } },
            { 'propName': 'color', 'defaultValue': 'steelblue' },
            { 'propName': 'xAxisFreq', 'defaultValue': '' },
            { 'propName': 'yMax', 'defaultValue': '' },
            { 'propName': 'colorBy', 'defaultValue': 'none' },
            { 'propName': 'tooltip', 'defaultValue': true },
            { 'propName': 'fitToHeight', 'defaultValue': true },
            { 'propName': 'radius', 'defaultValue': 3 },
            { 'propName': 'width', 'defaultValue': null },
            { 'propName': 'height', 'defaultValue': null },
            {'propName': 'title', 'defaultValue': ''}
            ],
            generateOptions: function (options) {
                var controls = options ? options : {};
                this.defaults.forEach(function (d) {
                    if (!controls.hasOwnProperty(d.propName)) {
                        controls[d.propName] = d.defaultValue;
                    }
                });
                return controls;
            }
        };
});

angular.module('ehrDashboard')
    .directive("lineChart", ["ChartOptions", function (ChartOptions) {
    return {
        restrict: 'E',
        scope: {
            data: '=',
            options: '=',
            date: '=',
            group: '=',
            unit: '='
        },
        link: function (scope, elem) {
            var config = ChartOptions.generateOptions(scope.options);
            var w, h;
            var unit = scope.unit;
            var date = scope.date;
            var group = scope.group;
            var drawn = false;
            var color = config.colorScale;
            var lineTip;
            var formatDate = d3.time.format("%m/%d/%Y");

            var createChart = function () {
                w = elem[0].offsetWidth;
                h = elem[0].offsetHeight;
                console.log(w, h);

                var svg = d3.select(elem[0]).append("svg")
                    .attr("class", "svg-chart")
                    .attr("width", w).attr("height", h);

                var chart = svg.append("g")
                    .attr("class", "chart")
                    .attr("transform", "translate(0,0)");

                chart.append("g")
                  .attr("class", "x-axis")
                  .attr("transform", "translate(0," + (h - 100) + ")");

                chart.append("g")
                  .attr("class", "y-axis")
                  .attr("transform", "translate(80,0)")
                    .append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", -40)
                    .attr("dx", -(h - 100) / 2)
                    .attr("dy", ".71em")
                    .style("text-anchor", "middle")
                    .text(config.yScaleLabel);

                //if (config.tooltip) {
                //    createToolTip();
                //}

                updateChart(scope.data);
            };

            //var createToolTip = function () {
            //    lineTip = d3.tip().attr('class', 'd3-tip')
            //        .offset(function () {
            //            return [0, 2]
            //        })
            //        .direction('e')
            //        .style("text-align", "center")
            //        .html(function (d) {
            //            return d[x];
            //        });
            //    d3.select("svg").call(lineTip);
            //};

            var updateChart = function (data) {
                var chart =  d3.select("svg.svg-chart").select("g.chart");
                data = data.map(function (d) {
                    return {
                        unit: d[unit],
                        date: d[date],
                        group: d[group],
                        realDate: formatDate.parse(d[date])
                    };
                });

                data = _.sortBy(data, function (d) { return +d.realDate; });

                //Set up Scales
                var minVal = 0;
                var maxVal = d3.max(data, function (d) { return d.unit; });
                // give 10% buffers on both sides
                maxVal = maxVal + (maxVal * 0.05);
                var yScale = d3.scale.linear()
                    .domain([minVal, maxVal])
                    .range([(h-100), 0]);
                var xScale = d3.time.scale()
                    .range([80, w - 40])
                    .domain(d3.extent(data, function (d) { return d.realDate; }));
                var xAxis = d3.svg.axis()
                    .scale(xScale)
                    .tickFormat(d3.time.format("%m-%y"))
                    .tickPadding(6)
                    .ticks(d3.time.month, 1)
                    .orient("bottom");

                var yAxis = d3.svg.axis()
                    .scale(yScale)
                    .orient("left");

                //chart.append("line")
                //    .attr("x1", xScale(d3.min(data, function(d) { return d.realDate; })))
                //    .attr("x2", xScale(d3.max(data, function(d) { return d.realDate; })))
                //    .attr("y1", yScale(100))
                //    .attr("y2", yScale(100))
                //    .style("stroke", "black")
                //    .style("troke-width", 2)
                //    .style("stroke-dasharray", ("3, 3"));

                var groups = d3.nest()
                    .key(function (d) { return d.group; })
                    .entries(data);

                var line = d3.svg.line()
					.interpolate("linear")
					.x(function (d) { return xScale(d.realDate); })
					.y(function (d) { return yScale(d.unit); });

                 var lines = chart.selectAll("path")
                    .data(groups, function (d) { return d.key; });

                lines.transition()
                    .ease("linear")
                    .duration(1000)
                    .attr("d", function (d) { return line(d.values); });

                lines.enter().append("path")
                    .attr("class", "line")
                    .style("stroke", function (d) { return color(d.key); })
                    .style("fill", "none")
                    .style("stroke-width", 5)
                    .transition()
                    .ease("linear")
                    .duration(1000)
                    .attr("d", function (d) { return line(d.values); });

                //Axes
                d3.select("g.x-axis").call(xAxis);
                d3.select("g.y-axis").call(yAxis);

                lines.exit().remove();

                //Legend
                var legend = chart.selectAll(".legend")
                    .data(_.uniq(_.pluck(data, 'group')))
                  .enter().append("g")
                    .attr("class", "legend")
                    .attr("transform", function (d, i) { return "translate(0," + i * 20 + ")"; });

                legend.append("rect")
                    .attr("x", w - 72)
                    .attr("width", 18)
                    .attr("height", 18)
                    .style("fill", color);

                legend.append("text")
                    .attr("x", w - 96)
                    .attr("y", 9)
                    .attr("dy", ".35em")
                    .style("text-anchor", "end")
                    .text(function (d) { return d; });
            };

            scope.$watch('data', function () {
                if (scope.data) {
                    if (!drawn) {
                        setTimeout(function () { createChart(); }, 250);
                    } else {
                        updateChart(scope.data);
                    }
                    drawn = true;
                }
            }, true);
        }
    };
}]);

angular.module("ehrDashboard")
    .directive("simpleLineChart", ["$timeout", "LineOptions", function ($timeout, LineOptions) {
    return {
        restrict: 'E',
        scope: {
            data: '=',
            options: '=',
            date: '=',
            unit: '='
        },
        link: function (scope, elem) {
            var lineChart = function () {
                var config = LineOptions.generateOptions(scope.options);
                var w, h;
                var unit = scope.unit;
                var date = scope.date;
                var radius = config.radius;
                var lineTip, svg, xScale, yScale;
                //var formatMonth = d3.time.format("%Y-%m-%d");
                var formatMonthLabel = d3.time.format("%b-%y");

                var createChart = function (data) {
                    w = config.width ? config.width : elem[0].offsetWidth - 20;
                    h = config.height ? config.height : elem[0].offsetHeight;
                    svg = d3.select(elem[0]).append("svg")
                        .attr("class", "svg-simple-line")
                        .attr("width", w).attr("height", h)
                        .on("mouseover", function () {
                            d3.select(this).selectAll(".to-show")
                                    .transition().duration(500)
                                    .style("opacity", 1);
                        })
                        .on("mouseout", function () {
                            d3.select(this).selectAll(".to-show")
                                .transition().duration(500)
                                .style("opacity", 0);
                        });

                    var chart = svg.append("g")
                        .attr("class", "chart")
                        .attr("transform", "translate(0,0)");

                    chart.append("text")
                        .attr("class", "title to-show")
                        .attr("dx", w / 2)
                        .attr("dy", 10)
                        .style("font-size", 10)
                        .attr("text-anchor", "middle")
                        .text(config.title)
                        .style("opacity", 0);

                    chart.append("g")
                        .attr("class", "x-axis-time to-show")
                        .attr("transform", "translate(0," + (h - 25) + ")")
                        .style("opacity", 0);

                    chart.append("g")
                      .attr("class", "y-axis-time")
                      .attr("transform", "translate(80,0)");

                    if (config.tooltip) {
                        createToolTip();
                    }

                    data = data.map(function (d) {
                        return {
                            unit: d[unit],
                            //date: d[date].substring(0, 10),
                            realDate: d[date]                        };
                    });

                    data = data.sort(function (a, b) {
                        return +a.realDate - b.realDate;
                    });

                    // Set up scales
                    var minVal = 0;
                    var maxVal = d3.max(data, function (d) { return d.unit; });

                    // Give 10% buffers on both sides
                    maxVal = maxVal + (maxVal * 0.05);
                    yScale = d3.scale.linear()
                        .domain([minVal, config.yMax])
                        .range([(h - 10), 10]);
                    xScale = d3.time.scale()
                        .range([15, w-20])
                        .domain(d3.extent(data, function (d) { return d.realDate; }));

                    updateChart(data);
                };

                var createLine = function() {
                    var chart = svg.select("g.chart");

                    chart.append("line")
                        .attr("x1", 15)
                        .attr("x2", w - 20)
                        .attr("y1", yScale(config.straightLine))
                        .attr("y2", yScale(config.straightLine))
                        .style("stroke", "black")
                        .style("opacity", 0.4);

                    chart.append("text")
                        .attr("class", "to-show")
                        .attr("dx", (w - 20))
                        .attr("dy", yScale(config.straightLine) + 2)
                        .attr("font-size", 8)
                        .style("opacity", 0)
                        .text(config.straightLine + "%");
                };

                var createToolTip = function () {
                    lineTip = d3.tip().attr('class', 'd3-tip')
                        .offset(function () {
                            return [-8, 0];
                        })
                        .direction('n')
                        .style("text-align", "center")
                        .html(function (d) {
                            return Math.round(d.unit * 100) / 100;
                        });
                    svg.call(lineTip);
                };

                var updateChart = function (data) {
                    createLine();
                    var chart = svg.select("g.chart");

                    var xAxis = d3.svg.axis()
                        .scale(xScale)
                        .tickFormat(formatMonthLabel)
                        .tickPadding(6)
                        .ticks(d3.time.month, config.xAxisFreq)
                        .orient("bottom");

                    var yAxis = d3.svg.axis()
                        .scale(yScale)
                        .ticks(6)
                        .orient("left");

                    var line = d3.svg.line()
                        .x(function (d) { return xScale(d.realDate); })
                        .y(function (d) { return yScale(d.unit); });

                    chart.append("path")
                        .datum(data)
                        .attr("class", "lines")
                        .style("stroke", config.color)
                        .transition()
                        .ease("linear")
                        .duration(1000)
                        .attr("d", function (d) { return line(d); });

                    // Axes
                    svg.select("g.x-axis-time")
                        .call(xAxis);

                    //// Axes
                    //d3.select("g.y-axis-time")
                    //    .call(yAxis);

                    //Circles
                    var circles = chart.selectAll("circle")
                        .data(data);

                    circles.enter().append("circle")
                        .style("fill", config.color)
                        .attr("r", radius)
                        .on('mouseover', function (d) {
                            d3.select(this).transition().duration(500)
                                .attr("r", (radius + (radius * 0.9)));
                            lineTip.show(d);
                        })
                        .on('mouseout', function (d) {
                            d3.select(this).transition().duration(500).attr("r", radius);
                            lineTip.hide(d);
                        });

                    circles.transition().duration(1000)
                        .ease("bounce")
                        .attr("cx", function (d) { return xScale(d.realDate); })
                        .attr("cy", function (d) { return yScale(d.unit); });

                    circles.exit().remove();
                };

                scope.$watch('data', function () {
                    if (scope.data) {
                        createChart(scope.data);
                    }
                }, true);
            };
            $timeout(lineChart, 0);
        }
    };
}]);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvcmUvY2FsY3VsYXRlLnNlcnZpY2UuanMiLCJjb3JlL2RhdGEuc2VydmljZS5qcyIsImNvcmUvbWFpbi5jb250cm9sbGVyLmpzIiwiY2hhcnRzL2Jhci1zcGFyay5qcyIsImNoYXJ0cy9idWJibGUtY2hhcnQuanMiLCJjaGFydHMvY2hhcnRvcHRpb24uc2VydmljZS5qcyIsImRhdGEvYXJyYXkuZXh0ZW5kLmpzIiwiY2hhcnRzL2Jhci9iYXIuY2hhcnQuZGlyZWN0aXZlLmpzIiwiY2hhcnRzL2Jhci9iYXJvcHRpb24uc2VydmljZS5qcyIsImNoYXJ0cy9iYXIvZ3JvdXAtYmFyLmRpcmVjdGl2ZS5qcyIsImNoYXJ0cy9iYXIvc3RhY2tiYXJjaGFyLmRpcmVjdGl2ZS5qcyIsImNoYXJ0cy9iYXIvdmVydGljYWwtYmFyLmNoYXJ0LmRpcmVjdGl2ZS5qcyIsImNoYXJ0cy9idWxsZXQtY2hhcnQvYnVsbGV0LWNoYXJ0LmRpcmVjdGl2ZS5qcyIsImNoYXJ0cy9ib3gvYm94LXdoaXNrZXIuanMiLCJjaGFydHMvYm94L2JveC5qcyIsImNoYXJ0cy9saW5lL2xpbmVvcHRpb24uc2VydmljZS5qcyIsImNoYXJ0cy9saW5lL211bHRpLWxpbmUuY2hhcnQuZGlyZWN0aXZlLmpzIiwiY2hhcnRzL2xpbmUvc2ltcGxlLWxpbmUuY2hhcnQuZGlyZWN0aXZlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0EsUUFBUSxPQUFPLGdCQUFnQjtJQUMzQjtJQUNBO0lBQ0E7OztDQUdILDhCQUFPLFVBQVUsb0JBQW9CO0lBQ2xDLG1CQUFtQixNQUFNO09BQ3RCLGVBQWU7T0FDZixjQUFjOztBQUVyQjtBQ1pBO0FBQ0EsUUFBUSxPQUFPO0tBQ1YsUUFBUSxhQUFhLFlBQVk7UUFDOUIsS0FBSyxhQUFhLFVBQVUsU0FBUyxVQUFVO1lBQzNDLElBQUksU0FBUztZQUNiLE9BQU8sYUFBYTtpQkFDZixJQUFJLFVBQVUsR0FBRyxFQUFFLE9BQU8sRUFBRTtp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anMiLCJzb3VyY2VzQ29udGVudCI6WyIvL0Jvb3RzdHJhcHMgb3VyIGFuZ3VsYXIgYXBwXHJcbmFuZ3VsYXIubW9kdWxlKCdlaHJEYXNoYm9hcmQnLCBbXHJcbiAgICAnbmdBbmltYXRlJyxcclxuICAgICduZ0FyaWEnLFxyXG4gICAgJ25nTWF0ZXJpYWwnLFxyXG4gICAgLy8ndWktcm91dGVyJ1xyXG5dKVxyXG4uY29uZmlnKGZ1bmN0aW9uICgkbWRUaGVtaW5nUHJvdmlkZXIpIHtcclxuICAgICRtZFRoZW1pbmdQcm92aWRlci50aGVtZSgnZGVmYXVsdCcpXHJcbiAgICAgIC5wcmltYXJ5UGFsZXR0ZSgnYmx1ZScpXHJcbiAgICAgIC5hY2NlbnRQYWxldHRlKCdncmVlbicpO1xyXG59KVxyXG4iLCIvL0FuZ3VsYXIgU2VydmljZSB1c2VkIHRvIGNhbGN1bGF0ZSBhbGwgb2YgdGhlIGluZm9ybWF0aW9uIHdlIHNob3cgb24gdGhlIGRhc2hib2FyZFxyXG5hbmd1bGFyLm1vZHVsZShcImVockRhc2hib2FyZFwiKVxyXG4gICAgLnNlcnZpY2UoXCJDYWxjdWxhdGVcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuZ2V0TWV0cmljcyA9IGZ1bmN0aW9uIChwYXRpZW50LCBwcm92aWRlcikge1xyXG4gICAgICAgICAgICB2YXIgbWV0cmljID0ge307XHJcbiAgICAgICAgICAgIG1ldHJpYy5hZ2VBdmVyYWdlID0gcGF0aWVudFxyXG4gICAgICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5BZ2UgfSlcclxuICAgICAgICAgICAgICAgIC5yZWR1Y2UoZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIGEgKyBiOyB9KVxyXG4gICAgICAgICAgICAgICAgLyBwYXRpZW50Lmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgIG1ldHJpYy5jaGF0QXZlcmFnZSA9IHBhdGllbnRcclxuICAgICAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuY2hhdENvdW50IH0pXHJcbiAgICAgICAgICAgICAgICAucmVkdWNlKGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiBhICsgYjsgfSlcclxuICAgICAgICAgICAgICAgIC8gcGF0aWVudC5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICBtZXRyaWMuaW1hZ2VBdmVyYWdlID0gcGF0aWVudFxyXG4gICAgICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5pbWFnZUNvdW50IH0pXHJcbiAgICAgICAgICAgICAgICAucmVkdWNlKGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiBhICsgYjsgfSlcclxuICAgICAgICAgICAgICAgIC8gcGF0aWVudC5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICBtZXRyaWMucHJvdmlkZXJBdmVyYWdlID0gcGF0aWVudFxyXG4gICAgICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5wcm92aWRlckNvdW50IH0pXHJcbiAgICAgICAgICAgICAgICAucmVkdWNlKGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiBhICsgYjsgfSlcclxuICAgICAgICAgICAgICAgIC8gcGF0aWVudC5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICB2YXIgZ3JvdXBEaWFnID0gXy5ncm91cEJ5KHBhdGllbnQsIFwiZGlhZ25vc2lzXCIpO1xyXG4gICAgICAgICAgICBtZXRyaWMudG9wRGlhZ25vc2VzID0gXy5tYXAoZ3JvdXBEaWFnLCBmdW5jdGlvbiAoZGF0YSwga2V5KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGdyb3VwOiAga2V5Lmxlbmd0aCA+IDMyID8ga2V5LnN1YnN0cmluZygwLDMyKStcIi4uLlwiIDoga2V5LFxyXG4gICAgICAgICAgICAgICAgICAgIG51bWJlcjogZGF0YS5sZW5ndGhcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdmFyIHByb2NEaWFnID0gXy5ncm91cEJ5KF8uZmxhdHRlbihwYXRpZW50Lm1hcChmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5wcm9jZWR1cmVzOyB9KSkpO1xyXG4gICAgICAgICAgICBtZXRyaWMudG9wUHJvY2VkdXJlcyA9IF8ubWFwKHByb2NEaWFnLCBmdW5jdGlvbiAoZGF0YSwga2V5KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGdyb3VwOiBrZXksXHJcbiAgICAgICAgICAgICAgICAgICAgbnVtYmVyOiBkYXRhLmxlbmd0aFxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB2YXIgcm9sZUdyb3VwID0gXy5ncm91cEJ5KHByb3ZpZGVyLm1hcChmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5Sb2xlOyB9KSk7XHJcbiAgICAgICAgICAgIG1ldHJpYy5yb2xlQ291bnQgPSBfLm1hcChyb2xlR3JvdXAsIGZ1bmN0aW9uIChkYXRhLCBrZXkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXA6IGtleS5sZW5ndGggPiAzMiA/IGtleS5zdWJzdHJpbmcoMCwzMikrXCIuLi5cIiA6IGtleSxcclxuICAgICAgICAgICAgICAgICAgICBudW1iZXI6IGRhdGEubGVuZ3RoXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHZhciBzdGF0dXNHcm91cCA9IF8uZ3JvdXBCeShwYXRpZW50Lm1hcChmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5NZWRpY2FsU3RhdHVzOyB9KSk7XHJcbiAgICAgICAgICAgIG1ldHJpYy5zdGF0dXNDb3VudCA9IF8ubWFwKHN0YXR1c0dyb3VwLCBmdW5jdGlvbiAoZGF0YSwga2V5KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGdyb3VwOiBrZXksXHJcbiAgICAgICAgICAgICAgICAgICAgbnVtYmVyOiBkYXRhLmxlbmd0aFxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbWV0cmljO1xyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCIvL0RhdGEgU2VydmljZSB0aGF0IG1ha2VzIHRoZSBhcGkgY2FsbCB0byBvdXIgc2VydmVyIHRvIGdldCBkYXNoYm9hcmQgZGF0YVxyXG5hbmd1bGFyLm1vZHVsZShcImVockRhc2hib2FyZFwiKVxyXG4gICAgLnNlcnZpY2UoXCJEYXRhXCIsIGZ1bmN0aW9uKCRodHRwKXtcclxuICAgICAgICB0aGlzLmdldERhdGEgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoXCJhcGkvRGFzaGJvYXJkXCIpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG4iLCIvL0FuZ3VsYXIgY29udHJvbGxlciB0aGF0IGdvdmVybnMgdGhlIGJ1c2luZXNzIGxvZ2ljIG9uIG91ciBob21lIHBhZ2VcclxuYW5ndWxhci5tb2R1bGUoXCJlaHJEYXNoYm9hcmRcIilcclxuICAgIC5jb250cm9sbGVyKFwiTWFpbkN0cmxcIiwgZnVuY3Rpb24oRGF0YSwgQ2FsY3VsYXRlKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS5kYXRhID0ge307XHJcbiAgICAgICAgdm0uZ3JvdXBEaWFnID0gXCJncm91cFwiO1xyXG4gICAgICAgIHZtLnVuaXQgPSBcIm51bWJlclwiO1xyXG4gICAgICAgIC8vQ2FsbCBkYXRhIHNlcnZpY2UgYW5kIHRoZW4gcHJvY2VzcyBkYXRhIGFuZCBhc3NpZ24gaXQgdG8gdmlldyBtb2RlbFxyXG4gICAgICAgIERhdGEuZ2V0RGF0YSgpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YS5kYXRhKTtcclxuICAgICAgICAgICAgdm0ucHJvY2Vzc2VkID0gQ2FsY3VsYXRlLmdldE1ldHJpY3MoZGF0YS5kYXRhLnBhdGllbnRzLCBkYXRhLmRhdGEucHJvdmlkZXJzKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2codm0ucHJvY2Vzc2VkKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pOyAgIiwiYW5ndWxhci5tb2R1bGUoXCJlaHJEYXNoYm9hcmRcIilcclxuLmRpcmVjdGl2ZShcImJhclNwYXJrXCIsIGZ1bmN0aW9uKCl7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHJlc3RyaWN0IDogJ0UnLFxyXG4gICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgIGRhdGE6ICc9JyxcclxuICAgICAgICAgICAgcHJvcDogJz0nLFxyXG4gICAgICAgICAgICBncm91cDogJz0nXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0ZW1wbGF0ZTogJycsXHJcbiAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW0pIHtcclxuICAgICAgICAgICAgdmFyIGRyYXdDaGFydCA9IGZ1bmN0aW9uKGRhdGEscHJvcCxncm91cCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvbG9yID0gZDMuc2NhbGUuY2F0ZWdvcnkxMCgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRpdiA9IGVsZW1bMF07XHJcbiAgICAgICAgICAgICAgICB2YXIgdyA9IGRpdi5vZmZzZXRXaWR0aDtcclxuICAgICAgICAgICAgICAgIHZhciBoID0gTWF0aC5tYXgoZGl2Lm9mZnNldEhlaWdodCwgMjgwKTtcclxuICAgICAgICAgICAgICAgIHZhciB4U2NhbGUgPSBkMy5zY2FsZS5saW5lYXIoKS5kb21haW4oWzAsIE1hdGguY2VpbChkMy5tYXgoZGF0YSwgZnVuY3Rpb24oZCkgeyByZXR1cm4gZFtwcm9wXTsgfSkpXSkucmFuZ2UoWzAsdy8xLjZdKTtcclxuICAgICAgICAgICAgICAgIHZhciB5U2NhbGUgPSBkMy5zY2FsZS5vcmRpbmFsKCkuZG9tYWluKGRhdGEubWFwKGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGRbZ3JvdXBdOyB9KSkucmFuZ2VSb3VuZEJhbmRzKFsxMCxoLTUwXSwgMC4yKTtcclxuICAgICAgICAgICAgICAgIHZhciBzdmcgPSBkMy5zZWxlY3QoZGl2KS5hcHBlbmQoXCJzdmdcIikuYXR0cihcImhlaWdodFwiLGgpLmF0dHIoXCJ3aWR0aFwiLHcpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGdyYXBoID0gc3ZnLmFwcGVuZChcImdcIikuYXR0cihcInRyYW5zZm9ybVwiLFwidHJhbnNsYXRlKDAsMjApXCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGcgPSBncmFwaC5zZWxlY3RBbGwoXCJnXCIpLmRhdGEoZGF0YSlcclxuICAgICAgICAgICAgICAgICAgICAuZW50ZXIoKS5hcHBlbmQoXCJnXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gXCJ0cmFuc2xhdGUoMzAsXCIreVNjYWxlKGRbZ3JvdXBdKStcIilcIjsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHhBeGlzTnVtID0gZDMuc3ZnLmF4aXMoKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zY2FsZSh4U2NhbGUpXHJcbiAgICAgICAgICAgICAgICAgICAgLm9yaWVudChcImJvdHRvbVwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICBzdmcuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIixcInggYXhpc1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsXCJ0cmFuc2xhdGUoMzAsXCIgKyhoIC0gMjUpK1wiKVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKHhBeGlzTnVtKTtcclxuXHJcbiAgICAgICAgICAgICAgICBnLmFwcGVuZChcInJlY3RcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsXCJzcGFya1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4geFNjYWxlKGRbcHJvcF0pfSlcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCB5U2NhbGUucmFuZ2VCYW5kKCkpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwiZmlsbFwiLCBcInN0ZWVsYmx1ZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZVwiLCBcIiMzODY4OTBcIilcclxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJzdHJva2Utd2lkdGhcIiwyKTtcclxuXHJcbiAgICAgICAgICAgICAgICBnLmFwcGVuZChcInRleHRcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIHlTY2FsZS5yYW5nZUJhbmQoKS8yKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZHhcIiwgNClcclxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsXCJ3aGl0ZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLDEyKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInRleHQtYW5jaG9yXCIsXCJzdGFydFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGRbZ3JvdXBdOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBnLmFwcGVuZChcInRleHRcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIHlTY2FsZS5yYW5nZUJhbmQoKS8yKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLDE1KVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcImZpbGxcIixcIndoaXRlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkeFwiLCBmdW5jdGlvbihkKSB7IHJldHVybiAoeFNjYWxlKGRbcHJvcF0pLTUpOyB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInRleHQtYW5jaG9yXCIsXCJlbmRcIilcclxuICAgICAgICAgICAgICAgICAgICAudGV4dChmdW5jdGlvbihkKSB7IHJldHVybiBkW3Byb3BdK1wiJVwiOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL2xpbmUgY2hhcnRcclxuICAgICAgICAgICAgICAgIHZhciBwYXJzZURhdGUgPSBkMy50aW1lLmZvcm1hdChcIiVtLyVkLyVZXCIpLnBhcnNlO1xyXG4gICAgICAgICAgICAgICAgdmFyIHhTY2FsZVRpbWUgPSBkMy50aW1lLnNjYWxlKCkucmFuZ2UoW3cvMS41LHctMTAwXSkuZG9tYWluKGQzLmV4dGVudChkYXRhWzBdLnRpbWUsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHBhcnNlRGF0ZShkLnF1YXJ0ZXIpO30pKTtcclxuICAgICAgICAgICAgICAgIHZhciB4QXhpcyA9IGQzLnN2Zy5heGlzKClcclxuICAgICAgICAgICAgICAgICAgICAuc2NhbGUoeFNjYWxlVGltZSlcclxuICAgICAgICAgICAgICAgICAgICAudGlja3MoZDMudGltZS5tb250aCwgMylcclxuICAgICAgICAgICAgICAgICAgICAudGlja0Zvcm1hdChkMy50aW1lLmZvcm1hdChcIiViXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgIC5vcmllbnQoXCJib3R0b21cIik7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHlUaW1lcyA9IHt9O1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBsaW5lID0gZDMuc3ZnLmxpbmUoKVxyXG4gICAgICAgICAgICAgICAgICAgIC5pbnRlcnBvbGF0ZShcImxpbmVhclwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC54KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHhTY2FsZVRpbWUocGFyc2VEYXRlKGQucXVhcnRlcikpOyB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC55KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHlUaW1lc1tkLnR5cGVdKGRbcHJvcF0pOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBnLmFwcGVuZChcInBhdGhcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImZpbGxcIixcIm5vbmVcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInN0cm9rZVwiLFwic3RlZWxibHVlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwyKVxyXG4gICAgICAgICAgICAgICAgICAgIC5kYXR1bShmdW5jdGlvbihkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgheVRpbWVzW2QudHlwZV0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlUaW1lc1tkLnR5cGVdID0gZDMuc2NhbGUubGluZWFyKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmFuZ2UoW3lTY2FsZS5yYW5nZUJhbmQoKSwxMF0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRvbWFpbihbLTEwLCAxMF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLmRvbWFpbihbKGQzLm1pbihkLnRpbWUsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGRbcHJvcF07fSktMSksIChkMy5tYXgoZC50aW1lLCBmdW5jdGlvbihkKSB7IHJldHVybiBkW3Byb3BdO30pKzEpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQudGltZTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZFwiLGxpbmUpO1xyXG5cclxuICAgICAgICAgICAgICAgIGcuYXBwZW5kKFwibGluZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZS1kYXNoYXJyYXlcIiwgKFwiM1wiLCBcIjNcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwic3Ryb2tlXCIsIFwiYmxhY2tcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcIngxXCIsIHhTY2FsZVRpbWUucmFuZ2UoKVswXSlcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcIngyXCIsIHhTY2FsZVRpbWUucmFuZ2UoKVsxXSlcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInkxXCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHlUaW1lc1tkLnR5cGVdKDApfSlcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInkyXCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHlUaW1lc1tkLnR5cGVdKDApfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgZy5hcHBlbmQoXCJ0ZXh0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZnVuY3Rpb24oZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJ0cmFuc2xhdGUoXCIgKyAoeFNjYWxlVGltZS5yYW5nZSgpWzFdICsgMTYpICsgXCIsXCIgKyAoeVRpbWVzW2QudHlwZV0oMCkgKyA1KSArIFwiKVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBcIjEzcHhcIilcclxuICAgICAgICAgICAgICAgICAgICAudGV4dChcIjAlXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgIGcuc2VsZWN0QWxsKFwiY2lyY2xlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmRhdGEoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC50aW1lOyB9KVxyXG4gICAgICAgICAgICAgICAgLmVudGVyKCkuYXBwZW5kKFwiY2lyY2xlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjeFwiLCBmdW5jdGlvbihkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB4U2NhbGVUaW1lKHBhcnNlRGF0ZShkLnF1YXJ0ZXIpKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY3lcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4geVRpbWVzW2QudHlwZV0oZFtwcm9wXSk7IH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJyXCIsIFwiM3B4XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJmaWxsXCIsIFwiIzM4Njg5MFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwic3Ryb2tlXCIsIFwibm9uZVwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICBzdmcuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIixcInggYXhpc1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsXCJ0cmFuc2xhdGUoMzAsXCIgKyhoIC0gMjUpK1wiKVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKHhBeGlzKTtcclxuXHJcbiAgICAgICAgICAgICAgICBzdmcuYXBwZW5kKFwidGV4dFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieVwiLCAxNSlcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInhcIiwgMzArKHcvMS42KS8yKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInRleHQtYW5jaG9yXCIsXCJtaWRkbGVcIilcclxuICAgICAgICAgICAgICAgICAgICAudGV4dChcIlByZXZhbGVuY2Ugb2YgTWV0cmljIC0gQ3VycmVudCBRdWFydGVyXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgIHN2Zy5hcHBlbmQoXCJ0ZXh0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIDE1KVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInRleHQtYW5jaG9yXCIsXCJtaWRkbGVcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInhcIiw1Kyh3LzEuNikrKCh3LSh3LzEuNikpLzIpKVxyXG4gICAgICAgICAgICAgICAgICAgIC50ZXh0KFwiUGVyY2VudCBDaGFuZ2UgRnJvbSBCYXNlbGluZVwiKTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnZGF0YScsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLmRhdGEpe1xyXG4gICAgICAgICAgICAgICAgICAgIGRyYXdDaGFydChzY29wZS5kYXRhLCBzY29wZS5wcm9wLCBzY29wZS5ncm91cCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pLCB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn0pO1xyXG4iLCJhbmd1bGFyLm1vZHVsZShcImVockRhc2hib2FyZFwiKVxyXG4uZGlyZWN0aXZlKFwiYnViYmxlQ2hhcnRcIiwgZnVuY3Rpb24oKXtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgcmVzdHJpY3QgOiAnRScsXHJcbiAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgZGF0YTogJz0nXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0ZW1wbGF0ZTogJycsXHJcbiAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW0pIHtcclxuICAgICAgICAgICAgdmFyIGRyYXdDaGFydCA9IGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkaXYgPSBlbGVtWzBdO1xyXG4gICAgICAgICAgICAgICAgdmFyIHcgPSBkaXYub2Zmc2V0V2lkdGg7XHJcbiAgICAgICAgICAgICAgICB2YXIgaCA9IGRpdi5vZmZzZXRIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3ZnID0gZDMuc2VsZWN0KGRpdikuYXBwZW5kKFwic3ZnXCIpLmF0dHIoXCJoZWlnaHRcIixoKS5hdHRyKFwid2lkdGhcIix3KTtcclxuICAgICAgICAgICAgICAgIHZhciBncmFwaCA9IHN2Zy5hcHBlbmQoXCJnXCIpLmF0dHIoXCJ0cmFuc2Zvcm1cIixcInRyYW5zbGF0ZSgwLDIwKVwiKTtcclxuICAgICAgICAgICAgICAgIC8vbGluZSBjaGFydFxyXG4gICAgICAgICAgICAgICAgdmFyIHhTY2FsZVRpbWUgPSBkMy50aW1lLnNjYWxlKCkucmFuZ2UoWzYwLHctNTBdKS5kb21haW4oZDMuZXh0ZW50KGRhdGEsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHBhcnNlRGF0ZShkLmRhdGUpOyB9KSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgeEF4aXMgPSBkMy5zdmcuYXhpcygpXHJcbiAgICAgICAgICAgICAgICAgICAgLnNjYWxlKHhTY2FsZVRpbWUpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRpY2tzKGQzLnRpbWUubW9udGgsIDMpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRpY2tGb3JtYXQoZDMudGltZS5mb3JtYXQoXCIlYlwiKSlcclxuICAgICAgICAgICAgICAgICAgICAub3JpZW50KFwiYm90dG9tXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB5U2NhbGVUaW1lID0gZDMuc2NhbGUubGluZWFyKCkucmFuZ2UoW2gtNTAsMF0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmRvbWFpbihbZDMubWluKHR5cGVzLCBmdW5jdGlvbihkKSB7IHJldHVybiBkMy5taW4oZC52YWx1ZXMsIGZ1bmN0aW9uKHgpIHsgcmV0dXJuIHgudmFsdWU7IH0pOyB9KSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZDMubWF4KHR5cGVzLCBmdW5jdGlvbihkKSB7IHJldHVybiBkMy5tYXgoZC52YWx1ZXMsIGZ1bmN0aW9uKHgpIHsgcmV0dXJuIHgudmFsdWU7IH0pOyB9KV0pO1xyXG4gICAgICAgICAgICAgICAgdmFyIHlBeGlzID0gZDMuc3ZnLmF4aXMoKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zY2FsZSh5U2NhbGVUaW1lKVxyXG4gICAgICAgICAgICAgICAgICAgIC5vcmllbnQoXCJsZWZ0XCIpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBsaW5lID0gZDMuc3ZnLmxpbmUoKVxyXG4gICAgICAgICAgICAgICAgICAgIC5pbnRlcnBvbGF0ZShcImJhc2lzXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLngoZnVuY3Rpb24oZCkgeyByZXR1cm4geFNjYWxlVGltZShwYXJzZURhdGUoZC5kYXRlKSk7IH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLnkoZnVuY3Rpb24oZCkgeyByZXR1cm4geVNjYWxlVGltZShkLnZhbHVlKTsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgZ3JhcGguYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIixcIngtYXhpc1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsXCJ0cmFuc2xhdGUoMCxcIisoaC02MCkrXCIpXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoeEF4aXMpO1xyXG5cclxuICAgICAgICAgICAgICAgIHN2Zy5hcHBlbmQoXCJnXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIixcInRyYW5zbGF0ZSg2MCwwKVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ4LWF4aXNcIilcclxuICAgICAgICAgICAgICAgICAgICAuY2FsbCh5QXhpcylcclxuICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKFwidGV4dFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwicm90YXRlKC05MClcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInlcIiwgNilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIFwiLjcxZW1cIilcclxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJ0ZXh0LWFuY2hvclwiLCBcImVuZFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC50ZXh0KFwiVVNEICRcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHR5cGUgPSBzdmcuc2VsZWN0QWxsKFwiZy5tdWx0aVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5kYXRhKHR5cGVzKVxyXG4gICAgICAgICAgICAgICAgICAgIC5lbnRlcigpLmFwcGVuZChcImdcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsXCJtdWx0aVwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICB0eXBlLmFwcGVuZChcInBhdGhcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwibGluZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZFwiLCBmdW5jdGlvbihkKSB7IHJldHVybiBsaW5lKGQudmFsdWVzKTsgfSlcclxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJzdHJva2VcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gY29sb3IoZC5uYW1lKTsgfSlcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImZpbGxcIixcIm5vbmVcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgdHlwZS5hcHBlbmQoXCJ0ZXh0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmRhdHVtKGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHtuYW1lOiBkLm5hbWUsIHZhbHVlOiBkLnZhbHVlc1tkLnZhbHVlcy5sZW5ndGggLSAxXX07IH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gXCJ0cmFuc2xhdGUoXCIgKyAoeFNjYWxlVGltZShwYXJzZURhdGUoZC52YWx1ZS5kYXRlKSktNTApICsgXCIsXCIgKyAoeVNjYWxlVGltZShkLnZhbHVlLnZhbHVlKS0xMCkgKyBcIilcIjsgfSlcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInhcIiwgMylcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIFwiLjM1ZW1cIilcclxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJmb250LXNpemVcIiwxMSlcclxuICAgICAgICAgICAgICAgICAgICAudGV4dChmdW5jdGlvbihkKSB7IHJldHVybiBkLm5hbWUgPT09ICd0b3RhbE1vbmV5JyA/IFwiTW9uZXkgUmVjb3ZlcmVkXCIgOiBcIk1vbmV5IE91dHN0YW5kaW5nXCI7IH0pO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdkYXRhJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuZGF0YSl7XHJcbiAgICAgICAgICAgICAgICAgICAgZHJhd0NoYXJ0KHNjb3BlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCB0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59KTtcclxuIiwiYW5ndWxhci5tb2R1bGUoJ2VockRhc2hib2FyZCcpXHJcbiAgICAuZmFjdG9yeShcIkNoYXJ0T3B0aW9uc1wiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGRlZmF1bHRzOiBbXHJcbiAgICAgICAgeyAncHJvcE5hbWUnOiAnbWFyZ2luJywgJ2RlZmF1bHRWYWx1ZSc6IHsgXCJ0b3BcIjogMCwgXCJsZWZ0XCI6IDAsIFwicmlnaHRcIjogMCwgXCJib3R0b21cIjogMCB9IH0sXHJcbiAgICAgICAgeyAncHJvcE5hbWUnOiAnY29sb3JTY2FsZScsICdkZWZhdWx0VmFsdWUnOiBkMy5zY2FsZS5jYXRlZ29yeTEwKCkgfSxcclxuICAgICAgICB7ICdwcm9wTmFtZSc6ICdkcmF3TGVnZW5kJywgJ2RlZmF1bHRWYWx1ZSc6IGZhbHNlIH0sXHJcbiAgICAgICAgeyAncHJvcE5hbWUnOiAnZHJhd1lBeGlzJywgJ2RlZmF1bHRWYWx1ZSc6IGZhbHNlIH0sXHJcbiAgICAgICAgeyAncHJvcE5hbWUnOiAndG9vbHRpcCcsICdkZWZhdWx0VmFsdWUnOiBmYWxzZSB9LFxyXG4gICAgICAgIHsgJ3Byb3BOYW1lJzogJ2RhdGVGb3JtYXQnLCAnZGVmYXVsdFZhbHVlJzogZDMudGltZS5mb3JtYXQoXCIlbS8lZC8lWVwiKSB9LFxyXG4gICAgICAgIHsgJ3Byb3BOYW1lJzogJ3RpY2tGb3JtYXQnLCAnZGVmYXVsdFZhbHVlJzogZDMudGltZS5tb250aCB9LFxyXG4gICAgICAgIHsgJ3Byb3BOYW1lJzogJ3RpY2tTcGFjaW5nJywgJ2RlZmF1bHRWYWx1ZSc6IDEgfSxcclxuICAgICAgICB7ICdwcm9wTmFtZSc6ICdkYXRlQXhpc0Zvcm1hdCcsICdkZWZhdWx0VmFsdWUnOiBkMy50aW1lLmZvcm1hdChcIiVtLSV5XCIpIH0sXHJcbiAgICAgICAgeyAncHJvcE5hbWUnOiAndGltZVVuaXQnLCAnZGVmYXVsdFZhbHVlJzogJ21vbnRoJyB9LFxyXG4gICAgICAgIHsgJ3Byb3BOYW1lJzogJ21pbicsICdkZWZhdWx0VmFsdWUnOiAnbWluJyB9LFxyXG4gICAgICAgIHsgJ3Byb3BOYW1lJzogJ21heCcsICdkZWZhdWx0VmFsdWUnOiAnbWF4JyB9LFxyXG4gICAgICAgIHsgJ3Byb3BOYW1lJzogJ3lTY2FsZUxhYmVsJywgJ2RlZmF1bHRWYWx1ZSc6ICcnIH0sXHJcbiAgICAgICAgeyAncHJvcE5hbWUnOiAndGl0bGUnLCAnZGVmYXVsdFZhbHVlJzogJycgfSxcclxuICAgICAgICB7ICdwcm9wTmFtZSc6ICdvbkNsaWNrJywgJ2RlZmF1bHRWYWx1ZSc6ICcnIH0sXHJcbiAgICAgICAgXSxcclxuICAgICAgICBnZW5lcmF0ZU9wdGlvbnM6IGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcbiAgICAgICAgICAgIHZhciBjb250cm9scyA9IG9wdGlvbnMgPyBvcHRpb25zIDoge307XHJcbiAgICAgICAgICAgIHRoaXMuZGVmYXVsdHMuZm9yRWFjaChmdW5jdGlvbiAoZCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFjb250cm9scy5oYXNPd25Qcm9wZXJ0eShkLnByb3BOYW1lKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xzW2QucHJvcE5hbWVdID0gZC5kZWZhdWx0VmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gY29udHJvbHM7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufSk7XHJcbiIsIi8vQWRkcyB0byBhcnJheSBwcm90b3R5cGUgdG8gYWRkIGZpbHRlciBhbmQgYWdncmVnYXRlIG9wdGlvbnMgZm9yIGRhc2hib2FyZFxyXG5cclxuQXJyYXkucHJvdG90eXBlLmdyb3VwQnlBbmRTdW0gPSBmdW5jdGlvbiAoZ3JvdXBCeSwgdW5pdCkge1xyXG4gICAgdmFyIGdyb3VwID0gXy5ncm91cEJ5KHRoaXMsIGdyb3VwQnkpO1xyXG4gICAgcmV0dXJuIF8ubWFwKGdyb3VwLCBmdW5jdGlvbiAoZywga2V5KSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZ3JvdXA6IGtleSxcclxuICAgICAgICAgICAgdW5pdDogcG1kQ2FsY0hlbHBlcnMuc3VtKGcsIHVuaXQpXHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG59O1xyXG4iLCJhbmd1bGFyLm1vZHVsZShcImVockRhc2hib2FyZFwiKVxyXG4gICAgLmRpcmVjdGl2ZShcImJhckNoYXJ0XCIsIGZ1bmN0aW9uIChCYXJPcHRpb25zKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIGRhdGE6ICc9JyxcclxuICAgICAgICAgICAgICAgIG9wdGlvbnM6ICc9JyxcclxuICAgICAgICAgICAgICAgIGdyb3VwOiAnPScsXHJcbiAgICAgICAgICAgICAgICB1bml0OiAnPScsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvbmZpZyA9IEJhck9wdGlvbnMuZ2VuZXJhdGVPcHRpb25zKHNjb3BlLm9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgY29uZmlnLm1hcmdpbi5sZWZ0ID0gMjUwO1xyXG4gICAgICAgICAgICAgICAgdmFyIHcsIGg7XHJcbiAgICAgICAgICAgICAgICB2YXIgeSA9IHNjb3BlLmdyb3VwIHx8ICdncm91cCc7XHJcbiAgICAgICAgICAgICAgICB2YXIgeCA9IHNjb3BlLnVuaXQgfHwgJ3VuaXQnO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRyYXduID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB2YXIgYmFyVGlwO1xyXG4gICAgICAgICAgICAgICAgdmFyIHN2ZztcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgY3JlYXRlQ2hhcnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdyA9IGNvbmZpZy53aWR0aCA/IGNvbmZpZy53aWR0aCA6IGVsZW1bMF0ub2Zmc2V0V2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgaCA9IGNvbmZpZy5oZWlnaHQgPyBjb25maWcuaGVpZ2h0IDogZWxlbVswXS5vZmZzZXRIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaCA9IDE4NTtcclxuICAgICAgICAgICAgICAgICAgICBzdmcgPSBkMy5zZWxlY3QoZWxlbVswXSkuYXBwZW5kKFwic3ZnXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgdykuYXR0cihcImhlaWdodFwiLCBoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc3ZnLmFwcGVuZChcInRleHRcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwidGl0bGVcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR4XCIsIHcgLyAyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZHlcIiwgMTApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIDEwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAudGV4dChjb25maWcuY2hhcnRUaXRsZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHN2Zy5hcHBlbmQoXCJnXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJjaGFydFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZShcIiArIGNvbmZpZy5tYXJnaW4ubGVmdCArIFwiLFwiICsgY29uZmlnLm1hcmdpbi50b3AgKyBcIilcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHN2Zy5zZWxlY3QoXCJnLmNoYXJ0XCIpLmFwcGVuZChcImdcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImF4aXNcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoMCw1KVwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZy50b29sdGlwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZVRvb2xUaXAoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZUNoYXJ0KHNjb3BlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgY3JlYXRlVG9vbFRpcCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBiYXJUaXAgPSBkMy50aXAoKS5hdHRyKCdjbGFzcycsICdkMy10aXAnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAub2Zmc2V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMCwgMl07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5kaXJlY3Rpb24oJ2UnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJ0ZXh0LWFsaWduXCIsIFwiY2VudGVyXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5odG1sKGZ1bmN0aW9uIChkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChkW3hdICogMTAwKSAvIDEwMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgc3ZnLmNhbGwoYmFyVGlwKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHVwZGF0ZUNoYXJ0ID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFbeV0gPCBiW3ldID8gMSAgOiAtMTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHlTY2FsZUhlaWdodCA9IE1hdGgubWF4KGggLSBjb25maWcubWFyZ2luLnRvcCwgZGF0YS5sZW5ndGggKiAxMyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEubGVuZ3RoICogMTMgPiBoIC0gY29uZmlnLm1hcmdpbi50b3ApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3ZnLmF0dHIoXCJoZWlnaHRcIiwgKGRhdGEubGVuZ3RoICogMTMgKyBjb25maWcubWFyZ2luLnRvcCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN2Zy5hdHRyKFwiaGVpZ2h0XCIsIGgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBkMy5zZWxlY3QoZWxlbVswXSkuc3R5bGUoXCJoZWlnaHRcIiwgaCArIFwicHhcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciB4TWF4ID0gY29uZmlnLm1heFggfHwgZDMubWF4KGRhdGEuZmlsdGVyKGZ1bmN0aW9uIChkKSB7IHJldHVybiBkW3hdICE9PSBJbmZpbml0eTsgfSksIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkW3hdOyB9KTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgeFNjYWxlID0gZDMuc2NhbGUubGluZWFyKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmRvbWFpbihbMCwgeE1heF0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yYW5nZShbMCwgKHcgLSBjb25maWcubWFyZ2luLnJpZ2h0IC0gY29uZmlnLm1hcmdpbi5sZWZ0KV0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgeVNjYWxlID0gZDMuc2NhbGUub3JkaW5hbCgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5kb21haW4oZGF0YS5tYXAoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGRbeV07IH0pKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAucmFuZ2VCYW5kcyhbMTAsIHlTY2FsZUhlaWdodCAtIGNvbmZpZy5tYXJnaW4uYm90dG9tXSwgMC4wNSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBiYXJIZWlnaHQgPSB5U2NhbGUucmFuZ2VCYW5kKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciB4QXhpcyA9IGQzLnN2Zy5heGlzKClcclxuICAgICAgICAgICAgICAgICAgICAgICAuc2NhbGUoeFNjYWxlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgIC5vcmllbnQoXCJ0b3BcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb25maWcudGlja051bWJlcnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgeEF4aXMudGlja3MoNSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBzdmcuc2VsZWN0KFwiZy5heGlzXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50cmFuc2l0aW9uKCkuZHVyYXRpb24oNTAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2FsbCh4QXhpcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBiYXJDb250YWluZXIgPSBzdmcuc2VsZWN0KFwiZy5jaGFydFwiKS5zZWxlY3RBbGwoXCJnLmJhcnNcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmRhdGEoZGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGRbeV07IH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBiYXJDb250YWluZXIuZXhpdCgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50cmFuc2l0aW9uKCkuZHVyYXRpb24oNTAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZGVsYXkoZnVuY3Rpb24gKGQsIGkpIHsgcmV0dXJuIGkgKiAyMDsgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoMCxcIiArIChoICsgMjAwKSArIFwiKVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAucmVtb3ZlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBiYXJFbnRlciA9IGJhckNvbnRhaW5lci5lbnRlcigpLmFwcGVuZChcImdcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImJhcnNcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZnVuY3Rpb24gKGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcInRyYW5zbGF0ZSgwLFwiICsgeVNjYWxlKGRbeV0pICsgXCIpXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGJhckVudGVyLmFwcGVuZChcInJlY3RcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImJhclwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInlcIiwgMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJmaWxsXCIsIGZ1bmN0aW9uIChkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlnLmNvbG9yQnkgPT09ICdub25lJyA/IGNvbmZpZy5jb2xvciA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3IoZFtjb25maWcuY29sb3JCeV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAub24oXCJtb3VzZW92ZXJcIiwgYmFyVGlwLnNob3cpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5vbihcIm1vdXNlb3V0XCIsIGJhclRpcC5oaWRlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYmFyRW50ZXIuYXBwZW5kKFwidGV4dFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiYmFyLWxhYmVsXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJlbmRcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJmb250LXNpemVcIiwgXCIxMlwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR4XCIsIC0xKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIFwiLjM1ZW1cIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGJhckNvbnRhaW5lci5zZWxlY3QoXCJyZWN0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50cmFuc2l0aW9uKCkuZHVyYXRpb24oNTAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIGZ1bmN0aW9uIChkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZFt4XSA9PT0gSW5maW5pdHkgPyAwIDogeFNjYWxlKGRbeF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCBiYXJIZWlnaHQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBiYXJDb250YWluZXIuc2VsZWN0KFwidGV4dC5iYXItbGFiZWxcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oKS5kdXJhdGlvbig1MDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieVwiLCBiYXJIZWlnaHQgLyAyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGV4dChmdW5jdGlvbiAoZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRbeV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBiYXJDb250YWluZXIudHJhbnNpdGlvbigpLmR1cmF0aW9uKDEwMDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIFwidHJhbnNsYXRlKDAsXCIgKyB5U2NhbGUoZFt5XSkgKyBcIilcIjsgfSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnZGF0YScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWRyYXduKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgY3JlYXRlQ2hhcnQoKTsgfSwgMjUwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZUNoYXJ0KHNjb3BlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyYXduID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCB0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbn0pO1xyXG4iLCJhbmd1bGFyLm1vZHVsZShcImVockRhc2hib2FyZFwiKVxyXG4gICAgLmZhY3RvcnkoXCJCYXJPcHRpb25zXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBkZWZhdWx0czogW1xyXG4gICAgICAgICAgICB7ICdwcm9wTmFtZSc6ICdtYXJnaW4nLCAnZGVmYXVsdFZhbHVlJzogeyBcInRvcFwiOiA1MCwgXCJsZWZ0XCI6IDEwMCwgXCJyaWdodFwiOiAxNTAsIFwiYm90dG9tXCI6IDUwIH0gfSxcclxuICAgICAgICAgICAgeyAncHJvcE5hbWUnOiAnY2hhcnRUaXRsZScsICdkZWZhdWx0VmFsdWUnOiBcIlwifSxcclxuICAgICAgICAgICAgeyAncHJvcE5hbWUnOiAnY29sb3InLCAnZGVmYXVsdFZhbHVlJzogJ3N0ZWVsYmx1ZScgfSxcclxuICAgICAgICAgICAgeyAncHJvcE5hbWUnOiAnY29sb3JCeScsICdkZWZhdWx0VmFsdWUnOiAnbm9uZScgfSxcclxuICAgICAgICAgICAgeyAncHJvcE5hbWUnOiAndG9vbHRpcCcsICdkZWZhdWx0VmFsdWUnOiB0cnVlIH0sXHJcbiAgICAgICAgICAgIHsgJ3Byb3BOYW1lJzogJ2ZpdFRvSGVpZ2h0JywgJ2RlZmF1bHRWYWx1ZSc6IHRydWUgfSxcclxuICAgICAgICAgICAgeyAncHJvcE5hbWUnOiAndGlja051bWJlcnMnLCAnZGVmYXVsdFZhbHVlJzogbnVsbCB9LFxyXG4gICAgICAgICAgICB7ICdwcm9wTmFtZSc6ICd3aWR0aCcsICdkZWZhdWx0VmFsdWUnOiBudWxsIH0sXHJcbiAgICAgICAgICAgIHsgJ3Byb3BOYW1lJzogJ2hlaWdodCcsICdkZWZhdWx0VmFsdWUnOiBudWxsIH0sXHJcbiAgICAgICAgICAgIHsgJ3Byb3BOYW1lJzogJ21heFgnLCAnZGVmYXVsdFZhbHVlJzogbnVsbCB9XHJcbiAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgIGdlbmVyYXRlT3B0aW9uczogZnVuY3Rpb24gKG9wdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjb250cm9scyA9IG9wdGlvbnMgPyBvcHRpb25zIDoge307XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRlZmF1bHRzLmZvckVhY2goZnVuY3Rpb24gKGQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbnRyb2xzLmhhc093blByb3BlcnR5KGQucHJvcE5hbWUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xzW2QucHJvcE5hbWVdID0gZC5kZWZhdWx0VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29udHJvbHM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG59KTtcclxuIiwiYW5ndWxhci5tb2R1bGUoJ2VockRhc2hib2FyZCcpXHJcbiAgICAuZGlyZWN0aXZlKFwiZ3JvdXBCYXJcIiwgZnVuY3Rpb24gKCRsb2NhdGlvbikge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgIHRlbXBsYXRlTmFtZVNwYWNlOiAnc3ZnJyxcclxuICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW0pIHtcclxuICAgICAgICAgICAgdmFyIGNyZWF0ZUNoYXJ0ID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBtYXJnaW4gPSB7IHRvcDogMTAsIHJpZ2h0OiAyMCwgYm90dG9tOiA4MCwgbGVmdDogNDAgfTtcclxuICAgICAgICAgICAgICAgIHZhciB3aWR0aCA9IGVsZW1bMF0ub2Zmc2V0V2lkdGggLSBtYXJnaW4ucmlnaHQgLSBtYXJnaW4ubGVmdDtcclxuICAgICAgICAgICAgICAgIHZhciBoZWlnaHQgPSBlbGVtWzBdLm9mZnNldEhlaWdodCAtIG1hcmdpbi50b3AgLSBtYXJnaW4uYm90dG9tO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHdpZHRoLCBoZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHgwID0gZDMuc2NhbGUub3JkaW5hbCgpXHJcbiAgICAgICAgICAgICAgICAgICAgLnJhbmdlUm91bmRCYW5kcyhbMCwgd2lkdGhdLCAwLjEpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB4MSA9IGQzLnNjYWxlLm9yZGluYWwoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgeSA9IGQzLnNjYWxlLmxpbmVhcigpXHJcbiAgICAgICAgICAgICAgICAgICAgLnJhbmdlKFtoZWlnaHQsIDBdKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgY29sb3IgPSBkMy5zY2FsZS5vcmRpbmFsKClcclxuICAgICAgICAgICAgICAgICAgICAucmFuZ2UoW1wicmVkXCIsIFwiYmx1ZVwiLCBcInB1cnBsZVwiXSlcclxuICAgICAgICAgICAgICAgICAgICAuZG9tYWluKFtcIk92ZXJoZWFkXCIsIFwiQmlsbGFibGVcIiwgXCJQcm9wb3NhbFwiXSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHhBeGlzID0gZDMuc3ZnLmF4aXMoKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zY2FsZSh4MClcclxuICAgICAgICAgICAgICAgICAgICAub3JpZW50KFwiYm90dG9tXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB5QXhpcyA9IGQzLnN2Zy5heGlzKClcclxuICAgICAgICAgICAgICAgICAgICAuc2NhbGUoeSlcclxuICAgICAgICAgICAgICAgICAgICAub3JpZW50KFwibGVmdFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aWNrRm9ybWF0KGQzLmZvcm1hdChcIi4yc1wiKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHN2ZyA9IGQzLnNlbGVjdChlbGVtWzBdKS5hcHBlbmQoXCJzdmdcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIHdpZHRoICsgbWFyZ2luLmxlZnQgKyBtYXJnaW4ucmlnaHQpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgaGVpZ2h0ICsgbWFyZ2luLnRvcCArIG1hcmdpbi5ib3R0b20pXHJcbiAgICAgICAgICAgICAgICAgIC5hcHBlbmQoXCJnXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoXCIgKyBtYXJnaW4ubGVmdCArIFwiLFwiICsgbWFyZ2luLnRvcCArIFwiKVwiKTtcclxuICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0gXy51bmlxKF8ucGx1Y2soZGF0YSwgJ2NoYXJnZVR5cGUnKSkuc29ydCgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGdyb3VwQnlQZXJzb24gPSBfLmdyb3VwQnkoZGF0YSwgJ2VtcGxveWVlJyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgZ3JvdXBlZERhdGEgPSBfLm1hcChncm91cEJ5UGVyc29uLCBmdW5jdGlvbiAoZCwga2V5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZToga2V5LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbXBJZDogZFswXS5lbXBJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZFxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICB4MC5kb21haW4oZ3JvdXBlZERhdGEubWFwKGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLm5hbWU7IH0pKTtcclxuICAgICAgICAgICAgICAgIHgxLmRvbWFpbihvcHRpb25zKS5yYW5nZVJvdW5kQmFuZHMoWzAsIHgwLnJhbmdlQmFuZCgpXSk7XHJcbiAgICAgICAgICAgICAgICB5LmRvbWFpbihbMCwgZDMubWF4KGdyb3VwZWREYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZDMubWF4KGQuZGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuaG91cnM7IH0pOyB9KV0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHN2Zy5hcHBlbmQoXCJnXCIpXHJcbiAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ4IGF4aXNcIilcclxuICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoMCxcIiArIGhlaWdodCArIFwiKVwiKVxyXG4gICAgICAgICAgICAgICAgICAuY2FsbCh4QXhpcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgc3ZnLmFwcGVuZChcImdcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwieSBheGlzXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoeUF4aXMpXHJcbiAgICAgICAgICAgICAgICAgIC5hcHBlbmQoXCJ0ZXh0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJyb3RhdGUoLTkwKVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieVwiLCA2KVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZHlcIiwgXCIuNzFlbVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInRleHQtYW5jaG9yXCIsIFwiZW5kXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRleHQoXCJIb3Vyc1wiKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgc3RhdGUgPSBzdmcuc2VsZWN0QWxsKFwiLnN0YXRlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmRhdGEoZ3JvdXBlZERhdGEpXHJcbiAgICAgICAgICAgICAgICAgIC5lbnRlcigpLmFwcGVuZChcImdcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBcInRyYW5zbGF0ZShcIiArIHgwKGQubmFtZSkgKyBcIiwwKVwiOyB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5vbihcImNsaWNrXCIsIGZ1bmN0aW9uIChkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGQuZW1wSWQsIGQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCJ0aW1lc2hlZXQvXCIgKyBkLmVtcElkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc3RhdGUuc2VsZWN0QWxsKFwicmVjdFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5kYXRhKGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmRhdGE7IH0pXHJcbiAgICAgICAgICAgICAgICAgIC5lbnRlcigpLmFwcGVuZChcInJlY3RcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIHgxLnJhbmdlQmFuZCgpKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieFwiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4geDEoZC5jaGFyZ2VUeXBlKTsgfSlcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInlcIiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIHkoZC5ob3Vycyk7IH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGhlaWdodCAtIHkoZC5ob3Vycyk7IH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwiZmlsbFwiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gY29sb3IoZC5jaGFyZ2VUeXBlKTsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGxlZ2VuZCA9IHN2Zy5zZWxlY3RBbGwoXCIubGVnZW5kXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmRhdGEob3B0aW9ucy5zbGljZSgpLnJldmVyc2UoKSlcclxuICAgICAgICAgICAgICAgICAgLmVudGVyKCkuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJsZWdlbmRcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBmdW5jdGlvbiAoZCwgaSkgeyByZXR1cm4gXCJ0cmFuc2xhdGUoMCxcIiArIGkgKiAyMCArIFwiKVwiOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBsZWdlbmQuYXBwZW5kKFwicmVjdFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieFwiLCB3aWR0aCAtIDE4KVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgMTgpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgMTgpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwiZmlsbFwiLCBjb2xvcik7XHJcblxyXG4gICAgICAgICAgICAgICAgbGVnZW5kLmFwcGVuZChcInRleHRcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInhcIiwgd2lkdGggLSAyNClcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInlcIiwgOSlcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIFwiLjM1ZW1cIilcclxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJ0ZXh0LWFuY2hvclwiLCBcImVuZFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uIChkKSB7IHJldHVybiBkOyB9KTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnYmlsbGluZ0RhdGEnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuYmlsbGluZ0RhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgY3JlYXRlQ2hhcnQoc2NvcGUuYmlsbGluZ0RhdGEpOyB9LCAxMDApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCB0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59KTtcclxuIiwiYW5ndWxhci5tb2R1bGUoJ2VockRhc2hib2FyZCcpXHJcbiAgICAuZGlyZWN0aXZlKFwic3RhY2tCYXJDaGFydFwiLCBmdW5jdGlvbiAoJHRpbWVvdXQsIENoYXJ0T3B0aW9ucykge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICBkYXRhOiAnPScsXHJcbiAgICAgICAgICAgICAgICBvcHRpb25zOiAnPScsXHJcbiAgICAgICAgICAgICAgICBkYXRlOiAnPScsXHJcbiAgICAgICAgICAgICAgICBncm91cDogJz0nLFxyXG4gICAgICAgICAgICAgICAgdW5pdDogJz0nXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHN0YWNrQmFyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdmcsIGNoYXJ0LCB3aWR0aCwgaGVpZ2h0LCB5QXhpcztcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY29uZmlnID0gQ2hhcnRPcHRpb25zLmdlbmVyYXRlT3B0aW9ucyhzY29wZS5vcHRpb25zKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY29sb3IgPSBjb25maWcuY29sb3JTY2FsZTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdG9vbFRpcDtcclxuICAgICAgICAgICAgICAgICAgICAvL3ZhciBmb3JtYXREYXRlID0gY29uZmlnLmRhdGVGb3JtYXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHVuaXQgPSBzY29wZS51bml0O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRlID0gc2NvcGUuZGF0ZTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZ3JvdXAgPSBzY29wZS5ncm91cDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RhY2sgPSBkMy5sYXlvdXQuc3RhY2soKVxyXG4gICAgICAgICAgICAgICAgICAgICAgIC52YWx1ZXMoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQudmFsdWVzOyB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgIC54KGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLnJlYWxEYXRlOyB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgIC55KGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLnVuaXQ7IH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgbWFyZ2luID0gY29uZmlnLm1hcmdpbjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRyYXdZQXhpcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hhcnQuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInkgYXhpc1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoNTAsMClcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYWxsKHlBeGlzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoXCJ0ZXh0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInJvdGF0ZSgtOTApXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInlcIiwgLTQ1KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkeFwiLCAtKGhlaWdodCAtIDEwMCkgLyAyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkeVwiLCBcIi43MWVtXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRleHQoY29uZmlnLnlTY2FsZUxhYmVsKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgZHJhd0xlZ2VuZCA9IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vTGVnZW5kXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvbmx5VmFsdWVzID0gZGF0YS5maWx0ZXIoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQudW5pdCAhPT0gMDsgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsZWdlbmQgPSBjaGFydC5zZWxlY3RBbGwoXCIubGVnZW5kXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZGF0YShfLnVuaXEoXy5wbHVjayhvbmx5VmFsdWVzLCAnZ3JvdXAnKSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgLmVudGVyKCkuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImxlZ2VuZFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZnVuY3Rpb24gKGQsIGkpIHsgcmV0dXJuIFwidHJhbnNsYXRlKDAsXCIgKyBpICogMjAgKyBcIilcIjsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZWdlbmQuYXBwZW5kKFwicmVjdFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ4XCIsIHdpZHRoIC0gNzIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIDE4KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgMTgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsIGNvbG9yKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZ2VuZC5hcHBlbmQoXCJ0ZXh0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInhcIiwgd2lkdGggLSA5NilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieVwiLCA5KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkeVwiLCBcIi4zNWVtXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJ0ZXh0LWFuY2hvclwiLCBcImVuZFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRleHQoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQ7IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjcmVhdGVUb29sVGlwID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0b29sVGlwID0gZDMudGlwKCkuYXR0cignY2xhc3MnLCAnZDMtdGlwJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vZmZzZXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbY29uZmlnLnRvb2xUaXBBZGp1c3RUb3AsIDBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5kaXJlY3Rpb24oJ2UnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwidGV4dC1hbGlnblwiLCBcImNlbnRlclwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmh0bWwoZnVuY3Rpb24gKGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC5ncm91cCArIFwiPGJyIC8+IFwiICsgZC51bml0ICsgXCIgXCIgKyBjb25maWcudG9vbFRpcFVuaXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3ZnLmNhbGwodG9vbFRpcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNyZWF0ZUNoYXJ0ID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGRhdGEubWFwKGZ1bmN0aW9uIChkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuaXQ6IGRbdW5pdF0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZTogZFtkYXRlXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cDogZFtncm91cF0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhbERhdGU6IG5ldyBtb21lbnQoZFtkYXRlXSkuX2RcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGVzID0gXy51bmlxKGRhdGEubWFwKGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmRhdGU7IH0pKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNhdGVnb3JpZXMgPSBfLnVuaXEoZGF0YS5tYXAoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuZ3JvdXA7IH0pKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVzLmZvckVhY2goZnVuY3Rpb24gKGRhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGVnb3JpZXMuZm9yRWFjaChmdW5jdGlvbiAoY2F0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1hdGNoID0gXy5maW5kKGRhdGEsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmRhdGUgPT09IGRhdGUgJiYgZC5ncm91cCA9PT0gY2F0OyB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW1hdGNoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkdW1teSA9IHsgdW5pdDogMCwgZ3JvdXA6IGNhdCwgcmVhbERhdGU6IG5ldyBtb21lbnQoZGF0ZSkuX2QsIGRhdGU6IGRhdGUgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5wdXNoKGR1bW15KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gXy5zb3J0QnkoZGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQucmVhbERhdGU7IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gXy5zb3J0QnkoZGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuZ3JvdXA7IH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGdyb3VwcyA9IGQzLm5lc3QoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmtleShmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5ncm91cDsgfSkuZW50cmllcyhkYXRhKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXlzID0gc3RhY2soZ3JvdXBzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGggPSBlbGVtWzBdLm9mZnNldFdpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQgPSBjb25maWcuaGVpZ2h0ID8gY29uZmlnLmhlaWdodCA6IGVsZW1bMF0ub2Zmc2V0SGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2hhcnRIZWlnaHQgPSBoZWlnaHQgLSBtYXJnaW4uYm90dG9tO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgc3ZnID0gZDMuc2VsZWN0KGVsZW1bMF0pLmFwcGVuZChcInN2Z1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInN2Zy1jaGFydFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCB3aWR0aCkuYXR0cihcImhlaWdodFwiLCBoZWlnaHQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hhcnQgPSBzdmcuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImNoYXJ0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSgwLDApXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAub24oXCJtb3VzZW92ZXJcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdCh0aGlzKS5zZWxlY3RBbGwoXCIudG8tc2hvd1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudHJhbnNpdGlvbigpLmR1cmF0aW9uKDUwMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAub24oXCJtb3VzZW91dFwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0KHRoaXMpLnNlbGVjdEFsbChcIi50by1zaG93XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50cmFuc2l0aW9uKCkuZHVyYXRpb24oNTAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGFydC5hcHBlbmQoXCJ0ZXh0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwidGl0bGUgdG8tc2hvd1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkeFwiLCB3aWR0aCAvIDIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIG1hcmdpbi50b3AgLSAxMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCAxMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50ZXh0KGNvbmZpZy50aXRsZVRleHQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDApO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHhTY2FsZSA9IGQzLnNjYWxlLm9yZGluYWwoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJhbmdlUm91bmRCYW5kcyhbbWFyZ2luLmxlZnQsIHdpZHRoIC0gbWFyZ2luLnJpZ2h0XSwgMC4wOClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5kb21haW4oXy51bmlxKGRhdGEubWFwKGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLnJlYWxEYXRlOyB9KSkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1pbiA9IHR5cGVvZiAoY29uZmlnLm1pbikgPT09ICdudW1iZXInID8gY29uZmlnLm1pbiA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkMy5taW4oZGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQudW5pdDsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG90YWxzID0gXy5tYXAoXy5ncm91cEJ5KGRhdGEsICdkYXRlJyksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZGF0YSkgeyByZXR1cm4gXy5yZWR1Y2UoZGF0YSwgZnVuY3Rpb24gKG0sIHgpIHsgcmV0dXJuIG0gKyB4LnVuaXQ7IH0sIDApOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtYXggPSB0eXBlb2YgKGNvbmZpZy5tYXgpID09PSAnbnVtYmVyJyA/IGNvbmZpZy5tYXggOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZDMubWF4KHRvdGFscywgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQ7IH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHlTY2FsZSA9IGQzLnNjYWxlLmxpbmVhcigpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmFuZ2UoW2NoYXJ0SGVpZ2h0LCBtYXJnaW4udG9wXSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5kb21haW4oW21pbiwgbWF4XSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgeEF4aXMgPSBkMy5zdmcuYXhpcygpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2NhbGUoeFNjYWxlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRpY2tGb3JtYXQoY29uZmlnLmRhdGVBeGlzRm9ybWF0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLm9yaWVudChcImJvdHRvbVwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHlBeGlzID0gZDMuc3ZnLmF4aXMoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNjYWxlKHlTY2FsZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vcmllbnQoXCJsZWZ0XCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hhcnQuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInggYXhpcyB0by1zaG93XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSgwLFwiICsgKGhlaWdodCAtIG1hcmdpbi5ib3R0b20gLSA1KSArIFwiKVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhbGwoeEF4aXMpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIGEgZ3JvdXAgZm9yIGVhY2ggY2F1c2UuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiYXJDb250ID0gY2hhcnQuc2VsZWN0QWxsKFwiZy5kYXlcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5kYXRhKGRheXMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgLmVudGVyKCkuYXBwZW5kKFwic3ZnOmdcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJkYXlcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcImZpbGxcIiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGNvbG9yKGQua2V5KTsgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZVwiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZDMucmdiKGNvbG9yKGQua2V5KSkuZGFya2VyKCk7IH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIGEgcmVjdCBmb3IgZWFjaCBkYXRlLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBiYXJDb250LnNlbGVjdEFsbChcInJlY3RcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5kYXRhKGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLnZhbHVlczsgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAuZW50ZXIoKS5hcHBlbmQoXCJzdmc6cmVjdFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ4XCIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiB4U2NhbGUoZC5yZWFsRGF0ZSk7IH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInlcIiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIHlTY2FsZShkLnkpIC0gKChjaGFydEhlaWdodCkgLSB5U2NhbGUoZC55MCkpOyB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIChjaGFydEhlaWdodCkgLSB5U2NhbGUoZC55KTsgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgeFNjYWxlLnJhbmdlQmFuZCgpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLm9uKCdtb3VzZW92ZXInLCBmdW5jdGlvbiAoZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xUaXAuc2hvdyhkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAub24oJ21vdXNlb3V0JywgZnVuY3Rpb24gKGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b29sVGlwLmhpZGUoZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZVRvb2xUaXAoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5kcmF3WUF4aXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYXdZQXhpcyhkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnLmRyYXdMZWdlbmQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYXdMZWdlbmQoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goJ2RhdGEnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5kYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgY3JlYXRlQ2hhcnQoc2NvcGUuZGF0YSk7IH0sIDI1MCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9LCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAkdGltZW91dChzdGFja0JhciwgMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcbiIsImFuZ3VsYXIubW9kdWxlKFwiZWhyRGFzaGJvYXJkXCIpXHJcbiAgICAuZGlyZWN0aXZlKFwidkJhckNoYXJ0XCIsIGZ1bmN0aW9uIChCYXJPcHRpb25zKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIGRhdGE6ICc9JyxcclxuICAgICAgICAgICAgICAgIG9wdGlvbnM6ICc9JyxcclxuICAgICAgICAgICAgICAgIGdyb3VwOiAnPScsXHJcbiAgICAgICAgICAgICAgICB1bml0OiAnPScsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvbmZpZyA9IEJhck9wdGlvbnMuZ2VuZXJhdGVPcHRpb25zKHNjb3BlLm9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHcsIGg7XHJcbiAgICAgICAgICAgICAgICB2YXIgeSA9IHNjb3BlLmdyb3VwIHx8ICdncm91cCc7XHJcbiAgICAgICAgICAgICAgICB2YXIgeCA9IHNjb3BlLnVuaXQgfHwgJ3VuaXQnO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRyYXduID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB2YXIgYmFyVGlwO1xyXG4gICAgICAgICAgICAgICAgdmFyIHN2ZztcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgY3JlYXRlQ2hhcnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdyA9IGNvbmZpZy53aWR0aCA/IGNvbmZpZy53aWR0aCA6IGVsZW1bMF0ub2Zmc2V0V2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgaCA9IGNvbmZpZy5oZWlnaHQgPyBjb25maWcuaGVpZ2h0IDogZWxlbVswXS5vZmZzZXRIZWlnaHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHN2ZyA9IGQzLnNlbGVjdChlbGVtWzBdKS5hcHBlbmQoXCJzdmdcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCB3KS5hdHRyKFwiaGVpZ2h0XCIsIGgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzdmcuYXBwZW5kKFwidGV4dFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ0aXRsZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZHhcIiwgdyAvIDIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkeVwiLCAxMClcclxuICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgMTApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgIC50ZXh0KGNvbmZpZy5jaGFydFRpdGxlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc3ZnLmFwcGVuZChcImdcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImNoYXJ0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKFwiICsgY29uZmlnLm1hcmdpbi5sZWZ0ICsgXCIsXCIgKyBjb25maWcubWFyZ2luLnRvcCArIFwiKVwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc3ZnLnNlbGVjdChcImcuY2hhcnRcIikuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwieC1heGlzXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKDAsNSlcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb25maWcudG9vbHRpcCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVUb29sVGlwKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVDaGFydChzY29wZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGNyZWF0ZVRvb2xUaXAgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYmFyVGlwID0gZDMudGlwKCkuYXR0cignY2xhc3MnLCAnZDMtdGlwJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgLm9mZnNldChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzAsIDJdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZGlyZWN0aW9uKCdlJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwidGV4dC1hbGlnblwiLCBcImNlbnRlclwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuaHRtbChmdW5jdGlvbiAoZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoZFt4XSAqIDEwMCkgLyAxMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHN2Zy5jYWxsKGJhclRpcCk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB1cGRhdGVDaGFydCA9IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhW3ldIDwgYlt5XSA/IDEgOiAtMTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHlTY2FsZUhlaWdodCA9IE1hdGgubWF4KGggLSBjb25maWcubWFyZ2luLnRvcCwgZGF0YS5sZW5ndGggKiAxMyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmxlbmd0aCAqIDEzID4gaCAtIGNvbmZpZy5tYXJnaW4udG9wKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN2Zy5hdHRyKFwiaGVpZ2h0XCIsIChkYXRhLmxlbmd0aCAqIDEzICsgY29uZmlnLm1hcmdpbi50b3ApKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN2Zy5hdHRyKFwiaGVpZ2h0XCIsIGgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBkMy5zZWxlY3QoZWxlbVswXSkuc3R5bGUoXCJoZWlnaHRcIiwgaCArIFwicHhcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciB4TWF4ID0gY29uZmlnLm1heFggfHwgZDMubWF4KGRhdGEuZmlsdGVyKGZ1bmN0aW9uIChkKSB7IHJldHVybiBkW3hdICE9PSBJbmZpbml0eTsgfSksIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkW3hdOyB9KTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgeFNjYWxlID0gZDMuc2NhbGUubGluZWFyKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmRvbWFpbihbMCwgeE1heF0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yYW5nZShbMCwgKHcgLSBjb25maWcubWFyZ2luLnJpZ2h0IC0gY29uZmlnLm1hcmdpbi5sZWZ0KV0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgeVNjYWxlID0gZDMuc2NhbGUub3JkaW5hbCgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5kb21haW4oZGF0YS5tYXAoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGRbeV07IH0pKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAucmFuZ2VCYW5kcyhbMTAsIHlTY2FsZUhlaWdodCAtIGNvbmZpZy5tYXJnaW4uYm90dG9tXSwgMC4wNSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBiYXJIZWlnaHQgPSB5U2NhbGUucmFuZ2VCYW5kKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciB4QXhpcyA9IGQzLnN2Zy5heGlzKClcclxuICAgICAgICAgICAgICAgICAgICAgICAuc2NhbGUoeFNjYWxlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgIC5vcmllbnQoXCJ0b3BcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb25maWcudGlja051bWJlcnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgeEF4aXMudGlja3MoNSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL3N2Zy5zZWxlY3QoXCJnLngtYXhpc1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgIC50cmFuc2l0aW9uKCkuZHVyYXRpb24oNTAwKVxyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgIC5jYWxsKHhBeGlzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSwgeSwgeCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBiYXJDb250YWluZXIgPSBzdmcuc2VsZWN0KFwiZy5jaGFydFwiKS5zZWxlY3RBbGwoXCJnLmJhcnNcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmRhdGEoZGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGRbeV07IH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBiYXJDb250YWluZXIuZXhpdCgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50cmFuc2l0aW9uKCkuZHVyYXRpb24oNTAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZGVsYXkoZnVuY3Rpb24gKGQsIGkpIHsgcmV0dXJuIGkgKiAyMDsgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoMCxcIiArIChoICsgMjAwKSArIFwiKVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAucmVtb3ZlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBiYXJFbnRlciA9IGJhckNvbnRhaW5lci5lbnRlcigpLmFwcGVuZChcImdcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImJhcnNcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZnVuY3Rpb24gKGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcInRyYW5zbGF0ZSgwLFwiICsgeVNjYWxlKGRbeV0pICsgXCIpXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGJhckVudGVyLmFwcGVuZChcInJlY3RcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImJhclwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInlcIiwgMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJmaWxsXCIsIGZ1bmN0aW9uIChkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlnLmNvbG9yQnkgPT09ICdub25lJyA/IGNvbmZpZy5jb2xvciA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3IoZFtjb25maWcuY29sb3JCeV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAub24oXCJtb3VzZW92ZXJcIiwgYmFyVGlwLnNob3cpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5vbihcIm1vdXNlb3V0XCIsIGJhclRpcC5oaWRlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYmFyRW50ZXIuYXBwZW5kKFwidGV4dFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiYmFyLWxhYmVsXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJlbmRcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJmb250LXNpemVcIiwgXCIxMlwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR4XCIsIC0xKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIFwiLjM1ZW1cIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGJhckNvbnRhaW5lci5zZWxlY3QoXCJyZWN0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50cmFuc2l0aW9uKCkuZHVyYXRpb24oNTAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIGZ1bmN0aW9uIChkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZFt4XSA9PT0gSW5maW5pdHkgPyAwIDogeFNjYWxlKGRbeF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCBiYXJIZWlnaHQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBiYXJDb250YWluZXIuc2VsZWN0KFwidGV4dC5iYXItbGFiZWxcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oKS5kdXJhdGlvbig1MDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieVwiLCBiYXJIZWlnaHQgLyAyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGV4dChmdW5jdGlvbiAoZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRbeV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBiYXJDb250YWluZXIudHJhbnNpdGlvbigpLmR1cmF0aW9uKDEwMDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIFwidHJhbnNsYXRlKDAsXCIgKyB5U2NhbGUoZFt5XSkgKyBcIilcIjsgfSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnZGF0YScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWRyYXduKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgY3JlYXRlQ2hhcnQoKTsgfSwgMjUwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZUNoYXJ0KHNjb3BlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyYXduID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCB0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxuIiwiYW5ndWxhci5tb2R1bGUoJ2VockRhc2hib2FyZCcpXHJcbiAgICAuZGlyZWN0aXZlKFwiYnVsbGV0Q2hhcnRcIiwgZnVuY3Rpb24gKCR0aW1lb3V0KSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIGRhdGE6ICc9JyxcclxuICAgICAgICAgICAgICAgIG91dGVyUHJvcDogJz0nLFxyXG4gICAgICAgICAgICAgICAgaW5uZXJQcm9wOiAnPScsXHJcbiAgICAgICAgICAgICAgICBncm91cEJ5OiAnPScsXHJcbiAgICAgICAgICAgICAgICBmaWx0ZXI6ICc9J1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW0pIHtcclxuICAgICAgICAgICAgICAgIHZhciBidWxsZXRDaGFydCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBkaXJlY3RpdmUgdmFyaWFibGVzXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN2ZywgeVNjYWxlLCBjaGFydCwgeFNjYWxlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvdXRlclByb3AgPSBcInN0YWZmZWRcIjtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaW5uZXJQcm9wID0gXCJjaGFyZ2VcIjtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZ3JvdXAgPSBcInByb2plY3RcIjtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZHJhd24gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbW9udGhzQmFjayA9IDA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzZXRUaXRsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG15RGF0ZSA9IG5ldyBtb21lbnQoKS5zdWJ0cmFjdChcIm1vbnRoXCIsIG1vbnRoc0JhY2spLmZvcm1hdCgnTU1NTScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGFydC5zZWxlY3QoXCIudGl0bGVcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50ZXh0KG15RGF0ZSArIFwiIFByb2plY3QgVmFyaWFuY2VcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNyZWF0ZUNoYXJ0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdXAgdGhlIGxlZnQgc2lkZSBtYXJnaW46XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtYXJnaW4gPSB7IHRvcDogMTUsIHJpZ2h0OiA1MCwgYm90dG9tOiAyMCwgbGVmdDogNDAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHcgPSBlbGVtWzBdLm9mZnNldFdpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaCA9IGVsZW1bMF0ub2Zmc2V0SGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdmcgPSBkMy5zZWxlY3QoZWxlbVswXSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoXCJzdmdcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIHcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAub24oXCJtb3VzZW92ZXJcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdCh0aGlzKS5zZWxlY3RBbGwoXCIudG8tc2hvd1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oKS5kdXJhdGlvbig1MDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vbihcIm1vdXNlb3V0XCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkMy5zZWxlY3QodGhpcykuc2VsZWN0QWxsKFwiLnRvLXNob3dcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oKS5kdXJhdGlvbig1MDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJ0ID0gc3ZnLmFwcGVuZChcImdcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKFwiICsgbWFyZ2luLmxlZnQgKyBcIixcIiArICgwKSArIFwiKVwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJ0LmFwcGVuZChcInRleHRcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJiYWNrd2FyZCB0by1zaG93XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR4XCIsIC0xMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZHlcIiwgbWFyZ2luLnRvcCAtIDUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgMTApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGV4dCgnPCcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJjdXJzb3JcIiwgXCJwb2ludGVyXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuZmlsdGVyKCdiYWNrd2FyZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vbnRoc0JhY2srKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDApO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hhcnQuYXBwZW5kKFwidGV4dFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiZm9yd2FyZCB0by1zaG93XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZHhcIiwgdyAtIG1hcmdpbi5yaWdodCAtIDUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZHlcIiwgbWFyZ2luLnRvcCAtIDUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCAxMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAudGV4dCgnPicpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcImN1cnNvclwiLCBcInBvaW50ZXJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuZmlsdGVyKCdmb3J3YXJkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb250aHNCYWNrLS07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAwKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJ0LmFwcGVuZChcInRleHRcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ0aXRsZSB0by1zaG93XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR4XCIsICh3IC0gbWFyZ2luLnJpZ2h0KSAvIDIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIG1hcmdpbi50b3AgLSA1KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIDEwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAwKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB1cCB0aGUgc2NhbGVzOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB4U2NhbGUgPSBkMy5zY2FsZS5saW5lYXIoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJhbmdlKFswLCB3IC0gbWFyZ2luLnJpZ2h0XSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB5U2NhbGUgPSBkMy5zY2FsZS5vcmRpbmFsKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yYW5nZUJhbmRzKFttYXJnaW4udG9wLCBoIC0gbWFyZ2luLmJvdHRvbV0sIDAuMSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL1NldCB1cCBheGVzOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGFydC5hcHBlbmQoXCJnXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwieCBheGlzIHRvLXNob3dcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKDAsIFwiICsgKGggLSBtYXJnaW4uYm90dG9tIC0gNSkgKyBcIilcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoXCJ0ZXh0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgXCI4XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkeFwiLCAodyAtIG1hcmdpbi5yaWdodCkgLyAyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkeVwiLCAyNSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50ZXh0KFwiSG91cnNcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyYXduID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlQ2hhcnQoc2NvcGUuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHVwZGF0ZUNoYXJ0ID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGl0bGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hhcnQuc2VsZWN0KFwiLmZvcndhcmRcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcImRpc3BsYXlcIiwgZnVuY3Rpb24gKCkgeyByZXR1cm4gbW9udGhzQmFjayA+PSAxID8gXCJibG9ja1wiIDogXCJub25lXCI7IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGFydC5zZWxlY3QoXCIuYmFja3dhcmRcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcImRpc3BsYXlcIiwgZnVuY3Rpb24gKCkgeyByZXR1cm4gbW9udGhzQmFjayA+PSAzID8gXCJub25lXCIgOiBcImJsb2NrXCI7IH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9TZXQgdXAgdGhlIFNWRzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1heFggPSBkMy5tYXgoZGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIE1hdGgubWF4KGRbaW5uZXJQcm9wXSwgZFtvdXRlclByb3BdKTsgfSkgKiAxLjEwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB4U2NhbGUuZG9tYWluKFswLCBtYXhYXSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgeEF4aXMgPSBkMy5zdmcuYXhpcygpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zY2FsZSh4U2NhbGUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aWNrcyg1KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAub3JpZW50KFwiYm90dG9tXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hhcnQuc2VsZWN0KCcueCcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2FsbCh4QXhpcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB5U2NhbGUuZG9tYWluKGRhdGEubWFwKGZ1bmN0aW9uIChkKSB7IHJldHVybiBkW2dyb3VwXTsgfSkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlubmVyQmFySGVpZ2h0ID0geVNjYWxlLnJhbmdlQmFuZCgpICogMC42O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBEYXRhIGJpbmRpbmc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiYXJzQ29udCA9IGNoYXJ0LnNlbGVjdEFsbChcImcuYmFyc1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRhdGEoZGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGRbZ3JvdXBdOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhcnNDb250LnRyYW5zaXRpb24oKS5kdXJhdGlvbig1MDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gXCJ0cmFuc2xhdGUoMCwgXCIgKyB5U2NhbGUoZFtncm91cF0pICsgXCIpXCI7IH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYmFyc0NvbnQuc2VsZWN0KFwicmVjdC5vdXRlci1iYXJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIHlTY2FsZS5yYW5nZUJhbmQoKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50cmFuc2l0aW9uKCkuZHVyYXRpb24oNTAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4geFNjYWxlKGRbb3V0ZXJQcm9wXSk7IH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYmFyc0NvbnQuc2VsZWN0KFwicmVjdC5pbm5lci1iYXJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgaW5uZXJCYXJIZWlnaHQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieVwiLCAoeVNjYWxlLnJhbmdlQmFuZCgpIC0gaW5uZXJCYXJIZWlnaHQpIC8gMilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oKS5kdXJhdGlvbig1MDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIHhTY2FsZShkW2lubmVyUHJvcF0pOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhcnNDb250LnNlbGVjdChcInRleHRcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIHlTY2FsZS5yYW5nZUJhbmQoKSAvIDIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgY29udGFpbmVyIHBlciBvYnNlcnZhdGlvbjo7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiYXJFbnRlciA9IGJhcnNDb250LmVudGVyKCkuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImJhcnNcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBcInRyYW5zbGF0ZSgwLCBcIiArIHlTY2FsZShkW2dyb3VwXSkgKyBcIilcIjsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBBZGQgT3V0ZXIgYmFyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhckVudGVyLmFwcGVuZChcInJlY3RcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJvdXRlci1iYXJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIHlTY2FsZS5yYW5nZUJhbmQoKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIHhTY2FsZShkW291dGVyUHJvcF0pOyB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJmaWxsXCIsIFwiYmxhY2tcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMC4zKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vQWRkIElubmVyQmFyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhckVudGVyLmFwcGVuZChcInJlY3RcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImlubmVyLWJhclwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCBpbm5lckJhckhlaWdodClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ5XCIsICh5U2NhbGUucmFuZ2VCYW5kKCkgLSBpbm5lckJhckhlaWdodCkgLyAyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiB4U2NhbGUoZFtpbm5lclByb3BdKTsgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJmaWxsXCIsIFwic3RlZWxibHVlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMC44KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZCBncm91cCBuYW1lXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhckVudGVyLmFwcGVuZChcInRleHRcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJuYW1lLW1vbnRoXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwiZW5kXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImRvbWluYW50LWJhc2VsaW5lXCIsIFwiY2VudHJhbFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJmb250LXNpemVcIiwgXCIxMFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkeFwiLCAtMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZHlcIiwgeVNjYWxlLnJhbmdlQmFuZCgpIC8gMilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uIChkKSB7IHJldHVybiBkW2dyb3VwXTsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBiYXJzQ29udC5leGl0KCkucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKFwiZGF0YVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5kYXRhICYmICFkcmF3bikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlQ2hhcnQoc2NvcGUuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVDaGFydChzY29wZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0sIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICR0aW1lb3V0KGJ1bGxldENoYXJ0LCAwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxuIiwiYW5ndWxhci5tb2R1bGUoXCJlaHJEYXNoYm9hcmRcIilcclxuLmRpcmVjdGl2ZShcImJveFdoaXNrZXJcIiwgZnVuY3Rpb24oKXtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgcmVzdHJpY3QgOiAnRScsXHJcbiAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgZGF0YTogJz0nLFxyXG4gICAgICAgICAgICBwcm9wOiAnPScsXHJcbiAgICAgICAgICAgIGdyb3VwOiAnPSdcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRlbXBsYXRlOiAnJyxcclxuICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbSkge1xyXG4gICAgICAgICAgICB2YXIgZHJhd0NoYXJ0ID0gZnVuY3Rpb24oZGF0YSxwcm9wLGdyb3VwKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGl2ID0gZWxlbVswXTtcclxuICAgICAgICAgICAgICAgIHZhciB3aWR0aCA9IGRpdi5vZmZzZXRXaWR0aCAvIDMgLSA1O1xyXG4gICAgICAgICAgICAgICAgdmFyIGhlaWdodCA9IDMwMDtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgbWluID0gLTEwLFxyXG4gICAgICAgICAgICAgICAgICAgIG1heCA9IDExMDtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgY2hhcnQgPSBkMy5ib3goKVxyXG4gICAgICAgICAgICAgICAgICAgIC53aGlza2VycyhpcXIoMS41KSlcclxuICAgICAgICAgICAgICAgICAgICAud2lkdGgod2lkdGggLyAzIC0gMjUpXHJcbiAgICAgICAgICAgICAgICAgICAgLmhlaWdodChoZWlnaHQgLSAxNSk7XHJcblxyXG4gICAgICAgICAgICAgICAgY2hhcnQuZG9tYWluKFttaW4sIG1heF0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBzdmcgPSBkMy5zZWxlY3QoZGl2KS5zZWxlY3RBbGwoJ3N2ZycpXHJcbiAgICAgICAgICAgICAgICAgIC5kYXRhKGRhdGEpXHJcbiAgICAgICAgICAgICAgICAuZW50ZXIoKS5hcHBlbmQoXCJzdmdcIilcclxuICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImJveFwiKVxyXG4gICAgICAgICAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIHdpZHRoKVxyXG4gICAgICAgICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCBoZWlnaHQpXHJcbiAgICAgICAgICAgICAgICAuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKDEwMCwxMClcIilcclxuICAgICAgICAgICAgICAgICAgLmNhbGwoY2hhcnQpO1xyXG5cclxuICAgICAgICAgICAgICAgIHN2Zy5hcHBlbmQoXCJ0ZXh0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoXCIgKyAod2lkdGggLyAzIC0gMjUpIC8gMiArIFwiLFwiICsgKGhlaWdodCAtIDE1KSArIFwiKVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcclxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgXCIxNnB4XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRleHQoZnVuY3Rpb24oZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC5ncm91cDtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdmFyIGlxciA9IGZ1bmN0aW9uKGspIHtcclxuICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZCwgaSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHExID0gZC5xdWFydGlsZXNbMF0sXHJcbiAgICAgICAgICAgICAgICAgICAgcTMgPSBkLnF1YXJ0aWxlc1syXSxcclxuICAgICAgICAgICAgICAgICAgICBpcXIgPSAocTMgLSBxMSkgKiBrLFxyXG4gICAgICAgICAgICAgICAgICAgIGkgPSAtMSxcclxuICAgICAgICAgICAgICAgICAgICBqID0gZC5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoZFsrK2ldIDwgcTEgLSBpcXIpO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKGRbLS1qXSA+IHEzICsgaXFyKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBbaSwgal07XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goJ2RhdGEnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5kYXRhKXtcclxuICAgICAgICAgICAgICAgICAgICBkcmF3Q2hhcnQoc2NvcGUuZGF0YSwgc2NvcGUucHJvcCwgc2NvcGUuZ3JvdXApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KSwgdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59KTtcclxuIiwiKGZ1bmN0aW9uKCkge1xyXG5cclxuLy8gSW5zcGlyZWQgYnkgaHR0cDovL2luZm9ybWF0aW9uYW5kdmlzdWFsaXphdGlvbi5kZS9ibG9nL2JveC1wbG90XHJcbmQzLmJveCA9IGZ1bmN0aW9uKCkge1xyXG4gIHZhciB3aWR0aCA9IDEsXHJcbiAgICAgIGhlaWdodCA9IDEsXHJcbiAgICAgIGR1cmF0aW9uID0gMCxcclxuICAgICAgZG9tYWluID0gbnVsbCxcclxuICAgICAgdmFsdWUgPSBOdW1iZXIsXHJcbiAgICAgIHdoaXNrZXJzID0gYm94V2hpc2tlcnMsXHJcbiAgICAgIHF1YXJ0aWxlcyA9IGJveFF1YXJ0aWxlcyxcclxuICAgICAgdGlja0Zvcm1hdCA9IG51bGw7XHJcblxyXG4gIC8vIEZvciBlYWNoIHNtYWxsIG11bHRpcGxl4oCmXHJcbiAgZnVuY3Rpb24gYm94KGcpIHtcclxuICAgIGcuZWFjaChmdW5jdGlvbihkLCBpKSB7XHJcbiAgICAgICAgLy8gTE06IFJlcGxhY2VkIG1hcCh2YWx1ZSkgd2l0aCB1bml0XHJcbiAgICAgIGQgPSBkLnVuaXQuc29ydChkMy5hc2NlbmRpbmcpO1xyXG4gICAgICB2YXIgZyA9IGQzLnNlbGVjdCh0aGlzKSxcclxuICAgICAgICAgIG4gPSBkLmxlbmd0aCxcclxuICAgICAgICAgIG1pbiA9IGRbMF0sXHJcbiAgICAgICAgICBtYXggPSBkW24gLSAxXTtcclxuXHJcbiAgICAgIC8vIENvbXB1dGUgcXVhcnRpbGVzLiBNdXN0IHJldHVybiBleGFjdGx5IDMgZWxlbWVudHMuXHJcbiAgICAgIHZhciBxdWFydGlsZURhdGEgPSBkLnF1YXJ0aWxlcyA9IHF1YXJ0aWxlcyhkKTtcclxuXHJcbiAgICAgIC8vIENvbXB1dGUgd2hpc2tlcnMuIE11c3QgcmV0dXJuIGV4YWN0bHkgMiBlbGVtZW50cywgb3IgbnVsbC5cclxuICAgICAgdmFyIHdoaXNrZXJJbmRpY2VzID0gd2hpc2tlcnMgJiYgd2hpc2tlcnMuY2FsbCh0aGlzLCBkLCBpKSxcclxuICAgICAgICAgIHdoaXNrZXJEYXRhID0gd2hpc2tlckluZGljZXMgJiYgd2hpc2tlckluZGljZXMubWFwKGZ1bmN0aW9uKGkpIHsgcmV0dXJuIGRbaV07IH0pO1xyXG5cclxuICAgICAgLy8gQ29tcHV0ZSBvdXRsaWVycy4gSWYgbm8gd2hpc2tlcnMgYXJlIHNwZWNpZmllZCwgYWxsIGRhdGEgYXJlIFwib3V0bGllcnNcIi5cclxuICAgICAgLy8gV2UgY29tcHV0ZSB0aGUgb3V0bGllcnMgYXMgaW5kaWNlcywgc28gdGhhdCB3ZSBjYW4gam9pbiBhY3Jvc3MgdHJhbnNpdGlvbnMhXHJcbiAgICAgIHZhciBvdXRsaWVySW5kaWNlcyA9IHdoaXNrZXJJbmRpY2VzXHJcbiAgICAgICAgICA/IGQzLnJhbmdlKDAsIHdoaXNrZXJJbmRpY2VzWzBdKS5jb25jYXQoZDMucmFuZ2Uod2hpc2tlckluZGljZXNbMV0gKyAxLCBuKSlcclxuICAgICAgICAgIDogZDMucmFuZ2Uobik7XHJcblxyXG4gICAgICAvLyBDb21wdXRlIHRoZSBuZXcgeC1zY2FsZS5cclxuICAgICAgdmFyIHgxID0gZDMuc2NhbGUubGluZWFyKClcclxuICAgICAgICAgIC5kb21haW4oZG9tYWluICYmIGRvbWFpbi5jYWxsKHRoaXMsIGQsIGkpIHx8IFttaW4sIG1heF0pXHJcbiAgICAgICAgICAucmFuZ2UoW2hlaWdodCwgMF0pO1xyXG5cclxuICAgICAgLy8gUmV0cmlldmUgdGhlIG9sZCB4LXNjYWxlLCBpZiB0aGlzIGlzIGFuIHVwZGF0ZS5cclxuICAgICAgdmFyIHgwID0gdGhpcy5fX2NoYXJ0X18gfHwgZDMuc2NhbGUubGluZWFyKClcclxuICAgICAgICAgIC5kb21haW4oWzAsIEluZmluaXR5XSlcclxuICAgICAgICAgIC5yYW5nZSh4MS5yYW5nZSgpKTtcclxuXHJcbiAgICAgIC8vIFN0YXNoIHRoZSBuZXcgc2NhbGUuXHJcbiAgICAgIHRoaXMuX19jaGFydF9fID0geDE7XHJcblxyXG4gICAgICAvLyBOb3RlOiB0aGUgYm94LCBtZWRpYW4sIGFuZCBib3ggdGljayBlbGVtZW50cyBhcmUgZml4ZWQgaW4gbnVtYmVyLFxyXG4gICAgICAvLyBzbyB3ZSBvbmx5IGhhdmUgdG8gaGFuZGxlIGVudGVyIGFuZCB1cGRhdGUuIEluIGNvbnRyYXN0LCB0aGUgb3V0bGllcnNcclxuICAgICAgLy8gYW5kIG90aGVyIGVsZW1lbnRzIGFyZSB2YXJpYWJsZSwgc28gd2UgbmVlZCB0byBleGl0IHRoZW0hIFZhcmlhYmxlXHJcbiAgICAgIC8vIGVsZW1lbnRzIGFsc28gZmFkZSBpbiBhbmQgb3V0LlxyXG5cclxuICAgICAgLy8gVXBkYXRlIGNlbnRlciBsaW5lOiB0aGUgdmVydGljYWwgbGluZSBzcGFubmluZyB0aGUgd2hpc2tlcnMuXHJcbiAgICAgIHZhciBjZW50ZXIgPSBnLnNlbGVjdEFsbChcImxpbmUuY2VudGVyXCIpXHJcbiAgICAgICAgICAuZGF0YSh3aGlza2VyRGF0YSA/IFt3aGlza2VyRGF0YV0gOiBbXSk7XHJcblxyXG4gICAgICBjZW50ZXIuZW50ZXIoKS5pbnNlcnQoXCJsaW5lXCIsIFwicmVjdFwiKVxyXG4gICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImNlbnRlclwiKVxyXG4gICAgICAgICAgLmF0dHIoXCJ4MVwiLCB3aWR0aCAvIDIpXHJcbiAgICAgICAgICAuYXR0cihcInkxXCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHgwKGRbMF0pOyB9KVxyXG4gICAgICAgICAgLmF0dHIoXCJ4MlwiLCB3aWR0aCAvIDIpXHJcbiAgICAgICAgICAuYXR0cihcInkyXCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHgwKGRbMV0pOyB9KVxyXG4gICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAxZS02KVxyXG4gICAgICAgIC50cmFuc2l0aW9uKClcclxuICAgICAgICAgIC5kdXJhdGlvbihkdXJhdGlvbilcclxuICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMSlcclxuICAgICAgICAgIC5hdHRyKFwieTFcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4geDEoZFswXSk7IH0pXHJcbiAgICAgICAgICAuYXR0cihcInkyXCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHgxKGRbMV0pOyB9KTtcclxuXHJcbiAgICAgIGNlbnRlci50cmFuc2l0aW9uKClcclxuICAgICAgICAgIC5kdXJhdGlvbihkdXJhdGlvbilcclxuICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMSlcclxuICAgICAgICAgIC5hdHRyKFwieTFcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4geDEoZFswXSk7IH0pXHJcbiAgICAgICAgICAuYXR0cihcInkyXCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHgxKGRbMV0pOyB9KTtcclxuXHJcbiAgICAgIGNlbnRlci5leGl0KCkudHJhbnNpdGlvbigpXHJcbiAgICAgICAgICAuZHVyYXRpb24oZHVyYXRpb24pXHJcbiAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDFlLTYpXHJcbiAgICAgICAgICAuYXR0cihcInkxXCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHgxKGRbMF0pOyB9KVxyXG4gICAgICAgICAgLmF0dHIoXCJ5MlwiLCBmdW5jdGlvbihkKSB7IHJldHVybiB4MShkWzFdKTsgfSlcclxuICAgICAgICAgIC5yZW1vdmUoKTtcclxuXHJcbiAgICAgIC8vIFVwZGF0ZSBpbm5lcnF1YXJ0aWxlIGJveC5cclxuICAgICAgdmFyIGJveCA9IGcuc2VsZWN0QWxsKFwicmVjdC5ib3hcIilcclxuICAgICAgICAgIC5kYXRhKFtxdWFydGlsZURhdGFdKTtcclxuXHJcbiAgICAgIGJveC5lbnRlcigpLmFwcGVuZChcInJlY3RcIilcclxuICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJib3hcIilcclxuICAgICAgICAgIC5hdHRyKFwieFwiLCAwKVxyXG4gICAgICAgICAgLmF0dHIoXCJ5XCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHgwKGRbMl0pOyB9KVxyXG4gICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCB3aWR0aClcclxuICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHgwKGRbMF0pIC0geDAoZFsyXSk7IH0pXHJcbiAgICAgICAgLnRyYW5zaXRpb24oKVxyXG4gICAgICAgICAgLmR1cmF0aW9uKGR1cmF0aW9uKVxyXG4gICAgICAgICAgLmF0dHIoXCJ5XCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHgxKGRbMl0pOyB9KVxyXG4gICAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4geDEoZFswXSkgLSB4MShkWzJdKTsgfSk7XHJcblxyXG4gICAgICBib3gudHJhbnNpdGlvbigpXHJcbiAgICAgICAgICAuZHVyYXRpb24oZHVyYXRpb24pXHJcbiAgICAgICAgICAuYXR0cihcInlcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4geDEoZFsyXSk7IH0pXHJcbiAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCBmdW5jdGlvbihkKSB7IHJldHVybiB4MShkWzBdKSAtIHgxKGRbMl0pOyB9KTtcclxuXHJcbiAgICAgIC8vIFVwZGF0ZSBtZWRpYW4gbGluZS5cclxuICAgICAgdmFyIG1lZGlhbkxpbmUgPSBnLnNlbGVjdEFsbChcImxpbmUubWVkaWFuXCIpXHJcbiAgICAgICAgICAuZGF0YShbcXVhcnRpbGVEYXRhWzFdXSk7XHJcblxyXG4gICAgICBtZWRpYW5MaW5lLmVudGVyKCkuYXBwZW5kKFwibGluZVwiKVxyXG4gICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcIm1lZGlhblwiKVxyXG4gICAgICAgICAgLmF0dHIoXCJ4MVwiLCAwKVxyXG4gICAgICAgICAgLmF0dHIoXCJ5MVwiLCB4MClcclxuICAgICAgICAgIC5hdHRyKFwieDJcIiwgd2lkdGgpXHJcbiAgICAgICAgICAuYXR0cihcInkyXCIsIHgwKVxyXG4gICAgICAgIC50cmFuc2l0aW9uKClcclxuICAgICAgICAgIC5kdXJhdGlvbihkdXJhdGlvbilcclxuICAgICAgICAgIC5hdHRyKFwieTFcIiwgeDEpXHJcbiAgICAgICAgICAuYXR0cihcInkyXCIsIHgxKTtcclxuXHJcbiAgICAgIG1lZGlhbkxpbmUudHJhbnNpdGlvbigpXHJcbiAgICAgICAgICAuZHVyYXRpb24oZHVyYXRpb24pXHJcbiAgICAgICAgICAuYXR0cihcInkxXCIsIHgxKVxyXG4gICAgICAgICAgLmF0dHIoXCJ5MlwiLCB4MSk7XHJcblxyXG4gICAgICAvLyBVcGRhdGUgd2hpc2tlcnMuXHJcbiAgICAgIHZhciB3aGlza2VyID0gZy5zZWxlY3RBbGwoXCJsaW5lLndoaXNrZXJcIilcclxuICAgICAgICAgIC5kYXRhKHdoaXNrZXJEYXRhIHx8IFtdKTtcclxuXHJcbiAgICAgIHdoaXNrZXIuZW50ZXIoKS5pbnNlcnQoXCJsaW5lXCIsIFwiY2lyY2xlLCB0ZXh0XCIpXHJcbiAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwid2hpc2tlclwiKVxyXG4gICAgICAgICAgLmF0dHIoXCJ4MVwiLCAwKVxyXG4gICAgICAgICAgLmF0dHIoXCJ5MVwiLCB4MClcclxuICAgICAgICAgIC5hdHRyKFwieDJcIiwgd2lkdGgpXHJcbiAgICAgICAgICAuYXR0cihcInkyXCIsIHgwKVxyXG4gICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAxZS02KVxyXG4gICAgICAgIC50cmFuc2l0aW9uKClcclxuICAgICAgICAgIC5kdXJhdGlvbihkdXJhdGlvbilcclxuICAgICAgICAgIC5hdHRyKFwieTFcIiwgeDEpXHJcbiAgICAgICAgICAuYXR0cihcInkyXCIsIHgxKVxyXG4gICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAxKTtcclxuXHJcbiAgICAgIHdoaXNrZXIudHJhbnNpdGlvbigpXHJcbiAgICAgICAgICAuZHVyYXRpb24oZHVyYXRpb24pXHJcbiAgICAgICAgICAuYXR0cihcInkxXCIsIHgxKVxyXG4gICAgICAgICAgLmF0dHIoXCJ5MlwiLCB4MSlcclxuICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMSk7XHJcblxyXG4gICAgICB3aGlza2VyLmV4aXQoKS50cmFuc2l0aW9uKClcclxuICAgICAgICAgIC5kdXJhdGlvbihkdXJhdGlvbilcclxuICAgICAgICAgIC5hdHRyKFwieTFcIiwgeDEpXHJcbiAgICAgICAgICAuYXR0cihcInkyXCIsIHgxKVxyXG4gICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAxZS02KVxyXG4gICAgICAgICAgLnJlbW92ZSgpO1xyXG5cclxuICAgICAgLy8gVXBkYXRlIG91dGxpZXJzLlxyXG4gICAgICB2YXIgb3V0bGllciA9IGcuc2VsZWN0QWxsKFwiY2lyY2xlLm91dGxpZXJcIilcclxuICAgICAgICAgIC5kYXRhKG91dGxpZXJJbmRpY2VzLCBOdW1iZXIpO1xyXG5cclxuICAgICAgb3V0bGllci5lbnRlcigpLmluc2VydChcImNpcmNsZVwiLCBcInRleHRcIilcclxuICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJvdXRsaWVyXCIpXHJcbiAgICAgICAgICAuYXR0cihcInJcIiwgNSlcclxuICAgICAgICAgIC5hdHRyKFwiY3hcIiwgd2lkdGggLyAyKVxyXG4gICAgICAgICAgLmF0dHIoXCJjeVwiLCBmdW5jdGlvbihpKSB7IHJldHVybiB4MChkW2ldKTsgfSlcclxuICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMWUtNilcclxuICAgICAgICAudHJhbnNpdGlvbigpXHJcbiAgICAgICAgICAuZHVyYXRpb24oZHVyYXRpb24pXHJcbiAgICAgICAgICAuYXR0cihcImN5XCIsIGZ1bmN0aW9uKGkpIHsgcmV0dXJuIHgxKGRbaV0pOyB9KVxyXG4gICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAxKTtcclxuXHJcbiAgICAgIG91dGxpZXIudHJhbnNpdGlvbigpXHJcbiAgICAgICAgICAuZHVyYXRpb24oZHVyYXRpb24pXHJcbiAgICAgICAgICAuYXR0cihcImN5XCIsIGZ1bmN0aW9uKGkpIHsgcmV0dXJuIHgxKGRbaV0pOyB9KVxyXG4gICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAxKTtcclxuXHJcbiAgICAgIG91dGxpZXIuZXhpdCgpLnRyYW5zaXRpb24oKVxyXG4gICAgICAgICAgLmR1cmF0aW9uKGR1cmF0aW9uKVxyXG4gICAgICAgICAgLmF0dHIoXCJjeVwiLCBmdW5jdGlvbihpKSB7IHJldHVybiB4MShkW2ldKTsgfSlcclxuICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMWUtNilcclxuICAgICAgICAgIC5yZW1vdmUoKTtcclxuXHJcbiAgICAgIC8vIENvbXB1dGUgdGhlIHRpY2sgZm9ybWF0LlxyXG4gICAgICB2YXIgZm9ybWF0ID0gdGlja0Zvcm1hdCB8fCB4MS50aWNrRm9ybWF0KDgpO1xyXG5cclxuICAgICAgLy8gVXBkYXRlIGJveCB0aWNrcy5cclxuICAgICAgdmFyIGJveFRpY2sgPSBnLnNlbGVjdEFsbChcInRleHQuYm94XCIpXHJcbiAgICAgICAgICAuZGF0YShxdWFydGlsZURhdGEpO1xyXG5cclxuICAgICAgYm94VGljay5lbnRlcigpLmFwcGVuZChcInRleHRcIilcclxuICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJib3hcIilcclxuICAgICAgICAgIC5hdHRyKFwiZHlcIiwgXCIuM2VtXCIpXHJcbiAgICAgICAgICAuYXR0cihcImR4XCIsIGZ1bmN0aW9uKGQsIGkpIHsgcmV0dXJuIGkgJiAxID8gNiA6IC02IH0pXHJcbiAgICAgICAgICAuYXR0cihcInhcIiwgZnVuY3Rpb24oZCwgaSkgeyByZXR1cm4gaSAmIDEgPyB3aWR0aCA6IDAgfSlcclxuICAgICAgICAgIC5hdHRyKFwieVwiLCB4MClcclxuICAgICAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgZnVuY3Rpb24oZCwgaSkgeyByZXR1cm4gaSAmIDEgPyBcInN0YXJ0XCIgOiBcImVuZFwiOyB9KVxyXG4gICAgICAgICAgLnRleHQoZm9ybWF0KVxyXG4gICAgICAgIC50cmFuc2l0aW9uKClcclxuICAgICAgICAgIC5kdXJhdGlvbihkdXJhdGlvbilcclxuICAgICAgICAgIC5hdHRyKFwieVwiLCB4MSk7XHJcblxyXG4gICAgICBib3hUaWNrLnRyYW5zaXRpb24oKVxyXG4gICAgICAgICAgLmR1cmF0aW9uKGR1cmF0aW9uKVxyXG4gICAgICAgICAgLnRleHQoZm9ybWF0KVxyXG4gICAgICAgICAgLmF0dHIoXCJ5XCIsIHgxKTtcclxuXHJcbiAgICAgIC8vIFVwZGF0ZSB3aGlza2VyIHRpY2tzLiBUaGVzZSBhcmUgaGFuZGxlZCBzZXBhcmF0ZWx5IGZyb20gdGhlIGJveFxyXG4gICAgICAvLyB0aWNrcyBiZWNhdXNlIHRoZXkgbWF5IG9yIG1heSBub3QgZXhpc3QsIGFuZCB3ZSB3YW50IGRvbid0IHdhbnRcclxuICAgICAgLy8gdG8gam9pbiBib3ggdGlja3MgcHJlLXRyYW5zaXRpb24gd2l0aCB3aGlza2VyIHRpY2tzIHBvc3QtLlxyXG4gICAgICB2YXIgd2hpc2tlclRpY2sgPSBnLnNlbGVjdEFsbChcInRleHQud2hpc2tlclwiKVxyXG4gICAgICAgICAgLmRhdGEod2hpc2tlckRhdGEgfHwgW10pO1xyXG5cclxuICAgICAgd2hpc2tlclRpY2suZW50ZXIoKS5hcHBlbmQoXCJ0ZXh0XCIpXHJcbiAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwid2hpc2tlclwiKVxyXG4gICAgICAgICAgLmF0dHIoXCJkeVwiLCBcIi4zZW1cIilcclxuICAgICAgICAgIC5hdHRyKFwiZHhcIiwgNilcclxuICAgICAgICAgIC5hdHRyKFwieFwiLCB3aWR0aClcclxuICAgICAgICAgIC5hdHRyKFwieVwiLCB4MClcclxuICAgICAgICAgIC50ZXh0KGZvcm1hdClcclxuICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMWUtNilcclxuICAgICAgICAudHJhbnNpdGlvbigpXHJcbiAgICAgICAgICAuZHVyYXRpb24oZHVyYXRpb24pXHJcbiAgICAgICAgICAuYXR0cihcInlcIiwgeDEpXHJcbiAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDEpO1xyXG5cclxuICAgICAgd2hpc2tlclRpY2sudHJhbnNpdGlvbigpXHJcbiAgICAgICAgICAuZHVyYXRpb24oZHVyYXRpb24pXHJcbiAgICAgICAgICAudGV4dChmb3JtYXQpXHJcbiAgICAgICAgICAuYXR0cihcInlcIiwgeDEpXHJcbiAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDEpO1xyXG5cclxuICAgICAgd2hpc2tlclRpY2suZXhpdCgpLnRyYW5zaXRpb24oKVxyXG4gICAgICAgICAgLmR1cmF0aW9uKGR1cmF0aW9uKVxyXG4gICAgICAgICAgLmF0dHIoXCJ5XCIsIHgxKVxyXG4gICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAxZS02KVxyXG4gICAgICAgICAgLnJlbW92ZSgpO1xyXG4gICAgfSk7XHJcbiAgICBkMy50aW1lci5mbHVzaCgpO1xyXG4gIH1cclxuXHJcbiAgYm94LndpZHRoID0gZnVuY3Rpb24oeCkge1xyXG4gICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gd2lkdGg7XHJcbiAgICB3aWR0aCA9IHg7XHJcbiAgICByZXR1cm4gYm94O1xyXG4gIH07XHJcblxyXG4gIGJveC5oZWlnaHQgPSBmdW5jdGlvbih4KSB7XHJcbiAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBoZWlnaHQ7XHJcbiAgICBoZWlnaHQgPSB4O1xyXG4gICAgcmV0dXJuIGJveDtcclxuICB9O1xyXG5cclxuICBib3gudGlja0Zvcm1hdCA9IGZ1bmN0aW9uKHgpIHtcclxuICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHRpY2tGb3JtYXQ7XHJcbiAgICB0aWNrRm9ybWF0ID0geDtcclxuICAgIHJldHVybiBib3g7XHJcbiAgfTtcclxuXHJcbiAgYm94LmR1cmF0aW9uID0gZnVuY3Rpb24oeCkge1xyXG4gICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gZHVyYXRpb247XHJcbiAgICBkdXJhdGlvbiA9IHg7XHJcbiAgICByZXR1cm4gYm94O1xyXG4gIH07XHJcblxyXG4gIGJveC5kb21haW4gPSBmdW5jdGlvbih4KSB7XHJcbiAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBkb21haW47XHJcbiAgICBkb21haW4gPSB4ID09IG51bGwgPyB4IDogZDMuZnVuY3Rvcih4KTtcclxuICAgIHJldHVybiBib3g7XHJcbiAgfTtcclxuXHJcbiAgYm94LnZhbHVlID0gZnVuY3Rpb24oeCkge1xyXG4gICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gdmFsdWU7XHJcbiAgICB2YWx1ZSA9IHg7XHJcbiAgICByZXR1cm4gYm94O1xyXG4gIH07XHJcblxyXG4gIGJveC53aGlza2VycyA9IGZ1bmN0aW9uKHgpIHtcclxuICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHdoaXNrZXJzO1xyXG4gICAgd2hpc2tlcnMgPSB4O1xyXG4gICAgcmV0dXJuIGJveDtcclxuICB9O1xyXG5cclxuICBib3gucXVhcnRpbGVzID0gZnVuY3Rpb24oeCkge1xyXG4gICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gcXVhcnRpbGVzO1xyXG4gICAgcXVhcnRpbGVzID0geDtcclxuICAgIHJldHVybiBib3g7XHJcbiAgfTtcclxuXHJcbiAgcmV0dXJuIGJveDtcclxufTtcclxuXHJcbmZ1bmN0aW9uIGJveFdoaXNrZXJzKGQpIHtcclxuICByZXR1cm4gWzAsIGQubGVuZ3RoIC0gMV07XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGJveFF1YXJ0aWxlcyhkKSB7XHJcbiAgcmV0dXJuIFtcclxuICAgIGQzLnF1YW50aWxlKGQsIC4yNSksXHJcbiAgICBkMy5xdWFudGlsZShkLCAuNSksXHJcbiAgICBkMy5xdWFudGlsZShkLCAuNzUpXHJcbiAgXTtcclxufVxyXG5cclxufSkoKTtcclxuIiwiYW5ndWxhci5tb2R1bGUoXCJlaHJEYXNoYm9hcmRcIilcclxuICAgIC5mYWN0b3J5KFwiTGluZU9wdGlvbnNcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGRlZmF1bHRzOiBbXHJcbiAgICAgICAgICAgIHsgJ3Byb3BOYW1lJzogJ21hcmdpbicsICdkZWZhdWx0VmFsdWUnOiB7IFwidG9wXCI6IDAsIFwibGVmdFwiOiAwLCBcInJpZ2h0XCI6IDAsIFwiYm90dG9tXCI6IDAgfSB9LFxyXG4gICAgICAgICAgICB7ICdwcm9wTmFtZSc6ICdjb2xvcicsICdkZWZhdWx0VmFsdWUnOiAnc3RlZWxibHVlJyB9LFxyXG4gICAgICAgICAgICB7ICdwcm9wTmFtZSc6ICd4QXhpc0ZyZXEnLCAnZGVmYXVsdFZhbHVlJzogJycgfSxcclxuICAgICAgICAgICAgeyAncHJvcE5hbWUnOiAneU1heCcsICdkZWZhdWx0VmFsdWUnOiAnJyB9LFxyXG4gICAgICAgICAgICB7ICdwcm9wTmFtZSc6ICdjb2xvckJ5JywgJ2RlZmF1bHRWYWx1ZSc6ICdub25lJyB9LFxyXG4gICAgICAgICAgICB7ICdwcm9wTmFtZSc6ICd0b29sdGlwJywgJ2RlZmF1bHRWYWx1ZSc6IHRydWUgfSxcclxuICAgICAgICAgICAgeyAncHJvcE5hbWUnOiAnZml0VG9IZWlnaHQnLCAnZGVmYXVsdFZhbHVlJzogdHJ1ZSB9LFxyXG4gICAgICAgICAgICB7ICdwcm9wTmFtZSc6ICdyYWRpdXMnLCAnZGVmYXVsdFZhbHVlJzogMyB9LFxyXG4gICAgICAgICAgICB7ICdwcm9wTmFtZSc6ICd3aWR0aCcsICdkZWZhdWx0VmFsdWUnOiBudWxsIH0sXHJcbiAgICAgICAgICAgIHsgJ3Byb3BOYW1lJzogJ2hlaWdodCcsICdkZWZhdWx0VmFsdWUnOiBudWxsIH0sXHJcbiAgICAgICAgICAgIHsncHJvcE5hbWUnOiAndGl0bGUnLCAnZGVmYXVsdFZhbHVlJzogJyd9XHJcbiAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgIGdlbmVyYXRlT3B0aW9uczogZnVuY3Rpb24gKG9wdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjb250cm9scyA9IG9wdGlvbnMgPyBvcHRpb25zIDoge307XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRlZmF1bHRzLmZvckVhY2goZnVuY3Rpb24gKGQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbnRyb2xzLmhhc093blByb3BlcnR5KGQucHJvcE5hbWUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xzW2QucHJvcE5hbWVdID0gZC5kZWZhdWx0VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29udHJvbHM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG59KTtcclxuIiwiYW5ndWxhci5tb2R1bGUoJ2VockRhc2hib2FyZCcpXHJcbiAgICAuZGlyZWN0aXZlKFwibGluZUNoYXJ0XCIsIGZ1bmN0aW9uIChDaGFydE9wdGlvbnMpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICBkYXRhOiAnPScsXHJcbiAgICAgICAgICAgIG9wdGlvbnM6ICc9JyxcclxuICAgICAgICAgICAgZGF0ZTogJz0nLFxyXG4gICAgICAgICAgICBncm91cDogJz0nLFxyXG4gICAgICAgICAgICB1bml0OiAnPSdcclxuICAgICAgICB9LFxyXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbSkge1xyXG4gICAgICAgICAgICB2YXIgY29uZmlnID0gQ2hhcnRPcHRpb25zLmdlbmVyYXRlT3B0aW9ucyhzY29wZS5vcHRpb25zKTtcclxuICAgICAgICAgICAgdmFyIHcsIGg7XHJcbiAgICAgICAgICAgIHZhciB1bml0ID0gc2NvcGUudW5pdDtcclxuICAgICAgICAgICAgdmFyIGRhdGUgPSBzY29wZS5kYXRlO1xyXG4gICAgICAgICAgICB2YXIgZ3JvdXAgPSBzY29wZS5ncm91cDtcclxuICAgICAgICAgICAgdmFyIGRyYXduID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZhciBjb2xvciA9IGNvbmZpZy5jb2xvclNjYWxlO1xyXG4gICAgICAgICAgICB2YXIgbGluZVRpcDtcclxuICAgICAgICAgICAgdmFyIGZvcm1hdERhdGUgPSBkMy50aW1lLmZvcm1hdChcIiVtLyVkLyVZXCIpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGNyZWF0ZUNoYXJ0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdyA9IGVsZW1bMF0ub2Zmc2V0V2lkdGg7XHJcbiAgICAgICAgICAgICAgICBoID0gZWxlbVswXS5vZmZzZXRIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh3LCBoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgc3ZnID0gZDMuc2VsZWN0KGVsZW1bMF0pLmFwcGVuZChcInN2Z1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJzdmctY2hhcnRcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIHcpLmF0dHIoXCJoZWlnaHRcIiwgaCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGNoYXJ0ID0gc3ZnLmFwcGVuZChcImdcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiY2hhcnRcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSgwLDApXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNoYXJ0LmFwcGVuZChcImdcIilcclxuICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcIngtYXhpc1wiKVxyXG4gICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSgwLFwiICsgKGggLSAxMDApICsgXCIpXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNoYXJ0LmFwcGVuZChcImdcIilcclxuICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInktYXhpc1wiKVxyXG4gICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSg4MCwwKVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoXCJ0ZXh0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJyb3RhdGUoLTkwKVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieVwiLCAtNDApXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkeFwiLCAtKGggLSAxMDApIC8gMilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIFwiLjcxZW1cIilcclxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC50ZXh0KGNvbmZpZy55U2NhbGVMYWJlbCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9pZiAoY29uZmlnLnRvb2x0aXApIHtcclxuICAgICAgICAgICAgICAgIC8vICAgIGNyZWF0ZVRvb2xUaXAoKTtcclxuICAgICAgICAgICAgICAgIC8vfVxyXG5cclxuICAgICAgICAgICAgICAgIHVwZGF0ZUNoYXJ0KHNjb3BlLmRhdGEpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgLy92YXIgY3JlYXRlVG9vbFRpcCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgLy8gICAgbGluZVRpcCA9IGQzLnRpcCgpLmF0dHIoJ2NsYXNzJywgJ2QzLXRpcCcpXHJcbiAgICAgICAgICAgIC8vICAgICAgICAub2Zmc2V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgLy8gICAgICAgICAgICByZXR1cm4gWzAsIDJdXHJcbiAgICAgICAgICAgIC8vICAgICAgICB9KVxyXG4gICAgICAgICAgICAvLyAgICAgICAgLmRpcmVjdGlvbignZScpXHJcbiAgICAgICAgICAgIC8vICAgICAgICAuc3R5bGUoXCJ0ZXh0LWFsaWduXCIsIFwiY2VudGVyXCIpXHJcbiAgICAgICAgICAgIC8vICAgICAgICAuaHRtbChmdW5jdGlvbiAoZCkge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgIHJldHVybiBkW3hdO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIC8vICAgIGQzLnNlbGVjdChcInN2Z1wiKS5jYWxsKGxpbmVUaXApO1xyXG4gICAgICAgICAgICAvL307XHJcblxyXG4gICAgICAgICAgICB2YXIgdXBkYXRlQ2hhcnQgPSBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNoYXJ0ID0gIGQzLnNlbGVjdChcInN2Zy5zdmctY2hhcnRcIikuc2VsZWN0KFwiZy5jaGFydFwiKTtcclxuICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhLm1hcChmdW5jdGlvbiAoZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVuaXQ6IGRbdW5pdF0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGU6IGRbZGF0ZV0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwOiBkW2dyb3VwXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVhbERhdGU6IGZvcm1hdERhdGUucGFyc2UoZFtkYXRlXSlcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgZGF0YSA9IF8uc29ydEJ5KGRhdGEsIGZ1bmN0aW9uIChkKSB7IHJldHVybiArZC5yZWFsRGF0ZTsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9TZXQgdXAgU2NhbGVzXHJcbiAgICAgICAgICAgICAgICB2YXIgbWluVmFsID0gMDtcclxuICAgICAgICAgICAgICAgIHZhciBtYXhWYWwgPSBkMy5tYXgoZGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQudW5pdDsgfSk7XHJcbiAgICAgICAgICAgICAgICAvLyBnaXZlIDEwJSBidWZmZXJzIG9uIGJvdGggc2lkZXNcclxuICAgICAgICAgICAgICAgIG1heFZhbCA9IG1heFZhbCArIChtYXhWYWwgKiAwLjA1KTtcclxuICAgICAgICAgICAgICAgIHZhciB5U2NhbGUgPSBkMy5zY2FsZS5saW5lYXIoKVxyXG4gICAgICAgICAgICAgICAgICAgIC5kb21haW4oW21pblZhbCwgbWF4VmFsXSlcclxuICAgICAgICAgICAgICAgICAgICAucmFuZ2UoWyhoLTEwMCksIDBdKTtcclxuICAgICAgICAgICAgICAgIHZhciB4U2NhbGUgPSBkMy50aW1lLnNjYWxlKClcclxuICAgICAgICAgICAgICAgICAgICAucmFuZ2UoWzgwLCB3IC0gNDBdKVxyXG4gICAgICAgICAgICAgICAgICAgIC5kb21haW4oZDMuZXh0ZW50KGRhdGEsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLnJlYWxEYXRlOyB9KSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgeEF4aXMgPSBkMy5zdmcuYXhpcygpXHJcbiAgICAgICAgICAgICAgICAgICAgLnNjYWxlKHhTY2FsZSlcclxuICAgICAgICAgICAgICAgICAgICAudGlja0Zvcm1hdChkMy50aW1lLmZvcm1hdChcIiVtLSV5XCIpKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aWNrUGFkZGluZyg2KVxyXG4gICAgICAgICAgICAgICAgICAgIC50aWNrcyhkMy50aW1lLm1vbnRoLCAxKVxyXG4gICAgICAgICAgICAgICAgICAgIC5vcmllbnQoXCJib3R0b21cIik7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHlBeGlzID0gZDMuc3ZnLmF4aXMoKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zY2FsZSh5U2NhbGUpXHJcbiAgICAgICAgICAgICAgICAgICAgLm9yaWVudChcImxlZnRcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9jaGFydC5hcHBlbmQoXCJsaW5lXCIpXHJcbiAgICAgICAgICAgICAgICAvLyAgICAuYXR0cihcIngxXCIsIHhTY2FsZShkMy5taW4oZGF0YSwgZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5yZWFsRGF0ZTsgfSkpKVxyXG4gICAgICAgICAgICAgICAgLy8gICAgLmF0dHIoXCJ4MlwiLCB4U2NhbGUoZDMubWF4KGRhdGEsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQucmVhbERhdGU7IH0pKSlcclxuICAgICAgICAgICAgICAgIC8vICAgIC5hdHRyKFwieTFcIiwgeVNjYWxlKDEwMCkpXHJcbiAgICAgICAgICAgICAgICAvLyAgICAuYXR0cihcInkyXCIsIHlTY2FsZSgxMDApKVxyXG4gICAgICAgICAgICAgICAgLy8gICAgLnN0eWxlKFwic3Ryb2tlXCIsIFwiYmxhY2tcIilcclxuICAgICAgICAgICAgICAgIC8vICAgIC5zdHlsZShcInRyb2tlLXdpZHRoXCIsIDIpXHJcbiAgICAgICAgICAgICAgICAvLyAgICAuc3R5bGUoXCJzdHJva2UtZGFzaGFycmF5XCIsIChcIjMsIDNcIikpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBncm91cHMgPSBkMy5uZXN0KClcclxuICAgICAgICAgICAgICAgICAgICAua2V5KGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmdyb3VwOyB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5lbnRyaWVzKGRhdGEpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBsaW5lID0gZDMuc3ZnLmxpbmUoKVxyXG5cdFx0XHRcdFx0LmludGVycG9sYXRlKFwibGluZWFyXCIpXHJcblx0XHRcdFx0XHQueChmdW5jdGlvbiAoZCkgeyByZXR1cm4geFNjYWxlKGQucmVhbERhdGUpOyB9KVxyXG5cdFx0XHRcdFx0LnkoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIHlTY2FsZShkLnVuaXQpOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgdmFyIGxpbmVzID0gY2hhcnQuc2VsZWN0QWxsKFwicGF0aFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5kYXRhKGdyb3VwcywgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQua2V5OyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBsaW5lcy50cmFuc2l0aW9uKClcclxuICAgICAgICAgICAgICAgICAgICAuZWFzZShcImxpbmVhclwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5kdXJhdGlvbigxMDAwKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZFwiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gbGluZShkLnZhbHVlcyk7IH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGxpbmVzLmVudGVyKCkuYXBwZW5kKFwicGF0aFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJsaW5lXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwic3Ryb2tlXCIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBjb2xvcihkLmtleSk7IH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwiZmlsbFwiLCBcIm5vbmVcIilcclxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJzdHJva2Utd2lkdGhcIiwgNSlcclxuICAgICAgICAgICAgICAgICAgICAudHJhbnNpdGlvbigpXHJcbiAgICAgICAgICAgICAgICAgICAgLmVhc2UoXCJsaW5lYXJcIilcclxuICAgICAgICAgICAgICAgICAgICAuZHVyYXRpb24oMTAwMClcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImRcIiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGxpbmUoZC52YWx1ZXMpOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL0F4ZXNcclxuICAgICAgICAgICAgICAgIGQzLnNlbGVjdChcImcueC1heGlzXCIpLmNhbGwoeEF4aXMpO1xyXG4gICAgICAgICAgICAgICAgZDMuc2VsZWN0KFwiZy55LWF4aXNcIikuY2FsbCh5QXhpcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgbGluZXMuZXhpdCgpLnJlbW92ZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vTGVnZW5kXHJcbiAgICAgICAgICAgICAgICB2YXIgbGVnZW5kID0gY2hhcnQuc2VsZWN0QWxsKFwiLmxlZ2VuZFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5kYXRhKF8udW5pcShfLnBsdWNrKGRhdGEsICdncm91cCcpKSlcclxuICAgICAgICAgICAgICAgICAgLmVudGVyKCkuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJsZWdlbmRcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBmdW5jdGlvbiAoZCwgaSkgeyByZXR1cm4gXCJ0cmFuc2xhdGUoMCxcIiArIGkgKiAyMCArIFwiKVwiOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBsZWdlbmQuYXBwZW5kKFwicmVjdFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieFwiLCB3IC0gNzIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCAxOClcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCAxOClcclxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsIGNvbG9yKTtcclxuXHJcbiAgICAgICAgICAgICAgICBsZWdlbmQuYXBwZW5kKFwidGV4dFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieFwiLCB3IC0gOTYpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIDkpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkeVwiLCBcIi4zNWVtXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwidGV4dC1hbmNob3JcIiwgXCJlbmRcIilcclxuICAgICAgICAgICAgICAgICAgICAudGV4dChmdW5jdGlvbiAoZCkgeyByZXR1cm4gZDsgfSk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goJ2RhdGEnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghZHJhd24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IGNyZWF0ZUNoYXJ0KCk7IH0sIDI1MCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlQ2hhcnQoc2NvcGUuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGRyYXduID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgdHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufSk7XHJcbiIsImFuZ3VsYXIubW9kdWxlKFwiZWhyRGFzaGJvYXJkXCIpXHJcbiAgICAuZGlyZWN0aXZlKFwic2ltcGxlTGluZUNoYXJ0XCIsIGZ1bmN0aW9uICgkdGltZW91dCwgTGluZU9wdGlvbnMpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICBkYXRhOiAnPScsXHJcbiAgICAgICAgICAgIG9wdGlvbnM6ICc9JyxcclxuICAgICAgICAgICAgZGF0ZTogJz0nLFxyXG4gICAgICAgICAgICB1bml0OiAnPSdcclxuICAgICAgICB9LFxyXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbSkge1xyXG4gICAgICAgICAgICB2YXIgbGluZUNoYXJ0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvbmZpZyA9IExpbmVPcHRpb25zLmdlbmVyYXRlT3B0aW9ucyhzY29wZS5vcHRpb25zKTtcclxuICAgICAgICAgICAgICAgIHZhciB3LCBoO1xyXG4gICAgICAgICAgICAgICAgdmFyIHVuaXQgPSBzY29wZS51bml0O1xyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGUgPSBzY29wZS5kYXRlO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJhZGl1cyA9IGNvbmZpZy5yYWRpdXM7XHJcbiAgICAgICAgICAgICAgICB2YXIgbGluZVRpcCwgc3ZnLCB4U2NhbGUsIHlTY2FsZTtcclxuICAgICAgICAgICAgICAgIC8vdmFyIGZvcm1hdE1vbnRoID0gZDMudGltZS5mb3JtYXQoXCIlWS0lbS0lZFwiKTtcclxuICAgICAgICAgICAgICAgIHZhciBmb3JtYXRNb250aExhYmVsID0gZDMudGltZS5mb3JtYXQoXCIlYi0leVwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgY3JlYXRlQ2hhcnQgPSBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHcgPSBjb25maWcud2lkdGggPyBjb25maWcud2lkdGggOiBlbGVtWzBdLm9mZnNldFdpZHRoIC0gMjA7XHJcbiAgICAgICAgICAgICAgICAgICAgaCA9IGNvbmZpZy5oZWlnaHQgPyBjb25maWcuaGVpZ2h0IDogZWxlbVswXS5vZmZzZXRIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgc3ZnID0gZDMuc2VsZWN0KGVsZW1bMF0pLmFwcGVuZChcInN2Z1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwic3ZnLXNpbXBsZS1saW5lXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgdykuYXR0cihcImhlaWdodFwiLCBoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAub24oXCJtb3VzZW92ZXJcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0KHRoaXMpLnNlbGVjdEFsbChcIi50by1zaG93XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50cmFuc2l0aW9uKCkuZHVyYXRpb24oNTAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAub24oXCJtb3VzZW91dFwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkMy5zZWxlY3QodGhpcykuc2VsZWN0QWxsKFwiLnRvLXNob3dcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudHJhbnNpdGlvbigpLmR1cmF0aW9uKDUwMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNoYXJ0ID0gc3ZnLmFwcGVuZChcImdcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImNoYXJ0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKDAsMClcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNoYXJ0LmFwcGVuZChcInRleHRcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInRpdGxlIHRvLXNob3dcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkeFwiLCB3IC8gMilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkeVwiLCAxMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIDEwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50ZXh0KGNvbmZpZy50aXRsZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAwKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2hhcnQuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwieC1heGlzLXRpbWUgdG8tc2hvd1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSgwLFwiICsgKGggLSAyNSkgKyBcIilcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAwKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2hhcnQuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInktYXhpcy10aW1lXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSg4MCwwKVwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZy50b29sdGlwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZVRvb2xUaXAoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhLm1hcChmdW5jdGlvbiAoZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5pdDogZFt1bml0XSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vZGF0ZTogZFtkYXRlXS5zdWJzdHJpbmcoMCwgMTApLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhbERhdGU6IGRbZGF0ZV0gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBkYXRhID0gZGF0YS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiArYS5yZWFsRGF0ZSAtIGIucmVhbERhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIFNldCB1cCBzY2FsZXNcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbWluVmFsID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbWF4VmFsID0gZDMubWF4KGRhdGEsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLnVuaXQ7IH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBHaXZlIDEwJSBidWZmZXJzIG9uIGJvdGggc2lkZXNcclxuICAgICAgICAgICAgICAgICAgICBtYXhWYWwgPSBtYXhWYWwgKyAobWF4VmFsICogMC4wNSk7XHJcbiAgICAgICAgICAgICAgICAgICAgeVNjYWxlID0gZDMuc2NhbGUubGluZWFyKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmRvbWFpbihbbWluVmFsLCBjb25maWcueU1heF0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yYW5nZShbKGggLSAxMCksIDEwXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgeFNjYWxlID0gZDMudGltZS5zY2FsZSgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yYW5nZShbMTUsIHctMjBdKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZG9tYWluKGQzLmV4dGVudChkYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5yZWFsRGF0ZTsgfSkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVDaGFydChkYXRhKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGNyZWF0ZUxpbmUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY2hhcnQgPSBzdmcuc2VsZWN0KFwiZy5jaGFydFwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2hhcnQuYXBwZW5kKFwibGluZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcIngxXCIsIDE1KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcIngyXCIsIHcgLSAyMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ5MVwiLCB5U2NhbGUoY29uZmlnLnN0cmFpZ2h0TGluZSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieTJcIiwgeVNjYWxlKGNvbmZpZy5zdHJhaWdodExpbmUpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJzdHJva2VcIiwgXCJibGFja1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDAuNCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNoYXJ0LmFwcGVuZChcInRleHRcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInRvLXNob3dcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkeFwiLCAodyAtIDIwKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkeVwiLCB5U2NhbGUoY29uZmlnLnN0cmFpZ2h0TGluZSkgKyAyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImZvbnQtc2l6ZVwiLCA4KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50ZXh0KGNvbmZpZy5zdHJhaWdodExpbmUgKyBcIiVcIik7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBjcmVhdGVUb29sVGlwID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxpbmVUaXAgPSBkMy50aXAoKS5hdHRyKCdjbGFzcycsICdkMy10aXAnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAub2Zmc2V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbLTgsIDBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZGlyZWN0aW9uKCduJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwidGV4dC1hbGlnblwiLCBcImNlbnRlclwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuaHRtbChmdW5jdGlvbiAoZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoZC51bml0ICogMTAwKSAvIDEwMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgc3ZnLmNhbGwobGluZVRpcCk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB1cGRhdGVDaGFydCA9IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlTGluZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjaGFydCA9IHN2Zy5zZWxlY3QoXCJnLmNoYXJ0XCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgeEF4aXMgPSBkMy5zdmcuYXhpcygpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zY2FsZSh4U2NhbGUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aWNrRm9ybWF0KGZvcm1hdE1vbnRoTGFiZWwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aWNrUGFkZGluZyg2KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGlja3MoZDMudGltZS5tb250aCwgY29uZmlnLnhBeGlzRnJlcSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLm9yaWVudChcImJvdHRvbVwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHlBeGlzID0gZDMuc3ZnLmF4aXMoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc2NhbGUoeVNjYWxlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGlja3MoNilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLm9yaWVudChcImxlZnRcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBsaW5lID0gZDMuc3ZnLmxpbmUoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAueChmdW5jdGlvbiAoZCkgeyByZXR1cm4geFNjYWxlKGQucmVhbERhdGUpOyB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAueShmdW5jdGlvbiAoZCkgeyByZXR1cm4geVNjYWxlKGQudW5pdCk7IH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjaGFydC5hcHBlbmQoXCJwYXRoXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5kYXR1bShkYXRhKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwibGluZXNcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwic3Ryb2tlXCIsIGNvbmZpZy5jb2xvcilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZWFzZShcImxpbmVhclwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZHVyYXRpb24oMTAwMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkXCIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBsaW5lKGQpOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQXhlc1xyXG4gICAgICAgICAgICAgICAgICAgIHN2Zy5zZWxlY3QoXCJnLngtYXhpcy10aW1lXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYWxsKHhBeGlzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8vLyBBeGVzXHJcbiAgICAgICAgICAgICAgICAgICAgLy9kMy5zZWxlY3QoXCJnLnktYXhpcy10aW1lXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgLmNhbGwoeUF4aXMpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL0NpcmNsZXNcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY2lyY2xlcyA9IGNoYXJ0LnNlbGVjdEFsbChcImNpcmNsZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZGF0YShkYXRhKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2lyY2xlcy5lbnRlcigpLmFwcGVuZChcImNpcmNsZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsIGNvbmZpZy5jb2xvcilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJyXCIsIHJhZGl1cylcclxuICAgICAgICAgICAgICAgICAgICAgICAgLm9uKCdtb3VzZW92ZXInLCBmdW5jdGlvbiAoZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0KHRoaXMpLnRyYW5zaXRpb24oKS5kdXJhdGlvbig1MDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJyXCIsIChyYWRpdXMgKyAocmFkaXVzICogMC45KSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZVRpcC5zaG93KGQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAub24oJ21vdXNlb3V0JywgZnVuY3Rpb24gKGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdCh0aGlzKS50cmFuc2l0aW9uKCkuZHVyYXRpb24oNTAwKS5hdHRyKFwiclwiLCByYWRpdXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZVRpcC5oaWRlKGQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2lyY2xlcy50cmFuc2l0aW9uKCkuZHVyYXRpb24oMTAwMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmVhc2UoXCJib3VuY2VcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjeFwiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4geFNjYWxlKGQucmVhbERhdGUpOyB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImN5XCIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiB5U2NhbGUoZC51bml0KTsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNpcmNsZXMuZXhpdCgpLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goJ2RhdGEnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLmRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlQ2hhcnQoc2NvcGUuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICR0aW1lb3V0KGxpbmVDaGFydCwgMCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufSk7XHJcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
