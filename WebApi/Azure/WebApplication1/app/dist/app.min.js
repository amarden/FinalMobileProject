angular.module('ehrDashboard', [
    'ngAnimate',
    'ngAria',
    'ngMaterial',
    //'ui-router'
])
.config(["$mdThemingProvider", function ($mdThemingProvider) {
    $mdThemingProvider.theme('default')
      .primaryPalette('blue')
      .accentPalette('green');
}])
//.config(function ($stateProvider) {
//    $stateProvider
//        .state('home',
//        {
//            url: "/",
//            templateUrl: "core/home.html",
//            controller: "HomeCtrl",
//            controllerAs: "mc"
//        });
//});

angular.module("ehrDashboard")
.directive("barSpark", function(){
    return {
        restrict : 'E',
        scope: {
            data: '=',
            prop: '=',
            group: '='
        },
        template: '',
        link: function(scope, elem) {
            var drawChart = function(data,prop,group) {
                var color = d3.scale.category10();
                var div = elem[0];
                var w = div.offsetWidth;
                var h = Math.max(div.offsetHeight, 280);
                var xScale = d3.scale.linear().domain([0, Math.ceil(d3.max(data, function(d) { return d[prop]; }))]).range([0,w/1.6]);
                var yScale = d3.scale.ordinal().domain(data.map(function(d) { return d[group]; })).rangeRoundBands([10,h-50], 0.2);
                var svg = d3.select(div).append("svg").attr("height",h).attr("width",w);
                var graph = svg.append("g").attr("transform","translate(0,20)");
                var g = graph.selectAll("g").data(data)
                    .enter().append("g")
                    .attr("transform", function(d) { return "translate(30,"+yScale(d[group])+")"; });

                var xAxisNum = d3.svg.axis()
                    .scale(xScale)
                    .orient("bottom");

                svg.append("g")
                    .attr("class","x axis")
                    .attr("transform","translate(30," +(h - 25)+")")
                    .call(xAxisNum);

                g.append("rect")
                    .attr("class","spark")
                    .attr("width", function(d) { return xScale(d[prop])})
                    .attr("height", yScale.rangeBand())
                    .style("fill", "steelblue")
                    .style("stroke", "#386890")
                    .style("stroke-width",2);

                g.append("text")
                    .attr("dy", yScale.rangeBand()/2)
                    .attr("dx", 4)
                    .style("fill","white")
                    .style("font-size",12)
                    .style("text-anchor","start")
                    .text(function(d) { return d[group]; });

                g.append("text")
                    .attr("dy", yScale.rangeBand()/2)
                    .style("font-size",15)
                    .style("fill","white")
                    .attr("dx", function(d) { return (xScale(d[prop])-5); })
                    .style("text-anchor","end")
                    .text(function(d) { return d[prop]+"%"; });

                //line chart
                var parseDate = d3.time.format("%m/%d/%Y").parse;
                var xScaleTime = d3.time.scale().range([w/1.5,w-100]).domain(d3.extent(data[0].time, function(d) { return parseDate(d.quarter);}));
                var xAxis = d3.svg.axis()
                    .scale(xScaleTime)
                    .ticks(d3.time.month, 3)
                    .tickFormat(d3.time.format("%b"))
                    .orient("bottom");

                var yTimes = {};

                var line = d3.svg.line()
                    .interpolate("linear")
                    .x(function(d) { return xScaleTime(parseDate(d.quarter)); })
                    .y(function(d) { return yTimes[d.type](d[prop]); });

                g.append("path")
                    .attr("fill","none")
                    .attr("stroke","steelblue")
                    .attr("stroke-width",2)
                    .datum(function(d) {
                        if (!yTimes[d.type]) {
                            yTimes[d.type] = d3.scale.linear()
                                .range([yScale.rangeBand(),10])
                                .domain([-10, 10]);
                                //.domain([(d3.min(d.time, function(d) { return d[prop];})-1), (d3.max(d.time, function(d) { return d[prop];})+1)]);
                        }
                        return d.time;
                    })
                    .attr("d",line);

                g.append("line")
                    .style("stroke-dasharray", ("3", "3"))
                    .style("stroke", "black")
                    .attr("x1", xScaleTime.range()[0])
                    .attr("x2", xScaleTime.range()[1])
                    .attr("y1", function(d) { return yTimes[d.type](0)})
                    .attr("y2", function(d) { return yTimes[d.type](0)});

                g.append("text")
                    .attr("transform", function(d) {
                        return "translate(" + (xScaleTime.range()[1] + 16) + "," + (yTimes[d.type](0) + 5) + ")";
                    })
                    .attr("text-anchor", "middle")
                    .style("font-size", "13px")
                    .text("0%");

                g.selectAll("circle")
                    .data(function(d) { return d.time; })
                .enter().append("circle")
                    .attr("cx", function(d) {
                        return xScaleTime(parseDate(d.quarter));
                    })
                    .attr("cy", function(d) { return yTimes[d.type](d[prop]); })
                    .attr("r", "3px")
                    .attr("fill", "#386890")
                    .attr("stroke", "none");

                svg.append("g")
                    .attr("class","x axis")
                    .attr("transform","translate(30," +(h - 25)+")")
                    .call(xAxis);

                svg.append("text")
                    .attr("y", 15)
                    .attr("x", 30+(w/1.6)/2)
                    .style("text-anchor","middle")
                    .text("Prevalence of Metric - Current Quarter");

                svg.append("text")
                    .attr("y", 15)
                    .style("text-anchor","middle")
                    .attr("x",5+(w/1.6)+((w-(w/1.6))/2))
                    .text("Percent Change From Baseline");
            };

            scope.$watch('data', function() {
                if (scope.data){
                    drawChart(scope.data, scope.prop, scope.group);
                }
            }), true;
        }
    };
});

angular.module("ehrDashboard")
.directive("bubbleChart", function(){
    return {
        restrict : 'E',
        scope: {
            data: '='
        },
        template: '',
        link: function(scope, elem) {
            var drawChart = function(data) {
                var div = elem[0];
                var w = div.offsetWidth;
                var h = div.offsetHeight;
                var svg = d3.select(div).append("svg").attr("height",h).attr("width",w);
                var graph = svg.append("g").attr("transform","translate(0,20)");
                //line chart
                var xScaleTime = d3.time.scale().range([60,w-50]).domain(d3.extent(data, function(d) { return parseDate(d.date); }));
                var xAxis = d3.svg.axis()
                    .scale(xScaleTime)
                    .ticks(d3.time.month, 3)
                    .tickFormat(d3.time.format("%b"))
                    .orient("bottom");

                var yScaleTime = d3.scale.linear().range([h-50,0])
                    .domain([d3.min(types, function(d) { return d3.min(d.values, function(x) { return x.value; }); }),
                        d3.max(types, function(d) { return d3.max(d.values, function(x) { return x.value; }); })]);
                var yAxis = d3.svg.axis()
                    .scale(yScaleTime)
                    .orient("left");

                var line = d3.svg.line()
                    .interpolate("basis")
                    .x(function(d) { return xScaleTime(parseDate(d.date)); })
                    .y(function(d) { return yScaleTime(d.value); });

                graph.append("g")
                    .attr("class","x-axis")
                    .attr("transform","translate(0,"+(h-60)+")")
                    .call(xAxis);

                svg.append("g")
                    .attr("transform","translate(60,0)")
                    .attr("class", "x-axis")
                    .call(yAxis)
                    .append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 6)
                    .attr("dy", ".71em")
                    .style("text-anchor", "end")
                    .text("USD $");

                var type = svg.selectAll("g.multi")
                    .data(types)
                    .enter().append("g")
                    .attr("class","multi");

                type.append("path")
                    .attr("class", "line")
                    .attr("d", function(d) { return line(d.values); })
                    .style("stroke", function(d) { return color(d.name); })
                    .attr("fill","none");

                type.append("text")
                    .datum(function(d) { return {name: d.name, value: d.values[d.values.length - 1]}; })
                    .attr("transform", function(d) { return "translate(" + (xScaleTime(parseDate(d.value.date))-50) + "," + (yScaleTime(d.value.value)-10) + ")"; })
                    .attr("x", 3)
                    .attr("dy", ".35em")
                    .style("font-size",11)
                    .text(function(d) { return d.name === 'totalMoney' ? "Money Recovered" : "Money Outstanding"; });
            };

            scope.$watch('data', function() {
                if (scope.data){
                    drawChart(scope.data);
                }
            }, true);
        }
    };
});

angular.module('ehrDashboard')
    .factory("ChartOptions", function () {
    return {
        defaults: [
        { 'propName': 'margin', 'defaultValue': { "top": 0, "left": 0, "right": 0, "bottom": 0 } },
        { 'propName': 'colorScale', 'defaultValue': d3.scale.category10() },
        { 'propName': 'drawLegend', 'defaultValue': false },
        { 'propName': 'drawYAxis', 'defaultValue': false },
        { 'propName': 'tooltip', 'defaultValue': false },
        { 'propName': 'dateFormat', 'defaultValue': d3.time.format("%m/%d/%Y") },
        { 'propName': 'tickFormat', 'defaultValue': d3.time.month },
        { 'propName': 'tickSpacing', 'defaultValue': 1 },
        { 'propName': 'dateAxisFormat', 'defaultValue': d3.time.format("%m-%y") },
        { 'propName': 'timeUnit', 'defaultValue': 'month' },
        { 'propName': 'min', 'defaultValue': 'min' },
        { 'propName': 'max', 'defaultValue': 'max' },
        { 'propName': 'yScaleLabel', 'defaultValue': '' },
        { 'propName': 'title', 'defaultValue': '' },
        { 'propName': 'onClick', 'defaultValue': '' },
        ],
        generateOptions: function (options) {
            var controls = options ? options : {};
            this.defaults.forEach(function (d) {
                if (!controls.hasOwnProperty(d.propName)) {
                    controls[d.propName] = d.defaultValue;
                }
            });
            return controls;
        }
    };
});

angular.module("ehrDashboard")
    .service("Calculate", function () {
        this.getMetrics = function (patient, provider) {
            var metric = {};
            metric.ageAverage = patient
                .map(function (d) { return d.Age })
                .reduce(function (a, b) { return a + b; })
                / patient.length;

            metric.chatAverage = patient
                .map(function (d) { return d.chatCount })
                .reduce(function (a, b) { return a + b; })
                / patient.length;

            metric.imageAverage = patient
                .map(function (d) { return d.imageCount })
                .reduce(function (a, b) { return a + b; })
                / patient.length;

            metric.providerAverage = patient
                .map(function (d) { return d.providerCount })
                .reduce(function (a, b) { return a + b; })
                / patient.length;

            var groupDiag = _.groupBy(patient, "diagnosis");
            metric.topDiagnoses = _.map(groupDiag, function (data, key) {
                return {
                    group: key,
                    number: data.length
                };
            });

            var procDiag = _.groupBy(_.flatten(patient.map(function (d) { return d.procedures.map(function (x) { return x.ProcedureCode.Procedure; }) })));
            metric.topProcedures = _.map(procDiag, function (data, key) {
                return {
                    group: key,
                    number: data.length
                };
            });

            var roleGroup = _.groupBy(provider.map(function (d) { return d.Role; }));
            metric.roleCount = _.map(roleGroup, function (data, key) {
                return {
                    group: key,
                    number: data.length
                };
            });

            var statusGroup = _.groupBy(patient.map(function (d) { return d.MedicalStatus; }));
            metric.statusCount = _.map(statusGroup, function (data, key) {
                return {
                    group: key,
                    number: data.length
                };
            });

            return metric;
        };
    });
angular.module("ehrDashboard")
    .service("Data", ["$http", function($http){
        this.getData = function () {
            return $http.get("api/Dashboard")
                .then(function (data) {
                    return data;
                });
        };
    }]);

angular.module("ehrDashboard")
    .controller("HomeCtrl", ["Data", "Calculate", function(Data, Calculate) {
        var vm = this;
        vm.data = {};
        vm.groupDiag = "group";
        vm.unit = "number";
        Data.getData().then(function (data) {
            vm.data = data.data;
            vm.processed = Calculate.getMetrics(vm.data.patients, vm.data.providers);
        });
    }]);  
angular.module("ehrDashboard")
    .controller("MainCtrl", ["Data", "Calculate", function(Data, Calculate) {
        var vm = this;
        vm.data = {};
        vm.groupDiag = "group";
        vm.unit = "number";
        Data.getData().then(function (data) {
            console.log(data.data);
            vm.data = data.data;
            vm.processed = Calculate.getMetrics(vm.data.patients, vm.data.providers);
        });
    }]);  
Array.prototype.groupByAndSum = function (groupBy, unit) {
    var group = _.groupBy(this, groupBy);
    return _.map(group, function (g, key) {
        return {
            group: key,
            unit: pmdCalcHelpers.sum(g, unit)
        };
    });
};

Array.prototype.includeItems = function (list, item) {
    return _.filter(this, function (d) {
        return list.indexOf(d[item]) > -1;
    });
};

Array.prototype.filterZero = function (property) {
    return _.filter(this, function (item) {
        return item[property] > 0;
    });
};

Array.prototype.sortBy = function (prop) {
    return _.sortBy(this, function (d) { return -d[prop]; });
};

angular.module("ehrDashboard")
    .directive("barChart", ["BarOptions", function (BarOptions) {
        return {
            restrict: 'E',
            scope: {
                data: '=',
                options: '=',
                group: '=',
                unit: '=',
            },
            link: function (scope, elem) {
                var config = BarOptions.generateOptions(scope.options);
                config.margin.left = 250;
                var w, h;
                var y = scope.group || 'group';
                var x = scope.unit || 'unit';
                var drawn = false;
                var barTip;
                var svg;

                var createChart = function () {
                    w = config.width ? config.width : elem[0].offsetWidth;
                    h = config.height ? config.height : elem[0].offsetHeight;
                    h = 185;
                    svg = d3.select(elem[0]).append("svg")
                        .attr("width", w).attr("height", h);

                    svg.append("text")
                       .attr("class", "title")
                       .attr("dx", w / 2)
                       .attr("dy", 10)
                       .style("font-size", 10)
                       .attr("text-anchor", "middle")
                       .text(config.chartTitle);

                    svg.append("g")
                        .attr("class", "chart")
                        .attr("transform", "translate(" + config.margin.left + "," + config.margin.top + ")");

                    svg.select("g.chart").append("g")
                        .attr("class", "axis")
                        .attr("transform", "translate(0,5)");

                    if (config.tooltip) {
                        createToolTip();
                    }

                    updateChart(scope.data);
                };

                var createToolTip = function () {
                    barTip = d3.tip().attr('class', 'd3-tip')
                        .offset(function () {
                            return [0, 2];
                        })
                        .direction('e')
                        .style("text-align", "center")
                        .html(function (d) {
                            return Math.round(d[x] * 100) / 100;
                        });
                    svg.call(barTip);
                };

                var updateChart = function (data) {
                    data.sort(function (a, b) {
                        return a[y] < b[y] ? 1  : -1;
                    });

                    var yScaleHeight = Math.max(h - config.margin.top, data.length * 13);
                    if (data.length * 13 > h - config.margin.top) {
                        svg.attr("height", (data.length * 13 + config.margin.top));
                    } else {
                        svg.attr("height", h);
                    }
                    d3.select(elem[0]).style("height", h + "px");

                    var xMax = config.maxX || d3.max(data.filter(function (d) { return d[x] !== Infinity; }), function (d) { return d[x]; });
                    var xScale = d3.scale.linear()
                        .domain([0, xMax])
                        .range([0, (w - config.margin.right - config.margin.left)]);

                    var yScale = d3.scale.ordinal()
                        .domain(data.map(function (d) { return d[y]; }))
                        .rangeBands([10, yScaleHeight - config.margin.bottom], 0.05);

                    var barHeight = yScale.rangeBand();

                    var xAxis = d3.svg.axis()
                       .scale(xScale)
                       .orient("top");

                    if (config.tickNumbers) {
                        xAxis.ticks(5);
                    }

                    svg.select("g.axis")
                        .transition().duration(500)
                        .call(xAxis);

                    var barContainer = svg.select("g.chart").selectAll("g.bars")
                        .data(data, function (d) { return d[y]; });

                    barContainer.exit()
                        .transition().duration(500)
                        .delay(function (d, i) { return i * 20; })
                        .attr("transform", "translate(0," + (h + 200) + ")")
                        .remove();

                    var barEnter = barContainer.enter().append("g")
                        .attr("class", "bars")
                        .attr("transform", function (d) {
                            return "translate(0," + yScale(d[y]) + ")";
                        })
                        .style("opacity", 0);

                    barEnter.append("rect")
                        .attr("class", "bar")
                        .attr("y", 0)
                        .attr("fill", function (d) {
                            return config.colorBy === 'none' ? config.color :
                                color(d[config.colorBy]);
                        })
                        .on("mouseover", barTip.show)
                        .on("mouseout", barTip.hide);

                    barEnter.append("text")
                        .attr("class", "bar-label")
                        .attr("text-anchor", "end")
                        .attr("font-size", "12")
                        .attr("dx", -1)
                        .attr("dy", ".35em");

                    barContainer.select("rect")
                        .transition().duration(500)
                        .attr("width", function (d) {
                            return d[x] === Infinity ? 0 : xScale(d[x]);
                        })
                        .attr("height", barHeight);

                    barContainer.select("text.bar-label")
                        .transition().duration(500)
                        .attr("y", barHeight / 2)
                        .text(function (d) {
                            return d[y];
                        });

                    barContainer.transition().duration(1000)
                        .style("opacity", 1)
                        .attr("transform", function (d) { return "translate(0," + yScale(d[y]) + ")"; });
                };

                scope.$watch('data', function () {
                    if (scope.data) {
                        if (!drawn) {
                            setTimeout(function () { createChart(); }, 250);
                        } else {
                            updateChart(scope.data);
                        }
                        drawn = true;
                    }
                }, true);
            }
        };
}]);

angular.module("ehrDashboard")
    .factory("BarOptions", function () {
        return {
            defaults: [
            { 'propName': 'margin', 'defaultValue': { "top": 50, "left": 100, "right": 150, "bottom": 50 } },
            { 'propName': 'chartTitle', 'defaultValue': ""},
            { 'propName': 'color', 'defaultValue': 'steelblue' },
            { 'propName': 'colorBy', 'defaultValue': 'none' },
            { 'propName': 'tooltip', 'defaultValue': true },
            { 'propName': 'fitToHeight', 'defaultValue': true },
            { 'propName': 'tickNumbers', 'defaultValue': null },
            { 'propName': 'width', 'defaultValue': null },
            { 'propName': 'height', 'defaultValue': null },
            { 'propName': 'maxX', 'defaultValue': null }
            ],
            generateOptions: function (options) {
                var controls = options ? options : {};
                this.defaults.forEach(function (d) {
                    if (!controls.hasOwnProperty(d.propName)) {
                        controls[d.propName] = d.defaultValue;
                    }
                });
                return controls;
            }
        };
});

angular.module('ehrDashboard')
    .directive("groupBar", ["$location", function ($location) {
    return {
        restrict: 'E',
        templateNameSpace: 'svg',
        link: function (scope, elem) {
            var createChart = function (data) {
                var margin = { top: 10, right: 20, bottom: 80, left: 40 };
                var width = elem[0].offsetWidth - margin.right - margin.left;
                var height = elem[0].offsetHeight - margin.top - margin.bottom;

                console.log(width, height);
                var x0 = d3.scale.ordinal()
                    .rangeRoundBands([0, width], 0.1);

                var x1 = d3.scale.ordinal();

                var y = d3.scale.linear()
                    .range([height, 0]);

                var color = d3.scale.ordinal()
                    .range(["red", "blue", "purple"])
                    .domain(["Overhead", "Billable", "Proposal"]);

                var xAxis = d3.svg.axis()
                    .scale(x0)
                    .orient("bottom");

                var yAxis = d3.svg.axis()
                    .scale(y)
                    .orient("left")
                    .tickFormat(d3.format(".2s"));

                var svg = d3.select(elem[0]).append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                  .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
                var options = _.uniq(_.pluck(data, 'chargeType')).sort();
                var groupByPerson = _.groupBy(data, 'employee');
                var groupedData = _.map(groupByPerson, function (d, key) {
                    return {
                        name: key,
                        empId: d[0].empId,
                        data: d
                    };
                });

                x0.domain(groupedData.map(function (d) { return d.name; }));
                x1.domain(options).rangeRoundBands([0, x0.rangeBand()]);
                y.domain([0, d3.max(groupedData, function (d) { return d3.max(d.data, function (d) { return d.hours; }); })]);

                svg.append("g")
                  .attr("class", "x axis")
                  .attr("transform", "translate(0," + height + ")")
                  .call(xAxis);

                svg.append("g")
                    .attr("class", "y axis")
                    .call(yAxis)
                  .append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 6)
                    .attr("dy", ".71em")
                    .style("text-anchor", "end")
                    .text("Hours");

                var state = svg.selectAll(".state")
                    .data(groupedData)
                  .enter().append("g")
                    .attr("class", "g")
                    .attr("transform", function (d) { return "translate(" + x0(d.name) + ",0)"; })
                    .on("click", function (d) {
                        console.log(d.empId, d);
                        scope.$apply(function () {
                            $location.path("timesheet/" + d.empId);
                        });
                    });

                state.selectAll("rect")
                    .data(function (d) { return d.data; })
                  .enter().append("rect")
                    .attr("width", x1.rangeBand())
                    .attr("x", function (d) { return x1(d.chargeType); })
                    .attr("y", function (d) { return y(d.hours); })
                    .attr("height", function (d) { return height - y(d.hours); })
                    .style("fill", function (d) { return color(d.chargeType); });

                var legend = svg.selectAll(".legend")
                    .data(options.slice().reverse())
                  .enter().append("g")
                    .attr("class", "legend")
                    .attr("transform", function (d, i) { return "translate(0," + i * 20 + ")"; });

                legend.append("rect")
                    .attr("x", width - 18)
                    .attr("width", 18)
                    .attr("height", 18)
                    .style("fill", color);

                legend.append("text")
                    .attr("x", width - 24)
                    .attr("y", 9)
                    .attr("dy", ".35em")
                    .style("text-anchor", "end")
                    .text(function (d) { return d; });
            };

            scope.$watch('billingData', function () {
                if (scope.billingData) {
                    setTimeout(function () { createChart(scope.billingData); }, 100);
                }
            }, true);
        }
    };
}]);

angular.module('ehrDashboard')
    .directive("stackBarChart", ["$timeout", "ChartOptions", function ($timeout, ChartOptions) {
        return {
            restrict: 'E',
            scope: {
                data: '=',
                options: '=',
                date: '=',
                group: '=',
                unit: '='
            },
            link: function (scope, elem) {
                var stackBar = function () {
                    var svg, chart, width, height, yAxis;
                    var config = ChartOptions.generateOptions(scope.options);
                    var color = config.colorScale;
                    var toolTip;
                    //var formatDate = config.dateFormat;
                    var unit = scope.unit;
                    var date = scope.date;
                    var group = scope.group;
                    var stack = d3.layout.stack()
                       .values(function (d) { return d.values; })
                       .x(function (d) { return d.realDate; })
                       .y(function (d) { return d.unit; });

                    var margin = config.margin;

                    var drawYAxis = function () {
                        chart.append("g")
                            .attr("class", "y axis")
                            .attr("transform", "translate(50,0)")
                            .call(yAxis)
                          .append("text")
                            .attr("transform", "rotate(-90)")
                            .attr("y", -45)
                            .attr("dx", -(height - 100) / 2)
                            .attr("dy", ".71em")
                            .style("text-anchor", "middle")
                            .text(config.yScaleLabel);
                    };

                    var drawLegend = function (data) {
                        //Legend
                        var onlyValues = data.filter(function (d) { return d.unit !== 0; });
                        var legend = chart.selectAll(".legend")
                            .data(_.uniq(_.pluck(onlyValues, 'group')))
                          .enter().append("g")
                            .attr("class", "legend")
                            .attr("transform", function (d, i) { return "translate(0," + i * 20 + ")"; });

                        legend.append("rect")
                            .attr("x", width - 72)
                            .attr("width", 18)
                            .attr("height", 18)
                            .style("fill", color);

                        legend.append("text")
                            .attr("x", width - 96)
                            .attr("y", 9)
                            .attr("dy", ".35em")
                            .style("text-anchor", "end")
                            .text(function (d) { return d; });
                    };

                    var createToolTip = function () {
                        toolTip = d3.tip().attr('class', 'd3-tip')
                            .offset(function () {
                                return [config.toolTipAdjustTop, 0];
                            })
                            .direction('e')
                            .style("text-align", "center")
                            .html(function (d) {
                                return d.group + "<br /> " + d.unit + " " + config.toolTipUnit;
                            });
                        svg.call(toolTip);
                    };

                    var createChart = function (data) {
                        data = data.map(function (d) {
                            return {
                                unit: d[unit],
                                date: d[date],
                                group: d[group],
                                realDate: new moment(d[date])._d
                            };
                        });

                        var dates = _.uniq(data.map(function (d) { return d.date; }));
                        var categories = _.uniq(data.map(function (d) { return d.group; }));

                        dates.forEach(function (date) {
                            categories.forEach(function (cat) {
                                var match = _.find(data, function (d) { return d.date === date && d.group === cat; });
                                if (!match) {
                                    var dummy = { unit: 0, group: cat, realDate: new moment(date)._d, date: date };
                                    data.push(dummy);
                                }
                            });
                        });

                        data = _.sortBy(data, function (d) { return d.realDate; });
                        data = _.sortBy(data, function (d) { return d.group; });

                        var groups = d3.nest()
                            .key(function (d) { return d.group; }).entries(data);

                        var days = stack(groups);
                        width = elem[0].offsetWidth;
                        height = config.height ? config.height : elem[0].offsetHeight;
                        var chartHeight = height - margin.bottom;

                        svg = d3.select(elem[0]).append("svg")
                            .attr("class", "svg-chart")
                            .attr("width", width).attr("height", height);

                        chart = svg.append("g")
                            .attr("class", "chart")
                            .attr("transform", "translate(0,0)")
                            .on("mouseover", function () {
                                d3.select(this).selectAll(".to-show")
                                       .transition().duration(500)
                                       .style("opacity", 1);
                            })
                            .on("mouseout", function () {
                                d3.select(this).selectAll(".to-show")
                                    .transition().duration(500)
                                    .style("opacity", 0);
                            });

                        chart.append("text")
                            .attr("class", "title to-show")
                            .attr("dx", width / 2)
                            .attr("dy", margin.top - 10)
                            .style("font-size", 10)
                            .attr("text-anchor", "middle")
                            .text(config.titleText)
                            .style("opacity", 0);

                        var xScale = d3.scale.ordinal()
                            .rangeRoundBands([margin.left, width - margin.right], 0.08)
                            .domain(_.uniq(data.map(function (d) { return d.realDate; })));

                        var min = typeof (config.min) === 'number' ? config.min :
                            d3.min(data, function (d) { return d.unit; });

                        var totals = _.map(_.groupBy(data, 'date'),
                            function (data) { return _.reduce(data, function (m, x) { return m + x.unit; }, 0); });

                        var max = typeof (config.max) === 'number' ? config.max :
                            d3.max(totals, function (d) { return d; });

                        var yScale = d3.scale.linear()
                            .range([chartHeight, margin.top])
                            .domain([min, max]);

                        var xAxis = d3.svg.axis()
                            .scale(xScale)
                            .tickFormat(config.dateAxisFormat)
                            .orient("bottom");

                        yAxis = d3.svg.axis()
                            .scale(yScale)
                            .orient("left");

                        chart.append("g")
                            .attr("class", "x axis to-show")
                            .style("opacity", 0)
                            .attr("transform", "translate(0," + (height - margin.bottom - 5) + ")")
                            .call(xAxis);

                        // Add a group for each cause.
                        var barCont = chart.selectAll("g.day")
                            .data(days)
                          .enter().append("svg:g")
                            .attr("class", "day")
                            .style("fill", function (d) { return color(d.key); })
                            .style("stroke", function (d) { return d3.rgb(color(d.key)).darker(); });

                        // Add a rect for each date.
                        barCont.selectAll("rect")
                            .data(function (d) { return d.values; })
                          .enter().append("svg:rect")
                            .attr("x", function (d) { return xScale(d.realDate); })
                            .attr("y", function (d) { return yScale(d.y) - ((chartHeight) - yScale(d.y0)); })
                            .attr("height", function (d) { return (chartHeight) - yScale(d.y); })
                            .attr("width", xScale.rangeBand())
                            .on('mouseover', function (d) {
                                toolTip.show(d);
                            })
                            .on('mouseout', function (d) {
                                toolTip.hide(d);
                            });

                        createToolTip();
                        if (config.drawYAxis) {
                            drawYAxis(data);
                        }
                        if (config.drawLegend) {
                            drawLegend(data);
                        }
                    };

                    scope.$watch('data', function () {
                        if (scope.data) {
                            setTimeout(function () { createChart(scope.data); }, 250);
                        }
                    }, true);
                };
                $timeout(stackBar, 0);
            }
        };
    }]);

angular.module("ehrDashboard")
    .directive("vBarChart", ["BarOptions", function (BarOptions) {
        return {
            restrict: 'E',
            scope: {
                data: '=',
                options: '=',
                group: '=',
                unit: '=',
            },
            link: function (scope, elem) {
                var config = BarOptions.generateOptions(scope.options);
                var w, h;
                var y = scope.group || 'group';
                var x = scope.unit || 'unit';
                var drawn = false;
                var barTip;
                var svg;

                var createChart = function () {
                    w = config.width ? config.width : elem[0].offsetWidth;
                    h = config.height ? config.height : elem[0].offsetHeight;

                    svg = d3.select(elem[0]).append("svg")
                        .attr("width", w).attr("height", h);

                    svg.append("text")
                       .attr("class", "title")
                       .attr("dx", w / 2)
                       .attr("dy", 10)
                       .style("font-size", 10)
                       .attr("text-anchor", "middle")
                       .text(config.chartTitle);

                    svg.append("g")
                        .attr("class", "chart")
                        .attr("transform", "translate(" + config.margin.left + "," + config.margin.top + ")");

                    svg.select("g.chart").append("g")
                        .attr("class", "x-axis")
                        .attr("transform", "translate(0,5)");

                    if (config.tooltip) {
                        createToolTip();
                    }

                    updateChart(scope.data);
                };

                var createToolTip = function () {
                    barTip = d3.tip().attr('class', 'd3-tip')
                        .offset(function () {
                            return [0, 2];
                        })
                        .direction('e')
                        .style("text-align", "center")
                        .html(function (d) {
                            return Math.round(d[x] * 100) / 100;
                        });
                    svg.call(barTip);
                };

                var updateChart = function (data) {
                    data.sort(function (a, b) {
                        return a[y] < b[y] ? 1 : -1;
                    });

                    var yScaleHeight = Math.max(h - config.margin.top, data.length * 13);

                    if (data.length * 13 > h - config.margin.top) {
                        svg.attr("height", (data.length * 13 + config.margin.top));
                    }
                    else {
                        svg.attr("height", h);
                    }
                    d3.select(elem[0]).style("height", h + "px");

                    var xMax = config.maxX || d3.max(data.filter(function (d) { return d[x] !== Infinity; }), function (d) { return d[x]; });
                    var xScale = d3.scale.linear()
                        .domain([0, xMax])
                        .range([0, (w - config.margin.right - config.margin.left)]);

                    var yScale = d3.scale.ordinal()
                        .domain(data.map(function (d) { return d[y]; }))
                        .rangeBands([10, yScaleHeight - config.margin.bottom], 0.05);

                    var barHeight = yScale.rangeBand();

                    var xAxis = d3.svg.axis()
                       .scale(xScale)
                       .orient("top");

                    if (config.tickNumbers) {
                        xAxis.ticks(5);
                    }

                    //svg.select("g.x-axis")
                    //    .transition().duration(500)
                    //    .call(xAxis);

                    console.log(data, y, x);

                    var barContainer = svg.select("g.chart").selectAll("g.bars")
                        .data(data, function (d) { return d[y]; });

                    barContainer.exit()
                        .transition().duration(500)
                        .delay(function (d, i) { return i * 20; })
                        .attr("transform", "translate(0," + (h + 200) + ")")
                        .remove();

                    var barEnter = barContainer.enter().append("g")
                        .attr("class", "bars")
                        .attr("transform", function (d) {
                            return "translate(0," + yScale(d[y]) + ")";
                        })
                        .style("opacity", 0);

                    barEnter.append("rect")
                        .attr("class", "bar")
                        .attr("y", 0)
                        .attr("fill", function (d) {
                            return config.colorBy === 'none' ? config.color :
                                color(d[config.colorBy]);
                        })
                        .on("mouseover", barTip.show)
                        .on("mouseout", barTip.hide);

                    barEnter.append("text")
                        .attr("class", "bar-label")
                        .attr("text-anchor", "end")
                        .attr("font-size", "12")
                        .attr("dx", -1)
                        .attr("dy", ".35em");

                    barContainer.select("rect")
                        .transition().duration(500)
                        .attr("width", function (d) {
                            return d[x] === Infinity ? 0 : xScale(d[x]);
                        })
                        .attr("height", barHeight);

                    barContainer.select("text.bar-label")
                        .transition().duration(500)
                        .attr("y", barHeight / 2)
                        .text(function (d) {
                            return d[y];
                        });

                    barContainer.transition().duration(1000)
                        .style("opacity", 1)
                        .attr("transform", function (d) { return "translate(0," + yScale(d[y]) + ")"; });
                };

                scope.$watch('data', function () {
                    if (scope.data) {
                        if (!drawn) {
                            setTimeout(function () { createChart(); }, 250);
                        } else {
                            updateChart(scope.data);
                        }
                        drawn = true;
                    }
                }, true);
            }
        };
    }]);

angular.module("ehrDashboard")
.directive("boxWhisker", function(){
    return {
        restrict : 'E',
        scope: {
            data: '=',
            prop: '=',
            group: '='
        },
        template: '',
        link: function(scope, elem) {
            var drawChart = function(data,prop,group) {
                var div = elem[0];
                var width = div.offsetWidth / 3 - 5;
                var height = 300;

                var min = -10,
                    max = 110;

                var chart = d3.box()
                    .whiskers(iqr(1.5))
                    .width(width / 3 - 25)
                    .height(height - 15);

                chart.domain([min, max]);

                var svg = d3.select(div).selectAll('svg')
                  .data(data)
                .enter().append("svg")
                  .attr("class", "box")
                  .attr("width", width)
                  .attr("height", height)
                .append("g")
                    .attr("transform", "translate(100,10)")
                  .call(chart);

                svg.append("text")
                    .attr("transform", "translate(" + (width / 3 - 25) / 2 + "," + (height - 15) + ")")
                    .attr("text-anchor", "middle")
                    .style("font-size", "16px")
                    .text(function(d) {
                        return d.group;
                    });
            };
            var iqr = function(k) {
              return function(d, i) {
                var q1 = d.quartiles[0],
                    q3 = d.quartiles[2],
                    iqr = (q3 - q1) * k,
                    i = -1,
                    j = d.length;
                while (d[++i] < q1 - iqr);
                while (d[--j] > q3 + iqr);
                return [i, j];
              };
            }
            scope.$watch('data', function() {
                if (scope.data){
                    drawChart(scope.data, scope.prop, scope.group);
                }
            }), true;
        }
    };
});

(function() {

// Inspired by http://informationandvisualization.de/blog/box-plot
d3.box = function() {
  var width = 1,
      height = 1,
      duration = 0,
      domain = null,
      value = Number,
      whiskers = boxWhiskers,
      quartiles = boxQuartiles,
      tickFormat = null;

  // For each small multiple…
  function box(g) {
    g.each(function(d, i) {
        // LM: Replaced map(value) with unit
      d = d.unit.sort(d3.ascending);
      var g = d3.select(this),
          n = d.length,
          min = d[0],
          max = d[n - 1];

      // Compute quartiles. Must return exactly 3 elements.
      var quartileData = d.quartiles = quartiles(d);

      // Compute whiskers. Must return exactly 2 elements, or null.
      var whiskerIndices = whiskers && whiskers.call(this, d, i),
          whiskerData = whiskerIndices && whiskerIndices.map(function(i) { return d[i]; });

      // Compute outliers. If no whiskers are specified, all data are "outliers".
      // We compute the outliers as indices, so that we can join across transitions!
      var outlierIndices = whiskerIndices
          ? d3.range(0, whiskerIndices[0]).concat(d3.range(whiskerIndices[1] + 1, n))
          : d3.range(n);

      // Compute the new x-scale.
      var x1 = d3.scale.linear()
          .domain(domain && domain.call(this, d, i) || [min, max])
          .range([height, 0]);

      // Retrieve the old x-scale, if this is an update.
      var x0 = this.__chart__ || d3.scale.linear()
          .domain([0, Infinity])
          .range(x1.range());

      // Stash the new scale.
      this.__chart__ = x1;

      // Note: the box, median, and box tick elements are fixed in number,
      // so we only have to handle enter and update. In contrast, the outliers
      // and other elements are variable, so we need to exit them! Variable
      // elements also fade in and out.

      // Update center line: the vertical line spanning the whiskers.
      var center = g.selectAll("line.center")
          .data(whiskerData ? [whiskerData] : []);

      center.enter().insert("line", "rect")
          .attr("class", "center")
          .attr("x1", width / 2)
          .attr("y1", function(d) { return x0(d[0]); })
          .attr("x2", width / 2)
          .attr("y2", function(d) { return x0(d[1]); })
          .style("opacity", 1e-6)
        .transition()
          .duration(duration)
          .style("opacity", 1)
          .attr("y1", function(d) { return x1(d[0]); })
          .attr("y2", function(d) { return x1(d[1]); });

      center.transition()
          .duration(duration)
          .style("opacity", 1)
          .attr("y1", function(d) { return x1(d[0]); })
          .attr("y2", function(d) { return x1(d[1]); });

      center.exit().transition()
          .duration(duration)
          .style("opacity", 1e-6)
          .attr("y1", function(d) { return x1(d[0]); })
          .attr("y2", function(d) { return x1(d[1]); })
          .remove();

      // Update innerquartile box.
      var box = g.selectAll("rect.box")
          .data([quartileData]);

      box.enter().append("rect")
          .attr("class", "box")
          .attr("x", 0)
          .attr("y", function(d) { return x0(d[2]); })
          .attr("width", width)
          .attr("height", function(d) { return x0(d[0]) - x0(d[2]); })
        .transition()
          .duration(duration)
          .attr("y", function(d) { return x1(d[2]); })
          .attr("height", function(d) { return x1(d[0]) - x1(d[2]); });

      box.transition()
          .duration(duration)
          .attr("y", function(d) { return x1(d[2]); })
          .attr("height", function(d) { return x1(d[0]) - x1(d[2]); });

      // Update median line.
      var medianLine = g.selectAll("line.median")
          .data([quartileData[1]]);

      medianLine.enter().append("line")
          .attr("class", "median")
          .attr("x1", 0)
          .attr("y1", x0)
          .attr("x2", width)
          .attr("y2", x0)
        .transition()
          .duration(duration)
          .attr("y1", x1)
          .attr("y2", x1);

      medianLine.transition()
          .duration(duration)
          .attr("y1", x1)
          .attr("y2", x1);

      // Update whiskers.
      var whisker = g.selectAll("line.whisker")
          .data(whiskerData || []);

      whisker.enter().insert("line", "circle, text")
          .attr("class", "whisker")
          .attr("x1", 0)
          .attr("y1", x0)
          .attr("x2", width)
          .attr("y2", x0)
          .style("opacity", 1e-6)
        .transition()
          .duration(duration)
          .attr("y1", x1)
          .attr("y2", x1)
          .style("opacity", 1);

      whisker.transition()
          .duration(duration)
          .attr("y1", x1)
          .attr("y2", x1)
          .style("opacity", 1);

      whisker.exit().transition()
          .duration(duration)
          .attr("y1", x1)
          .attr("y2", x1)
          .style("opacity", 1e-6)
          .remove();

      // Update outliers.
      var outlier = g.selectAll("circle.outlier")
          .data(outlierIndices, Number);

      outlier.enter().insert("circle", "text")
          .attr("class", "outlier")
          .attr("r", 5)
          .attr("cx", width / 2)
          .attr("cy", function(i) { return x0(d[i]); })
          .style("opacity", 1e-6)
        .transition()
          .duration(duration)
          .attr("cy", function(i) { return x1(d[i]); })
          .style("opacity", 1);

      outlier.transition()
          .duration(duration)
          .attr("cy", function(i) { return x1(d[i]); })
          .style("opacity", 1);

      outlier.exit().transition()
          .duration(duration)
          .attr("cy", function(i) { return x1(d[i]); })
          .style("opacity", 1e-6)
          .remove();

      // Compute the tick format.
      var format = tickFormat || x1.tickFormat(8);

      // Update box ticks.
      var boxTick = g.selectAll("text.box")
          .data(quartileData);

      boxTick.enter().append("text")
          .attr("class", "box")
          .attr("dy", ".3em")
          .attr("dx", function(d, i) { return i & 1 ? 6 : -6 })
          .attr("x", function(d, i) { return i & 1 ? width : 0 })
          .attr("y", x0)
          .attr("text-anchor", function(d, i) { return i & 1 ? "start" : "end"; })
          .text(format)
        .transition()
          .duration(duration)
          .attr("y", x1);

      boxTick.transition()
          .duration(duration)
          .text(format)
          .attr("y", x1);

      // Update whisker ticks. These are handled separately from the box
      // ticks because they may or may not exist, and we want don't want
      // to join box ticks pre-transition with whisker ticks post-.
      var whiskerTick = g.selectAll("text.whisker")
          .data(whiskerData || []);

      whiskerTick.enter().append("text")
          .attr("class", "whisker")
          .attr("dy", ".3em")
          .attr("dx", 6)
          .attr("x", width)
          .attr("y", x0)
          .text(format)
          .style("opacity", 1e-6)
        .transition()
          .duration(duration)
          .attr("y", x1)
          .style("opacity", 1);

      whiskerTick.transition()
          .duration(duration)
          .text(format)
          .attr("y", x1)
          .style("opacity", 1);

      whiskerTick.exit().transition()
          .duration(duration)
          .attr("y", x1)
          .style("opacity", 1e-6)
          .remove();
    });
    d3.timer.flush();
  }

  box.width = function(x) {
    if (!arguments.length) return width;
    width = x;
    return box;
  };

  box.height = function(x) {
    if (!arguments.length) return height;
    height = x;
    return box;
  };

  box.tickFormat = function(x) {
    if (!arguments.length) return tickFormat;
    tickFormat = x;
    return box;
  };

  box.duration = function(x) {
    if (!arguments.length) return duration;
    duration = x;
    return box;
  };

  box.domain = function(x) {
    if (!arguments.length) return domain;
    domain = x == null ? x : d3.functor(x);
    return box;
  };

  box.value = function(x) {
    if (!arguments.length) return value;
    value = x;
    return box;
  };

  box.whiskers = function(x) {
    if (!arguments.length) return whiskers;
    whiskers = x;
    return box;
  };

  box.quartiles = function(x) {
    if (!arguments.length) return quartiles;
    quartiles = x;
    return box;
  };

  return box;
};

function boxWhiskers(d) {
  return [0, d.length - 1];
}

function boxQuartiles(d) {
  return [
    d3.quantile(d, .25),
    d3.quantile(d, .5),
    d3.quantile(d, .75)
  ];
}

})();

angular.module('ehrDashboard')
    .directive("bulletChart", ["$timeout", function ($timeout) {
        return {
            restrict: 'E',
            scope: {
                data: '=',
                outerProp: '=',
                innerProp: '=',
                groupBy: '=',
                filter: '='
            },
            link: function (scope, elem) {
                var bulletChart = function () {
                    // directive variables
                    var svg, yScale, chart, xScale;
                    var outerProp = "staffed";
                    var innerProp = "charge";
                    var group = "project";
                    var drawn = false;
                    var monthsBack = 0;

                    var setTitle = function () {
                        var myDate = new moment().subtract("month", monthsBack).format('MMMM');
                        chart.select(".title")
                            .text(myDate + " Project Variance");
                    };

                    var createChart = function () {
                        // Set up the left side margin:
                        var margin = { top: 15, right: 50, bottom: 20, left: 40 };
                        var w = elem[0].offsetWidth;
                        var h = elem[0].offsetHeight;
                        svg = d3.select(elem[0])
                            .append("svg")
                            .attr("height", h)
                            .attr("width", w)
                            .on("mouseover", function () {
                                d3.select(this).selectAll(".to-show")
                                        .transition().duration(500)
                                        .style("opacity", 1);
                            })
                            .on("mouseout", function () {
                                d3.select(this).selectAll(".to-show")
                                    .transition().duration(500)
                                    .style("opacity", 0);
                            });

                        chart = svg.append("g")
                            .attr("transform", "translate(" + margin.left + "," + (0) + ")");

                        chart.append("text")
                            .attr("class", "backward to-show")
                            .attr("dx", -10)
                            .attr("dy", margin.top - 5)
                            .style("font-size", 10)
                            .attr("text-anchor", "middle")
                            .text('<')
                            .style("cursor", "pointer")
                            .on("click", function () {
                                scope.filter('backward');
                                monthsBack++;
                                scope.$apply();
                            })
                            .style("opacity", 0);

                        chart.append("text")
                           .attr("class", "forward to-show")
                           .attr("dx", w - margin.right - 5)
                           .attr("dy", margin.top - 5)
                           .style("font-size", 10)
                           .attr("text-anchor", "middle")
                           .text('>')
                           .style("cursor", "pointer")
                           .on("click", function () {
                               scope.filter('forward');
                               monthsBack--;
                               scope.$apply();
                           })
                           .style("opacity", 0);

                        chart.append("text")
                            .attr("class", "title to-show")
                            .attr("dx", (w - margin.right) / 2)
                            .attr("dy", margin.top - 5)
                            .style("font-size", 10)
                            .attr("text-anchor", "middle")
                            .style("opacity", 0);

                        // Set up the scales:
                        xScale = d3.scale.linear()
                            .range([0, w - margin.right]);

                        yScale = d3.scale.ordinal()
                            .rangeBands([margin.top, h - margin.bottom], 0.1);

                        //Set up axes:
                        chart.append("g")
                            .attr("class", "x axis to-show")
                            .attr("transform", "translate(0, " + (h - margin.bottom - 5) + ")")
                            .style("opacity", 0)
                            .append("text")
                            .style("font-size", "8")
                            .style("text-anchor", "middle")
                            .attr("dx", (w - margin.right) / 2)
                            .attr("dy", 25)
                            .text("Hours");
                        drawn = true;
                        updateChart(scope.data);
                    };

                    var updateChart = function (data) {
                        setTitle();
                        chart.select(".forward")
                            .style("display", function () { return monthsBack >= 1 ? "block" : "none"; });
                        chart.select(".backward")
                            .style("display", function () { return monthsBack >= 3 ? "none" : "block"; });

                        //Set up the SVG:
                        var maxX = d3.max(data, function (d) { return Math.max(d[innerProp], d[outerProp]); }) * 1.10;
                        xScale.domain([0, maxX]);

                        var xAxis = d3.svg.axis()
                           .scale(xScale)
                           .ticks(5)
                           .orient("bottom");

                        chart.select('.x')
                            .call(xAxis);

                        yScale.domain(data.map(function (d) { return d[group]; }));

                        var innerBarHeight = yScale.rangeBand() * 0.6;
                        // Data binding:
                        var barsCont = chart.selectAll("g.bars")
                            .data(data, function (d) { return d[group]; });

                        barsCont.transition().duration(500)
                            .attr("transform", function (d) { return "translate(0, " + yScale(d[group]) + ")"; });

                        barsCont.select("rect.outer-bar")
                            .attr("height", yScale.rangeBand())
                            .transition().duration(500)
                            .attr("width", function (d) { return xScale(d[outerProp]); });

                        barsCont.select("rect.inner-bar")
                           .attr("height", innerBarHeight)
                           .attr("y", (yScale.rangeBand() - innerBarHeight) / 2)
                           .transition().duration(500)
                           .attr("width", function (d) { return xScale(d[innerProp]); });

                        barsCont.select("text")
                          .attr("dy", yScale.rangeBand() / 2);
                        // Create container per observation:;
                        var barEnter = barsCont.enter().append("g")
                            .attr("class", "bars")
                            .attr("transform", function (d) { return "translate(0, " + yScale(d[group]) + ")"; });

                        // Add Outer bar
                        barEnter.append("rect")
                            .attr("class", "outer-bar")
                            .attr("height", yScale.rangeBand())
                            .attr("width", function (d) { return xScale(d[outerProp]); })
                            .attr("fill", "black")
                            .style("opacity", 0.3);

                        //Add InnerBar
                        barEnter.append("rect")
                           .attr("class", "inner-bar")
                           .attr("height", innerBarHeight)
                           .attr("y", (yScale.rangeBand() - innerBarHeight) / 2)
                           .attr("width", function (d) { return xScale(d[innerProp]); })
                           .attr("fill", "steelblue")
                           .style("opacity", 0.8);

                        // Add group name
                        barEnter.append("text")
                            .attr("class", "name-month")
                            .attr("text-anchor", "end")
                            .attr("dominant-baseline", "central")
                            .attr("font-size", "10")
                            .attr("dx", -1)
                            .attr("dy", yScale.rangeBand() / 2)
                            .text(function (d) { return d[group]; });

                        barsCont.exit().remove();
                    };

                    scope.$watch("data", function () {
                        if (scope.data && !drawn) {
                            createChart(scope.data);
                        } else {
                            updateChart(scope.data);
                        }
                    }, true);
                };
                $timeout(bulletChart, 0);
            }
        };
    }]);

angular.module("ehrDashboard")
    .factory("LineOptions", function () {
        return {
            defaults: [
            { 'propName': 'margin', 'defaultValue': { "top": 0, "left": 0, "right": 0, "bottom": 0 } },
            { 'propName': 'color', 'defaultValue': 'steelblue' },
            { 'propName': 'xAxisFreq', 'defaultValue': '' },
            { 'propName': 'yMax', 'defaultValue': '' },
            { 'propName': 'colorBy', 'defaultValue': 'none' },
            { 'propName': 'tooltip', 'defaultValue': true },
            { 'propName': 'fitToHeight', 'defaultValue': true },
            { 'propName': 'radius', 'defaultValue': 3 },
            { 'propName': 'width', 'defaultValue': null },
            { 'propName': 'height', 'defaultValue': null },
            {'propName': 'title', 'defaultValue': ''}
            ],
            generateOptions: function (options) {
                var controls = options ? options : {};
                this.defaults.forEach(function (d) {
                    if (!controls.hasOwnProperty(d.propName)) {
                        controls[d.propName] = d.defaultValue;
                    }
                });
                return controls;
            }
        };
});

angular.module('ehrDashboard')
    .directive("lineChart", ["ChartOptions", function (ChartOptions) {
    return {
        restrict: 'E',
        scope: {
            data: '=',
            options: '=',
            date: '=',
            group: '=',
            unit: '='
        },
        link: function (scope, elem) {
            var config = ChartOptions.generateOptions(scope.options);
            var w, h;
            var unit = scope.unit;
            var date = scope.date;
            var group = scope.group;
            var drawn = false;
            var color = config.colorScale;
            var lineTip;
            var formatDate = d3.time.format("%m/%d/%Y");

            var createChart = function () {
                w = elem[0].offsetWidth;
                h = elem[0].offsetHeight;
                console.log(w, h);

                var svg = d3.select(elem[0]).append("svg")
                    .attr("class", "svg-chart")
                    .attr("width", w).attr("height", h);

                var chart = svg.append("g")
                    .attr("class", "chart")
                    .attr("transform", "translate(0,0)");

                chart.append("g")
                  .attr("class", "x-axis")
                  .attr("transform", "translate(0," + (h - 100) + ")");

                chart.append("g")
                  .attr("class", "y-axis")
                  .attr("transform", "translate(80,0)")
                    .append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", -40)
                    .attr("dx", -(h - 100) / 2)
                    .attr("dy", ".71em")
                    .style("text-anchor", "middle")
                    .text(config.yScaleLabel);

                //if (config.tooltip) {
                //    createToolTip();
                //}

                updateChart(scope.data);
            };

            //var createToolTip = function () {
            //    lineTip = d3.tip().attr('class', 'd3-tip')
            //        .offset(function () {
            //            return [0, 2]
            //        })
            //        .direction('e')
            //        .style("text-align", "center")
            //        .html(function (d) {
            //            return d[x];
            //        });
            //    d3.select("svg").call(lineTip);
            //};

            var updateChart = function (data) {
                var chart =  d3.select("svg.svg-chart").select("g.chart");
                data = data.map(function (d) {
                    return {
                        unit: d[unit],
                        date: d[date],
                        group: d[group],
                        realDate: formatDate.parse(d[date])
                    };
                });

                data = _.sortBy(data, function (d) { return +d.realDate; });

                //Set up Scales
                var minVal = 0;
                var maxVal = d3.max(data, function (d) { return d.unit; });
                // give 10% buffers on both sides
                maxVal = maxVal + (maxVal * 0.05);
                var yScale = d3.scale.linear()
                    .domain([minVal, maxVal])
                    .range([(h-100), 0]);
                var xScale = d3.time.scale()
                    .range([80, w - 40])
                    .domain(d3.extent(data, function (d) { return d.realDate; }));
                var xAxis = d3.svg.axis()
                    .scale(xScale)
                    .tickFormat(d3.time.format("%m-%y"))
                    .tickPadding(6)
                    .ticks(d3.time.month, 1)
                    .orient("bottom");

                var yAxis = d3.svg.axis()
                    .scale(yScale)
                    .orient("left");

                //chart.append("line")
                //    .attr("x1", xScale(d3.min(data, function(d) { return d.realDate; })))
                //    .attr("x2", xScale(d3.max(data, function(d) { return d.realDate; })))
                //    .attr("y1", yScale(100))
                //    .attr("y2", yScale(100))
                //    .style("stroke", "black")
                //    .style("troke-width", 2)
                //    .style("stroke-dasharray", ("3, 3"));

                var groups = d3.nest()
                    .key(function (d) { return d.group; })
                    .entries(data);

                var line = d3.svg.line()
					.interpolate("linear")
					.x(function (d) { return xScale(d.realDate); })
					.y(function (d) { return yScale(d.unit); });

                 var lines = chart.selectAll("path")
                    .data(groups, function (d) { return d.key; });

                lines.transition()
                    .ease("linear")
                    .duration(1000)
                    .attr("d", function (d) { return line(d.values); });

                lines.enter().append("path")
                    .attr("class", "line")
                    .style("stroke", function (d) { return color(d.key); })
                    .style("fill", "none")
                    .style("stroke-width", 5)
                    .transition()
                    .ease("linear")
                    .duration(1000)
                    .attr("d", function (d) { return line(d.values); });

                //Axes
                d3.select("g.x-axis").call(xAxis);
                d3.select("g.y-axis").call(yAxis);

                lines.exit().remove();

                //Legend
                var legend = chart.selectAll(".legend")
                    .data(_.uniq(_.pluck(data, 'group')))
                  .enter().append("g")
                    .attr("class", "legend")
                    .attr("transform", function (d, i) { return "translate(0," + i * 20 + ")"; });

                legend.append("rect")
                    .attr("x", w - 72)
                    .attr("width", 18)
                    .attr("height", 18)
                    .style("fill", color);

                legend.append("text")
                    .attr("x", w - 96)
                    .attr("y", 9)
                    .attr("dy", ".35em")
                    .style("text-anchor", "end")
                    .text(function (d) { return d; });
            };

            scope.$watch('data', function () {
                if (scope.data) {
                    if (!drawn) {
                        setTimeout(function () { createChart(); }, 250);
                    } else {
                        updateChart(scope.data);
                    }
                    drawn = true;
                }
            }, true);
        }
    };
}]);

angular.module("ehrDashboard")
    .directive("simpleLineChart", ["$timeout", "LineOptions", function ($timeout, LineOptions) {
    return {
        restrict: 'E',
        scope: {
            data: '=',
            options: '=',
            date: '=',
            unit: '='
        },
        link: function (scope, elem) {
            var lineChart = function () {
                var config = LineOptions.generateOptions(scope.options);
                var w, h;
                var unit = scope.unit;
                var date = scope.date;
                var radius = config.radius;
                var lineTip, svg, xScale, yScale;
                //var formatMonth = d3.time.format("%Y-%m-%d");
                var formatMonthLabel = d3.time.format("%b-%y");

                var createChart = function (data) {
                    w = config.width ? config.width : elem[0].offsetWidth - 20;
                    h = config.height ? config.height : elem[0].offsetHeight;
                    svg = d3.select(elem[0]).append("svg")
                        .attr("class", "svg-simple-line")
                        .attr("width", w).attr("height", h)
                        .on("mouseover", function () {
                            d3.select(this).selectAll(".to-show")
                                    .transition().duration(500)
                                    .style("opacity", 1);
                        })
                        .on("mouseout", function () {
                            d3.select(this).selectAll(".to-show")
                                .transition().duration(500)
                                .style("opacity", 0);
                        });

                    var chart = svg.append("g")
                        .attr("class", "chart")
                        .attr("transform", "translate(0,0)");

                    chart.append("text")
                        .attr("class", "title to-show")
                        .attr("dx", w / 2)
                        .attr("dy", 10)
                        .style("font-size", 10)
                        .attr("text-anchor", "middle")
                        .text(config.title)
                        .style("opacity", 0);

                    chart.append("g")
                        .attr("class", "x-axis-time to-show")
                        .attr("transform", "translate(0," + (h - 25) + ")")
                        .style("opacity", 0);

                    chart.append("g")
                      .attr("class", "y-axis-time")
                      .attr("transform", "translate(80,0)");

                    if (config.tooltip) {
                        createToolTip();
                    }

                    data = data.map(function (d) {
                        return {
                            unit: d[unit],
                            //date: d[date].substring(0, 10),
                            realDate: d[date]                        };
                    });

                    data = data.sort(function (a, b) {
                        return +a.realDate - b.realDate;
                    });

                    // Set up scales
                    var minVal = 0;
                    var maxVal = d3.max(data, function (d) { return d.unit; });

                    // Give 10% buffers on both sides
                    maxVal = maxVal + (maxVal * 0.05);
                    yScale = d3.scale.linear()
                        .domain([minVal, config.yMax])
                        .range([(h - 10), 10]);
                    xScale = d3.time.scale()
                        .range([15, w-20])
                        .domain(d3.extent(data, function (d) { return d.realDate; }));

                    updateChart(data);
                };

                var createLine = function() {
                    var chart = svg.select("g.chart");

                    chart.append("line")
                        .attr("x1", 15)
                        .attr("x2", w - 20)
                        .attr("y1", yScale(config.straightLine))
                        .attr("y2", yScale(config.straightLine))
                        .style("stroke", "black")
                        .style("opacity", 0.4);

                    chart.append("text")
                        .attr("class", "to-show")
                        .attr("dx", (w - 20))
                        .attr("dy", yScale(config.straightLine) + 2)
                        .attr("font-size", 8)
                        .style("opacity", 0)
                        .text(config.straightLine + "%");
                };

                var createToolTip = function () {
                    lineTip = d3.tip().attr('class', 'd3-tip')
                        .offset(function () {
                            return [-8, 0];
                        })
                        .direction('n')
                        .style("text-align", "center")
                        .html(function (d) {
                            return Math.round(d.unit * 100) / 100;
                        });
                    svg.call(lineTip);
                };

                var updateChart = function (data) {
                    createLine();
                    var chart = svg.select("g.chart");

                    var xAxis = d3.svg.axis()
                        .scale(xScale)
                        .tickFormat(formatMonthLabel)
                        .tickPadding(6)
                        .ticks(d3.time.month, config.xAxisFreq)
                        .orient("bottom");

                    var yAxis = d3.svg.axis()
                        .scale(yScale)
                        .ticks(6)
                        .orient("left");

                    var line = d3.svg.line()
                        .x(function (d) { return xScale(d.realDate); })
                        .y(function (d) { return yScale(d.unit); });

                    chart.append("path")
                        .datum(data)
                        .attr("class", "lines")
                        .style("stroke", config.color)
                        .transition()
                        .ease("linear")
                        .duration(1000)
                        .attr("d", function (d) { return line(d); });

                    // Axes
                    svg.select("g.x-axis-time")
                        .call(xAxis);

                    //// Axes
                    //d3.select("g.y-axis-time")
                    //    .call(yAxis);

                    //Circles
                    var circles = chart.selectAll("circle")
                        .data(data);

                    circles.enter().append("circle")
                        .style("fill", config.color)
                        .attr("r", radius)
                        .on('mouseover', function (d) {
                            d3.select(this).transition().duration(500)
                                .attr("r", (radius + (radius * 0.9)));
                            lineTip.show(d);
                        })
                        .on('mouseout', function (d) {
                            d3.select(this).transition().duration(500).attr("r", radius);
                            lineTip.hide(d);
                        });

                    circles.transition().duration(1000)
                        .ease("bounce")
                        .attr("cx", function (d) { return xScale(d.realDate); })
                        .attr("cy", function (d) { return yScale(d.unit); });

                    circles.exit().remove();
                };

                scope.$watch('data', function () {
                    if (scope.data) {
                        createChart(scope.data);
                    }
                }, true);
            };
            $timeout(lineChart, 0);
        }
    };
}]);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNoYXJ0cy9iYXItc3BhcmsuanMiLCJjaGFydHMvYnViYmxlLWNoYXJ0LmpzIiwiY2hhcnRzL2NoYXJ0b3B0aW9uLnNlcnZpY2UuanMiLCJjb3JlL2NhbGN1bGF0ZS5zZXJ2aWNlLmpzIiwiY29yZS9kYXRhLnNlcnZpY2UuanMiLCJjb3JlL2hvbWUuY29udHJvbGxlci5qcyIsImNvcmUvbWFpbi5jb250cm9sbGVyLmpzIiwiZGF0YS9hcnJheS5leHRlbmQuanMiLCJjaGFydHMvYmFyL2Jhci5jaGFydC5kaXJlY3RpdmUuanMiLCJjaGFydHMvYmFyL2Jhcm9wdGlvbi5zZXJ2aWNlLmpzIiwiY2hhcnRzL2Jhci9ncm91cC1iYXIuZGlyZWN0aXZlLmpzIiwiY2hhcnRzL2Jhci9zdGFja2JhcmNoYXIuZGlyZWN0aXZlLmpzIiwiY2hhcnRzL2Jhci92ZXJ0aWNhbC1iYXIuY2hhcnQuZGlyZWN0aXZlLmpzIiwiY2hhcnRzL2JveC9ib3gtd2hpc2tlci5qcyIsImNoYXJ0cy9ib3gvYm94LmpzIiwiY2hhcnRzL2J1bGxldC1jaGFydC9idWxsZXQtY2hhcnQuZGlyZWN0aXZlLmpzIiwiY2hhcnRzL2xpbmUvbGluZW9wdGlvbi5zZXJ2aWNlLmpzIiwiY2hhcnRzL2xpbmUvbXVsdGktbGluZS5jaGFydC5kaXJlY3RpdmUuanMiLCJjaGFydHMvbGluZS9zaW1wbGUtbGluZS5jaGFydC5kaXJlY3RpdmUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsUUFBUSxPQUFPLGdCQUFnQjtJQUMzQjtJQUNBO0lBQ0E7OztDQUdILDhCQUFPLFVBQVUsb0JBQW9CO0lBQ2xDLG1CQUFtQixNQUFNO09BQ3RCLGVBQWU7T0FDZixjQUFjOzs7Ozs7Ozs7Ozs7QUFZckI7QUNyQkEsUUFBUSxPQUFPO0NBQ2QsVUFBVSxZQUFZLFVBQVU7SUFDN0IsT0FBTztRQUNILFdBQVc7UUFDWCxPQUFPO1lBQ0gsTUFBTTtZQUNOLE1BQU07WUFDTixPQUFPOztRQUVYLFVBQVU7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QkFDckIsS0FBSyxLQUFLO3lCQUNWLEdBQUcsYUFBYSxVQUFVLEdBQUc7NEJBQzFCLEdBQUcsT0FBTyxNQUFNLGFBQWEsU0FBUztpQ0FDakMsS0FBSyxNQUFNLFVBQVUsU0FBUzs0QkFDbkMsUUFBUSxLQUFLOzt5QkFFaEIsR0FBRyxZQUFZLFVBQVUsR0FBRzs0QkFDekIsR0FBRyxPQUFPLE1BQU0sYUFBYSxTQUFTLEtBQUssS0FBSyxLQUFLOzRCQUNyRCxRQUFRLEtBQUs7OztvQkFHckIsUUFBUSxhQUFhLFNBQVM7eUJBQ3pCLEtBQUs7eUJBQ0wsS0FBSyxNQUFNLFVBQVUsR0FBRyxFQUFFLE9BQU8sT0FBTyxFQUFFO3lCQUMxQyxLQUFLLE1BQU0sVUFBVSxHQUFHLEVBQUUsT0FBTyxPQUFPLEVBQUU7O29CQUUvQyxRQUFRLE9BQU87OztnQkFHbkIsTUFBTSxPQUFPLFFBQVEsWUFBWTtvQkFDN0IsSUFBSSxNQUFNLE1BQU07d0JBQ1osWUFBWSxNQUFNOzttQkFFdkI7O1lBRVAsU0FBUyxXQUFXOzs7O0FBSWhDIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJhbmd1bGFyLm1vZHVsZSgnZWhyRGFzaGJvYXJkJywgW1xyXG4gICAgJ25nQW5pbWF0ZScsXHJcbiAgICAnbmdBcmlhJyxcclxuICAgICduZ01hdGVyaWFsJyxcclxuICAgIC8vJ3VpLXJvdXRlcidcclxuXSlcclxuLmNvbmZpZyhmdW5jdGlvbiAoJG1kVGhlbWluZ1Byb3ZpZGVyKSB7XHJcbiAgICAkbWRUaGVtaW5nUHJvdmlkZXIudGhlbWUoJ2RlZmF1bHQnKVxyXG4gICAgICAucHJpbWFyeVBhbGV0dGUoJ2JsdWUnKVxyXG4gICAgICAuYWNjZW50UGFsZXR0ZSgnZ3JlZW4nKTtcclxufSlcclxuLy8uY29uZmlnKGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlcikge1xyXG4vLyAgICAkc3RhdGVQcm92aWRlclxyXG4vLyAgICAgICAgLnN0YXRlKCdob21lJyxcclxuLy8gICAgICAgIHtcclxuLy8gICAgICAgICAgICB1cmw6IFwiL1wiLFxyXG4vLyAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcImNvcmUvaG9tZS5odG1sXCIsXHJcbi8vICAgICAgICAgICAgY29udHJvbGxlcjogXCJIb21lQ3RybFwiLFxyXG4vLyAgICAgICAgICAgIGNvbnRyb2xsZXJBczogXCJtY1wiXHJcbi8vICAgICAgICB9KTtcclxuLy99KTtcclxuIiwiYW5ndWxhci5tb2R1bGUoXCJlaHJEYXNoYm9hcmRcIilcclxuLmRpcmVjdGl2ZShcImJhclNwYXJrXCIsIGZ1bmN0aW9uKCl7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHJlc3RyaWN0IDogJ0UnLFxyXG4gICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgIGRhdGE6ICc9JyxcclxuICAgICAgICAgICAgcHJvcDogJz0nLFxyXG4gICAgICAgICAgICBncm91cDogJz0nXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0ZW1wbGF0ZTogJycsXHJcbiAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW0pIHtcclxuICAgICAgICAgICAgdmFyIGRyYXdDaGFydCA9IGZ1bmN0aW9uKGRhdGEscHJvcCxncm91cCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvbG9yID0gZDMuc2NhbGUuY2F0ZWdvcnkxMCgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRpdiA9IGVsZW1bMF07XHJcbiAgICAgICAgICAgICAgICB2YXIgdyA9IGRpdi5vZmZzZXRXaWR0aDtcclxuICAgICAgICAgICAgICAgIHZhciBoID0gTWF0aC5tYXgoZGl2Lm9mZnNldEhlaWdodCwgMjgwKTtcclxuICAgICAgICAgICAgICAgIHZhciB4U2NhbGUgPSBkMy5zY2FsZS5saW5lYXIoKS5kb21haW4oWzAsIE1hdGguY2VpbChkMy5tYXgoZGF0YSwgZnVuY3Rpb24oZCkgeyByZXR1cm4gZFtwcm9wXTsgfSkpXSkucmFuZ2UoWzAsdy8xLjZdKTtcclxuICAgICAgICAgICAgICAgIHZhciB5U2NhbGUgPSBkMy5zY2FsZS5vcmRpbmFsKCkuZG9tYWluKGRhdGEubWFwKGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGRbZ3JvdXBdOyB9KSkucmFuZ2VSb3VuZEJhbmRzKFsxMCxoLTUwXSwgMC4yKTtcclxuICAgICAgICAgICAgICAgIHZhciBzdmcgPSBkMy5zZWxlY3QoZGl2KS5hcHBlbmQoXCJzdmdcIikuYXR0cihcImhlaWdodFwiLGgpLmF0dHIoXCJ3aWR0aFwiLHcpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGdyYXBoID0gc3ZnLmFwcGVuZChcImdcIikuYXR0cihcInRyYW5zZm9ybVwiLFwidHJhbnNsYXRlKDAsMjApXCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGcgPSBncmFwaC5zZWxlY3RBbGwoXCJnXCIpLmRhdGEoZGF0YSlcclxuICAgICAgICAgICAgICAgICAgICAuZW50ZXIoKS5hcHBlbmQoXCJnXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gXCJ0cmFuc2xhdGUoMzAsXCIreVNjYWxlKGRbZ3JvdXBdKStcIilcIjsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHhBeGlzTnVtID0gZDMuc3ZnLmF4aXMoKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zY2FsZSh4U2NhbGUpXHJcbiAgICAgICAgICAgICAgICAgICAgLm9yaWVudChcImJvdHRvbVwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICBzdmcuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIixcInggYXhpc1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsXCJ0cmFuc2xhdGUoMzAsXCIgKyhoIC0gMjUpK1wiKVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKHhBeGlzTnVtKTtcclxuXHJcbiAgICAgICAgICAgICAgICBnLmFwcGVuZChcInJlY3RcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsXCJzcGFya1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4geFNjYWxlKGRbcHJvcF0pfSlcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCB5U2NhbGUucmFuZ2VCYW5kKCkpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwiZmlsbFwiLCBcInN0ZWVsYmx1ZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZVwiLCBcIiMzODY4OTBcIilcclxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJzdHJva2Utd2lkdGhcIiwyKTtcclxuXHJcbiAgICAgICAgICAgICAgICBnLmFwcGVuZChcInRleHRcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIHlTY2FsZS5yYW5nZUJhbmQoKS8yKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZHhcIiwgNClcclxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsXCJ3aGl0ZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLDEyKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInRleHQtYW5jaG9yXCIsXCJzdGFydFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGRbZ3JvdXBdOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBnLmFwcGVuZChcInRleHRcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIHlTY2FsZS5yYW5nZUJhbmQoKS8yKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLDE1KVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcImZpbGxcIixcIndoaXRlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkeFwiLCBmdW5jdGlvbihkKSB7IHJldHVybiAoeFNjYWxlKGRbcHJvcF0pLTUpOyB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInRleHQtYW5jaG9yXCIsXCJlbmRcIilcclxuICAgICAgICAgICAgICAgICAgICAudGV4dChmdW5jdGlvbihkKSB7IHJldHVybiBkW3Byb3BdK1wiJVwiOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL2xpbmUgY2hhcnRcclxuICAgICAgICAgICAgICAgIHZhciBwYXJzZURhdGUgPSBkMy50aW1lLmZvcm1hdChcIiVtLyVkLyVZXCIpLnBhcnNlO1xyXG4gICAgICAgICAgICAgICAgdmFyIHhTY2FsZVRpbWUgPSBkMy50aW1lLnNjYWxlKCkucmFuZ2UoW3cvMS41LHctMTAwXSkuZG9tYWluKGQzLmV4dGVudChkYXRhWzBdLnRpbWUsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHBhcnNlRGF0ZShkLnF1YXJ0ZXIpO30pKTtcclxuICAgICAgICAgICAgICAgIHZhciB4QXhpcyA9IGQzLnN2Zy5heGlzKClcclxuICAgICAgICAgICAgICAgICAgICAuc2NhbGUoeFNjYWxlVGltZSlcclxuICAgICAgICAgICAgICAgICAgICAudGlja3MoZDMudGltZS5tb250aCwgMylcclxuICAgICAgICAgICAgICAgICAgICAudGlja0Zvcm1hdChkMy50aW1lLmZvcm1hdChcIiViXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgIC5vcmllbnQoXCJib3R0b21cIik7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHlUaW1lcyA9IHt9O1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBsaW5lID0gZDMuc3ZnLmxpbmUoKVxyXG4gICAgICAgICAgICAgICAgICAgIC5pbnRlcnBvbGF0ZShcImxpbmVhclwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC54KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHhTY2FsZVRpbWUocGFyc2VEYXRlKGQucXVhcnRlcikpOyB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC55KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHlUaW1lc1tkLnR5cGVdKGRbcHJvcF0pOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBnLmFwcGVuZChcInBhdGhcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImZpbGxcIixcIm5vbmVcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInN0cm9rZVwiLFwic3RlZWxibHVlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwyKVxyXG4gICAgICAgICAgICAgICAgICAgIC5kYXR1bShmdW5jdGlvbihkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgheVRpbWVzW2QudHlwZV0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlUaW1lc1tkLnR5cGVdID0gZDMuc2NhbGUubGluZWFyKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmFuZ2UoW3lTY2FsZS5yYW5nZUJhbmQoKSwxMF0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRvbWFpbihbLTEwLCAxMF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLmRvbWFpbihbKGQzLm1pbihkLnRpbWUsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGRbcHJvcF07fSktMSksIChkMy5tYXgoZC50aW1lLCBmdW5jdGlvbihkKSB7IHJldHVybiBkW3Byb3BdO30pKzEpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQudGltZTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZFwiLGxpbmUpO1xyXG5cclxuICAgICAgICAgICAgICAgIGcuYXBwZW5kKFwibGluZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZS1kYXNoYXJyYXlcIiwgKFwiM1wiLCBcIjNcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwic3Ryb2tlXCIsIFwiYmxhY2tcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcIngxXCIsIHhTY2FsZVRpbWUucmFuZ2UoKVswXSlcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcIngyXCIsIHhTY2FsZVRpbWUucmFuZ2UoKVsxXSlcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInkxXCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHlUaW1lc1tkLnR5cGVdKDApfSlcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInkyXCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHlUaW1lc1tkLnR5cGVdKDApfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgZy5hcHBlbmQoXCJ0ZXh0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZnVuY3Rpb24oZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJ0cmFuc2xhdGUoXCIgKyAoeFNjYWxlVGltZS5yYW5nZSgpWzFdICsgMTYpICsgXCIsXCIgKyAoeVRpbWVzW2QudHlwZV0oMCkgKyA1KSArIFwiKVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBcIjEzcHhcIilcclxuICAgICAgICAgICAgICAgICAgICAudGV4dChcIjAlXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgIGcuc2VsZWN0QWxsKFwiY2lyY2xlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmRhdGEoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC50aW1lOyB9KVxyXG4gICAgICAgICAgICAgICAgLmVudGVyKCkuYXBwZW5kKFwiY2lyY2xlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjeFwiLCBmdW5jdGlvbihkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB4U2NhbGVUaW1lKHBhcnNlRGF0ZShkLnF1YXJ0ZXIpKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY3lcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4geVRpbWVzW2QudHlwZV0oZFtwcm9wXSk7IH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJyXCIsIFwiM3B4XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJmaWxsXCIsIFwiIzM4Njg5MFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwic3Ryb2tlXCIsIFwibm9uZVwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICBzdmcuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIixcInggYXhpc1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsXCJ0cmFuc2xhdGUoMzAsXCIgKyhoIC0gMjUpK1wiKVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKHhBeGlzKTtcclxuXHJcbiAgICAgICAgICAgICAgICBzdmcuYXBwZW5kKFwidGV4dFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieVwiLCAxNSlcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInhcIiwgMzArKHcvMS42KS8yKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInRleHQtYW5jaG9yXCIsXCJtaWRkbGVcIilcclxuICAgICAgICAgICAgICAgICAgICAudGV4dChcIlByZXZhbGVuY2Ugb2YgTWV0cmljIC0gQ3VycmVudCBRdWFydGVyXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgIHN2Zy5hcHBlbmQoXCJ0ZXh0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIDE1KVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInRleHQtYW5jaG9yXCIsXCJtaWRkbGVcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInhcIiw1Kyh3LzEuNikrKCh3LSh3LzEuNikpLzIpKVxyXG4gICAgICAgICAgICAgICAgICAgIC50ZXh0KFwiUGVyY2VudCBDaGFuZ2UgRnJvbSBCYXNlbGluZVwiKTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnZGF0YScsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLmRhdGEpe1xyXG4gICAgICAgICAgICAgICAgICAgIGRyYXdDaGFydChzY29wZS5kYXRhLCBzY29wZS5wcm9wLCBzY29wZS5ncm91cCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pLCB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn0pO1xyXG4iLCJhbmd1bGFyLm1vZHVsZShcImVockRhc2hib2FyZFwiKVxyXG4uZGlyZWN0aXZlKFwiYnViYmxlQ2hhcnRcIiwgZnVuY3Rpb24oKXtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgcmVzdHJpY3QgOiAnRScsXHJcbiAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgZGF0YTogJz0nXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0ZW1wbGF0ZTogJycsXHJcbiAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW0pIHtcclxuICAgICAgICAgICAgdmFyIGRyYXdDaGFydCA9IGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkaXYgPSBlbGVtWzBdO1xyXG4gICAgICAgICAgICAgICAgdmFyIHcgPSBkaXYub2Zmc2V0V2lkdGg7XHJcbiAgICAgICAgICAgICAgICB2YXIgaCA9IGRpdi5vZmZzZXRIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3ZnID0gZDMuc2VsZWN0KGRpdikuYXBwZW5kKFwic3ZnXCIpLmF0dHIoXCJoZWlnaHRcIixoKS5hdHRyKFwid2lkdGhcIix3KTtcclxuICAgICAgICAgICAgICAgIHZhciBncmFwaCA9IHN2Zy5hcHBlbmQoXCJnXCIpLmF0dHIoXCJ0cmFuc2Zvcm1cIixcInRyYW5zbGF0ZSgwLDIwKVwiKTtcclxuICAgICAgICAgICAgICAgIC8vbGluZSBjaGFydFxyXG4gICAgICAgICAgICAgICAgdmFyIHhTY2FsZVRpbWUgPSBkMy50aW1lLnNjYWxlKCkucmFuZ2UoWzYwLHctNTBdKS5kb21haW4oZDMuZXh0ZW50KGRhdGEsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHBhcnNlRGF0ZShkLmRhdGUpOyB9KSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgeEF4aXMgPSBkMy5zdmcuYXhpcygpXHJcbiAgICAgICAgICAgICAgICAgICAgLnNjYWxlKHhTY2FsZVRpbWUpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRpY2tzKGQzLnRpbWUubW9udGgsIDMpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRpY2tGb3JtYXQoZDMudGltZS5mb3JtYXQoXCIlYlwiKSlcclxuICAgICAgICAgICAgICAgICAgICAub3JpZW50KFwiYm90dG9tXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB5U2NhbGVUaW1lID0gZDMuc2NhbGUubGluZWFyKCkucmFuZ2UoW2gtNTAsMF0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmRvbWFpbihbZDMubWluKHR5cGVzLCBmdW5jdGlvbihkKSB7IHJldHVybiBkMy5taW4oZC52YWx1ZXMsIGZ1bmN0aW9uKHgpIHsgcmV0dXJuIHgudmFsdWU7IH0pOyB9KSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZDMubWF4KHR5cGVzLCBmdW5jdGlvbihkKSB7IHJldHVybiBkMy5tYXgoZC52YWx1ZXMsIGZ1bmN0aW9uKHgpIHsgcmV0dXJuIHgudmFsdWU7IH0pOyB9KV0pO1xyXG4gICAgICAgICAgICAgICAgdmFyIHlBeGlzID0gZDMuc3ZnLmF4aXMoKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zY2FsZSh5U2NhbGVUaW1lKVxyXG4gICAgICAgICAgICAgICAgICAgIC5vcmllbnQoXCJsZWZ0XCIpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBsaW5lID0gZDMuc3ZnLmxpbmUoKVxyXG4gICAgICAgICAgICAgICAgICAgIC5pbnRlcnBvbGF0ZShcImJhc2lzXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLngoZnVuY3Rpb24oZCkgeyByZXR1cm4geFNjYWxlVGltZShwYXJzZURhdGUoZC5kYXRlKSk7IH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLnkoZnVuY3Rpb24oZCkgeyByZXR1cm4geVNjYWxlVGltZShkLnZhbHVlKTsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgZ3JhcGguYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIixcIngtYXhpc1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsXCJ0cmFuc2xhdGUoMCxcIisoaC02MCkrXCIpXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoeEF4aXMpO1xyXG5cclxuICAgICAgICAgICAgICAgIHN2Zy5hcHBlbmQoXCJnXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIixcInRyYW5zbGF0ZSg2MCwwKVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ4LWF4aXNcIilcclxuICAgICAgICAgICAgICAgICAgICAuY2FsbCh5QXhpcylcclxuICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKFwidGV4dFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwicm90YXRlKC05MClcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInlcIiwgNilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIFwiLjcxZW1cIilcclxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJ0ZXh0LWFuY2hvclwiLCBcImVuZFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC50ZXh0KFwiVVNEICRcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHR5cGUgPSBzdmcuc2VsZWN0QWxsKFwiZy5tdWx0aVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5kYXRhKHR5cGVzKVxyXG4gICAgICAgICAgICAgICAgICAgIC5lbnRlcigpLmFwcGVuZChcImdcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsXCJtdWx0aVwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICB0eXBlLmFwcGVuZChcInBhdGhcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwibGluZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZFwiLCBmdW5jdGlvbihkKSB7IHJldHVybiBsaW5lKGQudmFsdWVzKTsgfSlcclxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJzdHJva2VcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gY29sb3IoZC5uYW1lKTsgfSlcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImZpbGxcIixcIm5vbmVcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgdHlwZS5hcHBlbmQoXCJ0ZXh0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmRhdHVtKGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHtuYW1lOiBkLm5hbWUsIHZhbHVlOiBkLnZhbHVlc1tkLnZhbHVlcy5sZW5ndGggLSAxXX07IH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gXCJ0cmFuc2xhdGUoXCIgKyAoeFNjYWxlVGltZShwYXJzZURhdGUoZC52YWx1ZS5kYXRlKSktNTApICsgXCIsXCIgKyAoeVNjYWxlVGltZShkLnZhbHVlLnZhbHVlKS0xMCkgKyBcIilcIjsgfSlcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInhcIiwgMylcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIFwiLjM1ZW1cIilcclxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJmb250LXNpemVcIiwxMSlcclxuICAgICAgICAgICAgICAgICAgICAudGV4dChmdW5jdGlvbihkKSB7IHJldHVybiBkLm5hbWUgPT09ICd0b3RhbE1vbmV5JyA/IFwiTW9uZXkgUmVjb3ZlcmVkXCIgOiBcIk1vbmV5IE91dHN0YW5kaW5nXCI7IH0pO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdkYXRhJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuZGF0YSl7XHJcbiAgICAgICAgICAgICAgICAgICAgZHJhd0NoYXJ0KHNjb3BlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCB0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59KTtcclxuIiwiYW5ndWxhci5tb2R1bGUoJ2VockRhc2hib2FyZCcpXHJcbiAgICAuZmFjdG9yeShcIkNoYXJ0T3B0aW9uc1wiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGRlZmF1bHRzOiBbXHJcbiAgICAgICAgeyAncHJvcE5hbWUnOiAnbWFyZ2luJywgJ2RlZmF1bHRWYWx1ZSc6IHsgXCJ0b3BcIjogMCwgXCJsZWZ0XCI6IDAsIFwicmlnaHRcIjogMCwgXCJib3R0b21cIjogMCB9IH0sXHJcbiAgICAgICAgeyAncHJvcE5hbWUnOiAnY29sb3JTY2FsZScsICdkZWZhdWx0VmFsdWUnOiBkMy5zY2FsZS5jYXRlZ29yeTEwKCkgfSxcclxuICAgICAgICB7ICdwcm9wTmFtZSc6ICdkcmF3TGVnZW5kJywgJ2RlZmF1bHRWYWx1ZSc6IGZhbHNlIH0sXHJcbiAgICAgICAgeyAncHJvcE5hbWUnOiAnZHJhd1lBeGlzJywgJ2RlZmF1bHRWYWx1ZSc6IGZhbHNlIH0sXHJcbiAgICAgICAgeyAncHJvcE5hbWUnOiAndG9vbHRpcCcsICdkZWZhdWx0VmFsdWUnOiBmYWxzZSB9LFxyXG4gICAgICAgIHsgJ3Byb3BOYW1lJzogJ2RhdGVGb3JtYXQnLCAnZGVmYXVsdFZhbHVlJzogZDMudGltZS5mb3JtYXQoXCIlbS8lZC8lWVwiKSB9LFxyXG4gICAgICAgIHsgJ3Byb3BOYW1lJzogJ3RpY2tGb3JtYXQnLCAnZGVmYXVsdFZhbHVlJzogZDMudGltZS5tb250aCB9LFxyXG4gICAgICAgIHsgJ3Byb3BOYW1lJzogJ3RpY2tTcGFjaW5nJywgJ2RlZmF1bHRWYWx1ZSc6IDEgfSxcclxuICAgICAgICB7ICdwcm9wTmFtZSc6ICdkYXRlQXhpc0Zvcm1hdCcsICdkZWZhdWx0VmFsdWUnOiBkMy50aW1lLmZvcm1hdChcIiVtLSV5XCIpIH0sXHJcbiAgICAgICAgeyAncHJvcE5hbWUnOiAndGltZVVuaXQnLCAnZGVmYXVsdFZhbHVlJzogJ21vbnRoJyB9LFxyXG4gICAgICAgIHsgJ3Byb3BOYW1lJzogJ21pbicsICdkZWZhdWx0VmFsdWUnOiAnbWluJyB9LFxyXG4gICAgICAgIHsgJ3Byb3BOYW1lJzogJ21heCcsICdkZWZhdWx0VmFsdWUnOiAnbWF4JyB9LFxyXG4gICAgICAgIHsgJ3Byb3BOYW1lJzogJ3lTY2FsZUxhYmVsJywgJ2RlZmF1bHRWYWx1ZSc6ICcnIH0sXHJcbiAgICAgICAgeyAncHJvcE5hbWUnOiAndGl0bGUnLCAnZGVmYXVsdFZhbHVlJzogJycgfSxcclxuICAgICAgICB7ICdwcm9wTmFtZSc6ICdvbkNsaWNrJywgJ2RlZmF1bHRWYWx1ZSc6ICcnIH0sXHJcbiAgICAgICAgXSxcclxuICAgICAgICBnZW5lcmF0ZU9wdGlvbnM6IGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcbiAgICAgICAgICAgIHZhciBjb250cm9scyA9IG9wdGlvbnMgPyBvcHRpb25zIDoge307XHJcbiAgICAgICAgICAgIHRoaXMuZGVmYXVsdHMuZm9yRWFjaChmdW5jdGlvbiAoZCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFjb250cm9scy5oYXNPd25Qcm9wZXJ0eShkLnByb3BOYW1lKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xzW2QucHJvcE5hbWVdID0gZC5kZWZhdWx0VmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gY29udHJvbHM7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufSk7XHJcbiIsImFuZ3VsYXIubW9kdWxlKFwiZWhyRGFzaGJvYXJkXCIpXHJcbiAgICAuc2VydmljZShcIkNhbGN1bGF0ZVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5nZXRNZXRyaWNzID0gZnVuY3Rpb24gKHBhdGllbnQsIHByb3ZpZGVyKSB7XHJcbiAgICAgICAgICAgIHZhciBtZXRyaWMgPSB7fTtcclxuICAgICAgICAgICAgbWV0cmljLmFnZUF2ZXJhZ2UgPSBwYXRpZW50XHJcbiAgICAgICAgICAgICAgICAubWFwKGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLkFnZSB9KVxyXG4gICAgICAgICAgICAgICAgLnJlZHVjZShmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gYSArIGI7IH0pXHJcbiAgICAgICAgICAgICAgICAvIHBhdGllbnQubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgbWV0cmljLmNoYXRBdmVyYWdlID0gcGF0aWVudFxyXG4gICAgICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5jaGF0Q291bnQgfSlcclxuICAgICAgICAgICAgICAgIC5yZWR1Y2UoZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIGEgKyBiOyB9KVxyXG4gICAgICAgICAgICAgICAgLyBwYXRpZW50Lmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgIG1ldHJpYy5pbWFnZUF2ZXJhZ2UgPSBwYXRpZW50XHJcbiAgICAgICAgICAgICAgICAubWFwKGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmltYWdlQ291bnQgfSlcclxuICAgICAgICAgICAgICAgIC5yZWR1Y2UoZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIGEgKyBiOyB9KVxyXG4gICAgICAgICAgICAgICAgLyBwYXRpZW50Lmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgIG1ldHJpYy5wcm92aWRlckF2ZXJhZ2UgPSBwYXRpZW50XHJcbiAgICAgICAgICAgICAgICAubWFwKGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLnByb3ZpZGVyQ291bnQgfSlcclxuICAgICAgICAgICAgICAgIC5yZWR1Y2UoZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIGEgKyBiOyB9KVxyXG4gICAgICAgICAgICAgICAgLyBwYXRpZW50Lmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgIHZhciBncm91cERpYWcgPSBfLmdyb3VwQnkocGF0aWVudCwgXCJkaWFnbm9zaXNcIik7XHJcbiAgICAgICAgICAgIG1ldHJpYy50b3BEaWFnbm9zZXMgPSBfLm1hcChncm91cERpYWcsIGZ1bmN0aW9uIChkYXRhLCBrZXkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXA6IGtleSxcclxuICAgICAgICAgICAgICAgICAgICBudW1iZXI6IGRhdGEubGVuZ3RoXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHZhciBwcm9jRGlhZyA9IF8uZ3JvdXBCeShfLmZsYXR0ZW4ocGF0aWVudC5tYXAoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQucHJvY2VkdXJlcy5tYXAoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHguUHJvY2VkdXJlQ29kZS5Qcm9jZWR1cmU7IH0pIH0pKSk7XHJcbiAgICAgICAgICAgIG1ldHJpYy50b3BQcm9jZWR1cmVzID0gXy5tYXAocHJvY0RpYWcsIGZ1bmN0aW9uIChkYXRhLCBrZXkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXA6IGtleSxcclxuICAgICAgICAgICAgICAgICAgICBudW1iZXI6IGRhdGEubGVuZ3RoXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHZhciByb2xlR3JvdXAgPSBfLmdyb3VwQnkocHJvdmlkZXIubWFwKGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLlJvbGU7IH0pKTtcclxuICAgICAgICAgICAgbWV0cmljLnJvbGVDb3VudCA9IF8ubWFwKHJvbGVHcm91cCwgZnVuY3Rpb24gKGRhdGEsIGtleSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICBncm91cDoga2V5LFxyXG4gICAgICAgICAgICAgICAgICAgIG51bWJlcjogZGF0YS5sZW5ndGhcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdmFyIHN0YXR1c0dyb3VwID0gXy5ncm91cEJ5KHBhdGllbnQubWFwKGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLk1lZGljYWxTdGF0dXM7IH0pKTtcclxuICAgICAgICAgICAgbWV0cmljLnN0YXR1c0NvdW50ID0gXy5tYXAoc3RhdHVzR3JvdXAsIGZ1bmN0aW9uIChkYXRhLCBrZXkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXA6IGtleSxcclxuICAgICAgICAgICAgICAgICAgICBudW1iZXI6IGRhdGEubGVuZ3RoXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBtZXRyaWM7XHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsImFuZ3VsYXIubW9kdWxlKFwiZWhyRGFzaGJvYXJkXCIpXHJcbiAgICAuc2VydmljZShcIkRhdGFcIiwgZnVuY3Rpb24oJGh0dHApe1xyXG4gICAgICAgIHRoaXMuZ2V0RGF0YSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldChcImFwaS9EYXNoYm9hcmRcIilcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcbiIsImFuZ3VsYXIubW9kdWxlKFwiZWhyRGFzaGJvYXJkXCIpXHJcbiAgICAuY29udHJvbGxlcihcIkhvbWVDdHJsXCIsIGZ1bmN0aW9uKERhdGEsIENhbGN1bGF0ZSkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0uZGF0YSA9IHt9O1xyXG4gICAgICAgIHZtLmdyb3VwRGlhZyA9IFwiZ3JvdXBcIjtcclxuICAgICAgICB2bS51bml0ID0gXCJudW1iZXJcIjtcclxuICAgICAgICBEYXRhLmdldERhdGEoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHZtLmRhdGEgPSBkYXRhLmRhdGE7XHJcbiAgICAgICAgICAgIHZtLnByb2Nlc3NlZCA9IENhbGN1bGF0ZS5nZXRNZXRyaWNzKHZtLmRhdGEucGF0aWVudHMsIHZtLmRhdGEucHJvdmlkZXJzKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pOyAgIiwiYW5ndWxhci5tb2R1bGUoXCJlaHJEYXNoYm9hcmRcIilcclxuICAgIC5jb250cm9sbGVyKFwiTWFpbkN0cmxcIiwgZnVuY3Rpb24oRGF0YSwgQ2FsY3VsYXRlKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS5kYXRhID0ge307XHJcbiAgICAgICAgdm0uZ3JvdXBEaWFnID0gXCJncm91cFwiO1xyXG4gICAgICAgIHZtLnVuaXQgPSBcIm51bWJlclwiO1xyXG4gICAgICAgIERhdGEuZ2V0RGF0YSgpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YS5kYXRhKTtcclxuICAgICAgICAgICAgdm0uZGF0YSA9IGRhdGEuZGF0YTtcclxuICAgICAgICAgICAgdm0ucHJvY2Vzc2VkID0gQ2FsY3VsYXRlLmdldE1ldHJpY3Modm0uZGF0YS5wYXRpZW50cywgdm0uZGF0YS5wcm92aWRlcnMpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7ICAiLCJBcnJheS5wcm90b3R5cGUuZ3JvdXBCeUFuZFN1bSA9IGZ1bmN0aW9uIChncm91cEJ5LCB1bml0KSB7XHJcbiAgICB2YXIgZ3JvdXAgPSBfLmdyb3VwQnkodGhpcywgZ3JvdXBCeSk7XHJcbiAgICByZXR1cm4gXy5tYXAoZ3JvdXAsIGZ1bmN0aW9uIChnLCBrZXkpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBncm91cDoga2V5LFxyXG4gICAgICAgICAgICB1bml0OiBwbWRDYWxjSGVscGVycy5zdW0oZywgdW5pdClcclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcbn07XHJcblxyXG5BcnJheS5wcm90b3R5cGUuaW5jbHVkZUl0ZW1zID0gZnVuY3Rpb24gKGxpc3QsIGl0ZW0pIHtcclxuICAgIHJldHVybiBfLmZpbHRlcih0aGlzLCBmdW5jdGlvbiAoZCkge1xyXG4gICAgICAgIHJldHVybiBsaXN0LmluZGV4T2YoZFtpdGVtXSkgPiAtMTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxuQXJyYXkucHJvdG90eXBlLmZpbHRlclplcm8gPSBmdW5jdGlvbiAocHJvcGVydHkpIHtcclxuICAgIHJldHVybiBfLmZpbHRlcih0aGlzLCBmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgIHJldHVybiBpdGVtW3Byb3BlcnR5XSA+IDA7XHJcbiAgICB9KTtcclxufTtcclxuXHJcbkFycmF5LnByb3RvdHlwZS5zb3J0QnkgPSBmdW5jdGlvbiAocHJvcCkge1xyXG4gICAgcmV0dXJuIF8uc29ydEJ5KHRoaXMsIGZ1bmN0aW9uIChkKSB7IHJldHVybiAtZFtwcm9wXTsgfSk7XHJcbn07XHJcbiIsImFuZ3VsYXIubW9kdWxlKFwiZWhyRGFzaGJvYXJkXCIpXHJcbiAgICAuZGlyZWN0aXZlKFwiYmFyQ2hhcnRcIiwgZnVuY3Rpb24gKEJhck9wdGlvbnMpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgZGF0YTogJz0nLFxyXG4gICAgICAgICAgICAgICAgb3B0aW9uczogJz0nLFxyXG4gICAgICAgICAgICAgICAgZ3JvdXA6ICc9JyxcclxuICAgICAgICAgICAgICAgIHVuaXQ6ICc9JyxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY29uZmlnID0gQmFyT3B0aW9ucy5nZW5lcmF0ZU9wdGlvbnMoc2NvcGUub3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICBjb25maWcubWFyZ2luLmxlZnQgPSAyNTA7XHJcbiAgICAgICAgICAgICAgICB2YXIgdywgaDtcclxuICAgICAgICAgICAgICAgIHZhciB5ID0gc2NvcGUuZ3JvdXAgfHwgJ2dyb3VwJztcclxuICAgICAgICAgICAgICAgIHZhciB4ID0gc2NvcGUudW5pdCB8fCAndW5pdCc7XHJcbiAgICAgICAgICAgICAgICB2YXIgZHJhd24gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHZhciBiYXJUaXA7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3ZnO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBjcmVhdGVDaGFydCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB3ID0gY29uZmlnLndpZHRoID8gY29uZmlnLndpZHRoIDogZWxlbVswXS5vZmZzZXRXaWR0aDtcclxuICAgICAgICAgICAgICAgICAgICBoID0gY29uZmlnLmhlaWdodCA/IGNvbmZpZy5oZWlnaHQgOiBlbGVtWzBdLm9mZnNldEhlaWdodDtcclxuICAgICAgICAgICAgICAgICAgICBoID0gMTg1O1xyXG4gICAgICAgICAgICAgICAgICAgIHN2ZyA9IGQzLnNlbGVjdChlbGVtWzBdKS5hcHBlbmQoXCJzdmdcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCB3KS5hdHRyKFwiaGVpZ2h0XCIsIGgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzdmcuYXBwZW5kKFwidGV4dFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ0aXRsZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZHhcIiwgdyAvIDIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkeVwiLCAxMClcclxuICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgMTApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgIC50ZXh0KGNvbmZpZy5jaGFydFRpdGxlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc3ZnLmFwcGVuZChcImdcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImNoYXJ0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKFwiICsgY29uZmlnLm1hcmdpbi5sZWZ0ICsgXCIsXCIgKyBjb25maWcubWFyZ2luLnRvcCArIFwiKVwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc3ZnLnNlbGVjdChcImcuY2hhcnRcIikuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiYXhpc1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSgwLDUpXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnLnRvb2x0aXApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlVG9vbFRpcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlQ2hhcnQoc2NvcGUuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBjcmVhdGVUb29sVGlwID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGJhclRpcCA9IGQzLnRpcCgpLmF0dHIoJ2NsYXNzJywgJ2QzLXRpcCcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5vZmZzZXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFswLCAyXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmRpcmVjdGlvbignZScpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInRleHQtYWxpZ25cIiwgXCJjZW50ZXJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmh0bWwoZnVuY3Rpb24gKGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLnJvdW5kKGRbeF0gKiAxMDApIC8gMTAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBzdmcuY2FsbChiYXJUaXApO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgdXBkYXRlQ2hhcnQgPSBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc29ydChmdW5jdGlvbiAoYSwgYikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYVt5XSA8IGJbeV0gPyAxICA6IC0xO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgeVNjYWxlSGVpZ2h0ID0gTWF0aC5tYXgoaCAtIGNvbmZpZy5tYXJnaW4udG9wLCBkYXRhLmxlbmd0aCAqIDEzKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGggKiAxMyA+IGggLSBjb25maWcubWFyZ2luLnRvcCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdmcuYXR0cihcImhlaWdodFwiLCAoZGF0YS5sZW5ndGggKiAxMyArIGNvbmZpZy5tYXJnaW4udG9wKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3ZnLmF0dHIoXCJoZWlnaHRcIiwgaCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdChlbGVtWzBdKS5zdHlsZShcImhlaWdodFwiLCBoICsgXCJweFwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHhNYXggPSBjb25maWcubWF4WCB8fCBkMy5tYXgoZGF0YS5maWx0ZXIoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGRbeF0gIT09IEluZmluaXR5OyB9KSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGRbeF07IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB4U2NhbGUgPSBkMy5zY2FsZS5saW5lYXIoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZG9tYWluKFswLCB4TWF4XSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnJhbmdlKFswLCAodyAtIGNvbmZpZy5tYXJnaW4ucmlnaHQgLSBjb25maWcubWFyZ2luLmxlZnQpXSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciB5U2NhbGUgPSBkMy5zY2FsZS5vcmRpbmFsKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmRvbWFpbihkYXRhLm1hcChmdW5jdGlvbiAoZCkgeyByZXR1cm4gZFt5XTsgfSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yYW5nZUJhbmRzKFsxMCwgeVNjYWxlSGVpZ2h0IC0gY29uZmlnLm1hcmdpbi5ib3R0b21dLCAwLjA1KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJhckhlaWdodCA9IHlTY2FsZS5yYW5nZUJhbmQoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHhBeGlzID0gZDMuc3ZnLmF4aXMoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgIC5zY2FsZSh4U2NhbGUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgLm9yaWVudChcInRvcFwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZy50aWNrTnVtYmVycykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB4QXhpcy50aWNrcyg1KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHN2Zy5zZWxlY3QoXCJnLmF4aXNcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oKS5kdXJhdGlvbig1MDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYWxsKHhBeGlzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJhckNvbnRhaW5lciA9IHN2Zy5zZWxlY3QoXCJnLmNoYXJ0XCIpLnNlbGVjdEFsbChcImcuYmFyc1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZGF0YShkYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZFt5XTsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGJhckNvbnRhaW5lci5leGl0KClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oKS5kdXJhdGlvbig1MDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5kZWxheShmdW5jdGlvbiAoZCwgaSkgeyByZXR1cm4gaSAqIDIwOyB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSgwLFwiICsgKGggKyAyMDApICsgXCIpXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZW1vdmUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJhckVudGVyID0gYmFyQ29udGFpbmVyLmVudGVyKCkuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiYmFyc1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBmdW5jdGlvbiAoZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwidHJhbnNsYXRlKDAsXCIgKyB5U2NhbGUoZFt5XSkgKyBcIilcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAwKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYmFyRW50ZXIuYXBwZW5kKFwicmVjdFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiYmFyXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieVwiLCAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImZpbGxcIiwgZnVuY3Rpb24gKGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb25maWcuY29sb3JCeSA9PT0gJ25vbmUnID8gY29uZmlnLmNvbG9yIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcihkW2NvbmZpZy5jb2xvckJ5XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5vbihcIm1vdXNlb3ZlclwiLCBiYXJUaXAuc2hvdylcclxuICAgICAgICAgICAgICAgICAgICAgICAgLm9uKFwibW91c2VvdXRcIiwgYmFyVGlwLmhpZGUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBiYXJFbnRlci5hcHBlbmQoXCJ0ZXh0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJiYXItbGFiZWxcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcImVuZFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImZvbnQtc2l6ZVwiLCBcIjEyXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZHhcIiwgLTEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZHlcIiwgXCIuMzVlbVwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYmFyQ29udGFpbmVyLnNlbGVjdChcInJlY3RcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oKS5kdXJhdGlvbig1MDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgZnVuY3Rpb24gKGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkW3hdID09PSBJbmZpbml0eSA/IDAgOiB4U2NhbGUoZFt4XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGJhckhlaWdodCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGJhckNvbnRhaW5lci5zZWxlY3QoXCJ0ZXh0LmJhci1sYWJlbFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudHJhbnNpdGlvbigpLmR1cmF0aW9uKDUwMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIGJhckhlaWdodCAvIDIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uIChkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZFt5XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGJhckNvbnRhaW5lci50cmFuc2l0aW9uKCkuZHVyYXRpb24oMTAwMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAxKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gXCJ0cmFuc2xhdGUoMCxcIiArIHlTY2FsZShkW3ldKSArIFwiKVwiOyB9KTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdkYXRhJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5kYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZHJhd24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyBjcmVhdGVDaGFydCgpOyB9LCAyNTApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlQ2hhcnQoc2NvcGUuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZHJhd24gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sIHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxufSk7XHJcbiIsImFuZ3VsYXIubW9kdWxlKFwiZWhyRGFzaGJvYXJkXCIpXHJcbiAgICAuZmFjdG9yeShcIkJhck9wdGlvbnNcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGRlZmF1bHRzOiBbXHJcbiAgICAgICAgICAgIHsgJ3Byb3BOYW1lJzogJ21hcmdpbicsICdkZWZhdWx0VmFsdWUnOiB7IFwidG9wXCI6IDUwLCBcImxlZnRcIjogMTAwLCBcInJpZ2h0XCI6IDE1MCwgXCJib3R0b21cIjogNTAgfSB9LFxyXG4gICAgICAgICAgICB7ICdwcm9wTmFtZSc6ICdjaGFydFRpdGxlJywgJ2RlZmF1bHRWYWx1ZSc6IFwiXCJ9LFxyXG4gICAgICAgICAgICB7ICdwcm9wTmFtZSc6ICdjb2xvcicsICdkZWZhdWx0VmFsdWUnOiAnc3RlZWxibHVlJyB9LFxyXG4gICAgICAgICAgICB7ICdwcm9wTmFtZSc6ICdjb2xvckJ5JywgJ2RlZmF1bHRWYWx1ZSc6ICdub25lJyB9LFxyXG4gICAgICAgICAgICB7ICdwcm9wTmFtZSc6ICd0b29sdGlwJywgJ2RlZmF1bHRWYWx1ZSc6IHRydWUgfSxcclxuICAgICAgICAgICAgeyAncHJvcE5hbWUnOiAnZml0VG9IZWlnaHQnLCAnZGVmYXVsdFZhbHVlJzogdHJ1ZSB9LFxyXG4gICAgICAgICAgICB7ICdwcm9wTmFtZSc6ICd0aWNrTnVtYmVycycsICdkZWZhdWx0VmFsdWUnOiBudWxsIH0sXHJcbiAgICAgICAgICAgIHsgJ3Byb3BOYW1lJzogJ3dpZHRoJywgJ2RlZmF1bHRWYWx1ZSc6IG51bGwgfSxcclxuICAgICAgICAgICAgeyAncHJvcE5hbWUnOiAnaGVpZ2h0JywgJ2RlZmF1bHRWYWx1ZSc6IG51bGwgfSxcclxuICAgICAgICAgICAgeyAncHJvcE5hbWUnOiAnbWF4WCcsICdkZWZhdWx0VmFsdWUnOiBudWxsIH1cclxuICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgZ2VuZXJhdGVPcHRpb25zOiBmdW5jdGlvbiAob3B0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvbnRyb2xzID0gb3B0aW9ucyA/IG9wdGlvbnMgOiB7fTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGVmYXVsdHMuZm9yRWFjaChmdW5jdGlvbiAoZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghY29udHJvbHMuaGFzT3duUHJvcGVydHkoZC5wcm9wTmFtZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbHNbZC5wcm9wTmFtZV0gPSBkLmRlZmF1bHRWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb250cm9scztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbn0pO1xyXG4iLCJhbmd1bGFyLm1vZHVsZSgnZWhyRGFzaGJvYXJkJylcclxuICAgIC5kaXJlY3RpdmUoXCJncm91cEJhclwiLCBmdW5jdGlvbiAoJGxvY2F0aW9uKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgdGVtcGxhdGVOYW1lU3BhY2U6ICdzdmcnLFxyXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbSkge1xyXG4gICAgICAgICAgICB2YXIgY3JlYXRlQ2hhcnQgPSBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1hcmdpbiA9IHsgdG9wOiAxMCwgcmlnaHQ6IDIwLCBib3R0b206IDgwLCBsZWZ0OiA0MCB9O1xyXG4gICAgICAgICAgICAgICAgdmFyIHdpZHRoID0gZWxlbVswXS5vZmZzZXRXaWR0aCAtIG1hcmdpbi5yaWdodCAtIG1hcmdpbi5sZWZ0O1xyXG4gICAgICAgICAgICAgICAgdmFyIGhlaWdodCA9IGVsZW1bMF0ub2Zmc2V0SGVpZ2h0IC0gbWFyZ2luLnRvcCAtIG1hcmdpbi5ib3R0b207XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cod2lkdGgsIGhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgeDAgPSBkMy5zY2FsZS5vcmRpbmFsKClcclxuICAgICAgICAgICAgICAgICAgICAucmFuZ2VSb3VuZEJhbmRzKFswLCB3aWR0aF0sIDAuMSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHgxID0gZDMuc2NhbGUub3JkaW5hbCgpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB5ID0gZDMuc2NhbGUubGluZWFyKClcclxuICAgICAgICAgICAgICAgICAgICAucmFuZ2UoW2hlaWdodCwgMF0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBjb2xvciA9IGQzLnNjYWxlLm9yZGluYWwoKVxyXG4gICAgICAgICAgICAgICAgICAgIC5yYW5nZShbXCJyZWRcIiwgXCJibHVlXCIsIFwicHVycGxlXCJdKVxyXG4gICAgICAgICAgICAgICAgICAgIC5kb21haW4oW1wiT3ZlcmhlYWRcIiwgXCJCaWxsYWJsZVwiLCBcIlByb3Bvc2FsXCJdKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgeEF4aXMgPSBkMy5zdmcuYXhpcygpXHJcbiAgICAgICAgICAgICAgICAgICAgLnNjYWxlKHgwKVxyXG4gICAgICAgICAgICAgICAgICAgIC5vcmllbnQoXCJib3R0b21cIik7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHlBeGlzID0gZDMuc3ZnLmF4aXMoKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zY2FsZSh5KVxyXG4gICAgICAgICAgICAgICAgICAgIC5vcmllbnQoXCJsZWZ0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRpY2tGb3JtYXQoZDMuZm9ybWF0KFwiLjJzXCIpKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgc3ZnID0gZDMuc2VsZWN0KGVsZW1bMF0pLmFwcGVuZChcInN2Z1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgd2lkdGggKyBtYXJnaW4ubGVmdCArIG1hcmdpbi5yaWdodClcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCBoZWlnaHQgKyBtYXJnaW4udG9wICsgbWFyZ2luLmJvdHRvbSlcclxuICAgICAgICAgICAgICAgICAgLmFwcGVuZChcImdcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZShcIiArIG1hcmdpbi5sZWZ0ICsgXCIsXCIgKyBtYXJnaW4udG9wICsgXCIpXCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSBfLnVuaXEoXy5wbHVjayhkYXRhLCAnY2hhcmdlVHlwZScpKS5zb3J0KCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgZ3JvdXBCeVBlcnNvbiA9IF8uZ3JvdXBCeShkYXRhLCAnZW1wbG95ZWUnKTtcclxuICAgICAgICAgICAgICAgIHZhciBncm91cGVkRGF0YSA9IF8ubWFwKGdyb3VwQnlQZXJzb24sIGZ1bmN0aW9uIChkLCBrZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBrZXksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVtcElkOiBkWzBdLmVtcElkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBkXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHgwLmRvbWFpbihncm91cGVkRGF0YS5tYXAoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQubmFtZTsgfSkpO1xyXG4gICAgICAgICAgICAgICAgeDEuZG9tYWluKG9wdGlvbnMpLnJhbmdlUm91bmRCYW5kcyhbMCwgeDAucmFuZ2VCYW5kKCldKTtcclxuICAgICAgICAgICAgICAgIHkuZG9tYWluKFswLCBkMy5tYXgoZ3JvdXBlZERhdGEsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkMy5tYXgoZC5kYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5ob3VyczsgfSk7IH0pXSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc3ZnLmFwcGVuZChcImdcIilcclxuICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInggYXhpc1wiKVxyXG4gICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSgwLFwiICsgaGVpZ2h0ICsgXCIpXCIpXHJcbiAgICAgICAgICAgICAgICAgIC5jYWxsKHhBeGlzKTtcclxuXHJcbiAgICAgICAgICAgICAgICBzdmcuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ5IGF4aXNcIilcclxuICAgICAgICAgICAgICAgICAgICAuY2FsbCh5QXhpcylcclxuICAgICAgICAgICAgICAgICAgLmFwcGVuZChcInRleHRcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInJvdGF0ZSgtOTApXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIDYpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkeVwiLCBcIi43MWVtXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwidGV4dC1hbmNob3JcIiwgXCJlbmRcIilcclxuICAgICAgICAgICAgICAgICAgICAudGV4dChcIkhvdXJzXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBzdGF0ZSA9IHN2Zy5zZWxlY3RBbGwoXCIuc3RhdGVcIilcclxuICAgICAgICAgICAgICAgICAgICAuZGF0YShncm91cGVkRGF0YSlcclxuICAgICAgICAgICAgICAgICAgLmVudGVyKCkuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJnXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIFwidHJhbnNsYXRlKFwiICsgeDAoZC5uYW1lKSArIFwiLDApXCI7IH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZC5lbXBJZCwgZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aChcInRpbWVzaGVldC9cIiArIGQuZW1wSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBzdGF0ZS5zZWxlY3RBbGwoXCJyZWN0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmRhdGEoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuZGF0YTsgfSlcclxuICAgICAgICAgICAgICAgICAgLmVudGVyKCkuYXBwZW5kKFwicmVjdFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgeDEucmFuZ2VCYW5kKCkpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ4XCIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiB4MShkLmNoYXJnZVR5cGUpOyB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieVwiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4geShkLmhvdXJzKTsgfSlcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gaGVpZ2h0IC0geShkLmhvdXJzKTsgfSlcclxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBjb2xvcihkLmNoYXJnZVR5cGUpOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgbGVnZW5kID0gc3ZnLnNlbGVjdEFsbChcIi5sZWdlbmRcIilcclxuICAgICAgICAgICAgICAgICAgICAuZGF0YShvcHRpb25zLnNsaWNlKCkucmV2ZXJzZSgpKVxyXG4gICAgICAgICAgICAgICAgICAuZW50ZXIoKS5hcHBlbmQoXCJnXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImxlZ2VuZFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGZ1bmN0aW9uIChkLCBpKSB7IHJldHVybiBcInRyYW5zbGF0ZSgwLFwiICsgaSAqIDIwICsgXCIpXCI7IH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGxlZ2VuZC5hcHBlbmQoXCJyZWN0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ4XCIsIHdpZHRoIC0gMTgpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCAxOClcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCAxOClcclxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsIGNvbG9yKTtcclxuXHJcbiAgICAgICAgICAgICAgICBsZWdlbmQuYXBwZW5kKFwidGV4dFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieFwiLCB3aWR0aCAtIDI0KVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieVwiLCA5KVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZHlcIiwgXCIuMzVlbVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInRleHQtYW5jaG9yXCIsIFwiZW5kXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRleHQoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQ7IH0pO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdiaWxsaW5nRGF0YScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5iaWxsaW5nRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyBjcmVhdGVDaGFydChzY29wZS5iaWxsaW5nRGF0YSk7IH0sIDEwMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn0pO1xyXG4iLCJhbmd1bGFyLm1vZHVsZSgnZWhyRGFzaGJvYXJkJylcclxuICAgIC5kaXJlY3RpdmUoXCJzdGFja0JhckNoYXJ0XCIsIGZ1bmN0aW9uICgkdGltZW91dCwgQ2hhcnRPcHRpb25zKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIGRhdGE6ICc9JyxcclxuICAgICAgICAgICAgICAgIG9wdGlvbnM6ICc9JyxcclxuICAgICAgICAgICAgICAgIGRhdGU6ICc9JyxcclxuICAgICAgICAgICAgICAgIGdyb3VwOiAnPScsXHJcbiAgICAgICAgICAgICAgICB1bml0OiAnPSdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3RhY2tCYXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN2ZywgY2hhcnQsIHdpZHRoLCBoZWlnaHQsIHlBeGlzO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb25maWcgPSBDaGFydE9wdGlvbnMuZ2VuZXJhdGVPcHRpb25zKHNjb3BlLm9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb2xvciA9IGNvbmZpZy5jb2xvclNjYWxlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0b29sVGlwO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vdmFyIGZvcm1hdERhdGUgPSBjb25maWcuZGF0ZUZvcm1hdDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdW5pdCA9IHNjb3BlLnVuaXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGUgPSBzY29wZS5kYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBncm91cCA9IHNjb3BlLmdyb3VwO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdGFjayA9IGQzLmxheW91dC5zdGFjaygpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgLnZhbHVlcyhmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC52YWx1ZXM7IH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgLngoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQucmVhbERhdGU7IH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgLnkoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQudW5pdDsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBtYXJnaW4gPSBjb25maWcubWFyZ2luO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgZHJhd1lBeGlzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGFydC5hcHBlbmQoXCJnXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwieSBheGlzXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSg1MCwwKVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhbGwoeUF4aXMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZChcInRleHRcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwicm90YXRlKC05MClcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieVwiLCAtNDUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR4XCIsIC0oaGVpZ2h0IC0gMTAwKSAvIDIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIFwiLjcxZW1cIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGV4dChjb25maWcueVNjYWxlTGFiZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkcmF3TGVnZW5kID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9MZWdlbmRcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9ubHlWYWx1ZXMgPSBkYXRhLmZpbHRlcihmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC51bml0ICE9PSAwOyB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxlZ2VuZCA9IGNoYXJ0LnNlbGVjdEFsbChcIi5sZWdlbmRcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5kYXRhKF8udW5pcShfLnBsdWNrKG9ubHlWYWx1ZXMsICdncm91cCcpKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAuZW50ZXIoKS5hcHBlbmQoXCJnXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwibGVnZW5kXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBmdW5jdGlvbiAoZCwgaSkgeyByZXR1cm4gXCJ0cmFuc2xhdGUoMCxcIiArIGkgKiAyMCArIFwiKVwiOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZ2VuZC5hcHBlbmQoXCJyZWN0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInhcIiwgd2lkdGggLSA3MilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgMTgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCAxOClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcImZpbGxcIiwgY29sb3IpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgbGVnZW5kLmFwcGVuZChcInRleHRcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieFwiLCB3aWR0aCAtIDk2KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIDkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIFwiLjM1ZW1cIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInRleHQtYW5jaG9yXCIsIFwiZW5kXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGV4dChmdW5jdGlvbiAoZCkgeyByZXR1cm4gZDsgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNyZWF0ZVRvb2xUaXAgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xUaXAgPSBkMy50aXAoKS5hdHRyKCdjbGFzcycsICdkMy10aXAnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLm9mZnNldChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtjb25maWcudG9vbFRpcEFkanVzdFRvcCwgMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRpcmVjdGlvbignZScpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJ0ZXh0LWFsaWduXCIsIFwiY2VudGVyXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuaHRtbChmdW5jdGlvbiAoZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkLmdyb3VwICsgXCI8YnIgLz4gXCIgKyBkLnVuaXQgKyBcIiBcIiArIGNvbmZpZy50b29sVGlwVW5pdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdmcuY2FsbCh0b29sVGlwKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgY3JlYXRlQ2hhcnQgPSBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gZGF0YS5tYXAoZnVuY3Rpb24gKGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5pdDogZFt1bml0XSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlOiBkW2RhdGVdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwOiBkW2dyb3VwXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFsRGF0ZTogbmV3IG1vbWVudChkW2RhdGVdKS5fZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0ZXMgPSBfLnVuaXEoZGF0YS5tYXAoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuZGF0ZTsgfSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2F0ZWdvcmllcyA9IF8udW5pcShkYXRhLm1hcChmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5ncm91cDsgfSkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZXMuZm9yRWFjaChmdW5jdGlvbiAoZGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcmllcy5mb3JFYWNoKGZ1bmN0aW9uIChjYXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWF0Y2ggPSBfLmZpbmQoZGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuZGF0ZSA9PT0gZGF0ZSAmJiBkLmdyb3VwID09PSBjYXQ7IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbWF0Y2gpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGR1bW15ID0geyB1bml0OiAwLCBncm91cDogY2F0LCByZWFsRGF0ZTogbmV3IG1vbWVudChkYXRlKS5fZCwgZGF0ZTogZGF0ZSB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnB1c2goZHVtbXkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBfLnNvcnRCeShkYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5yZWFsRGF0ZTsgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBfLnNvcnRCeShkYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5ncm91cDsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZ3JvdXBzID0gZDMubmVzdCgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAua2V5KGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmdyb3VwOyB9KS5lbnRyaWVzKGRhdGEpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRheXMgPSBzdGFjayhncm91cHMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCA9IGVsZW1bMF0ub2Zmc2V0V2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodCA9IGNvbmZpZy5oZWlnaHQgPyBjb25maWcuaGVpZ2h0IDogZWxlbVswXS5vZmZzZXRIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjaGFydEhlaWdodCA9IGhlaWdodCAtIG1hcmdpbi5ib3R0b207XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdmcgPSBkMy5zZWxlY3QoZWxlbVswXSkuYXBwZW5kKFwic3ZnXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwic3ZnLWNoYXJ0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIHdpZHRoKS5hdHRyKFwiaGVpZ2h0XCIsIGhlaWdodCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGFydCA9IHN2Zy5hcHBlbmQoXCJnXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiY2hhcnRcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKDAsMClcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vbihcIm1vdXNlb3ZlclwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0KHRoaXMpLnNlbGVjdEFsbChcIi50by1zaG93XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50cmFuc2l0aW9uKCkuZHVyYXRpb24oNTAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vbihcIm1vdXNlb3V0XCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkMy5zZWxlY3QodGhpcykuc2VsZWN0QWxsKFwiLnRvLXNob3dcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oKS5kdXJhdGlvbig1MDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJ0LmFwcGVuZChcInRleHRcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ0aXRsZSB0by1zaG93XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR4XCIsIHdpZHRoIC8gMilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZHlcIiwgbWFyZ2luLnRvcCAtIDEwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIDEwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRleHQoY29uZmlnLnRpdGxlVGV4dClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgeFNjYWxlID0gZDMuc2NhbGUub3JkaW5hbCgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmFuZ2VSb3VuZEJhbmRzKFttYXJnaW4ubGVmdCwgd2lkdGggLSBtYXJnaW4ucmlnaHRdLCAwLjA4KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRvbWFpbihfLnVuaXEoZGF0YS5tYXAoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQucmVhbERhdGU7IH0pKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWluID0gdHlwZW9mIChjb25maWcubWluKSA9PT0gJ251bWJlcicgPyBjb25maWcubWluIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQzLm1pbihkYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC51bml0OyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b3RhbHMgPSBfLm1hcChfLmdyb3VwQnkoZGF0YSwgJ2RhdGUnKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChkYXRhKSB7IHJldHVybiBfLnJlZHVjZShkYXRhLCBmdW5jdGlvbiAobSwgeCkgeyByZXR1cm4gbSArIHgudW5pdDsgfSwgMCk7IH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1heCA9IHR5cGVvZiAoY29uZmlnLm1heCkgPT09ICdudW1iZXInID8gY29uZmlnLm1heCA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkMy5tYXgodG90YWxzLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZDsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgeVNjYWxlID0gZDMuc2NhbGUubGluZWFyKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yYW5nZShbY2hhcnRIZWlnaHQsIG1hcmdpbi50b3BdKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRvbWFpbihbbWluLCBtYXhdKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB4QXhpcyA9IGQzLnN2Zy5heGlzKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zY2FsZSh4U2NhbGUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGlja0Zvcm1hdChjb25maWcuZGF0ZUF4aXNGb3JtYXQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAub3JpZW50KFwiYm90dG9tXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgeUF4aXMgPSBkMy5zdmcuYXhpcygpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2NhbGUoeVNjYWxlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLm9yaWVudChcImxlZnRcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGFydC5hcHBlbmQoXCJnXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwieCBheGlzIHRvLXNob3dcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKDAsXCIgKyAoaGVpZ2h0IC0gbWFyZ2luLmJvdHRvbSAtIDUpICsgXCIpXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2FsbCh4QXhpcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBBZGQgYSBncm91cCBmb3IgZWFjaCBjYXVzZS5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJhckNvbnQgPSBjaGFydC5zZWxlY3RBbGwoXCJnLmRheVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRhdGEoZGF5cylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAuZW50ZXIoKS5hcHBlbmQoXCJzdmc6Z1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImRheVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwiZmlsbFwiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gY29sb3IoZC5rZXkpOyB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwic3Ryb2tlXCIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkMy5yZ2IoY29sb3IoZC5rZXkpKS5kYXJrZXIoKTsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBBZGQgYSByZWN0IGZvciBlYWNoIGRhdGUuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhckNvbnQuc2VsZWN0QWxsKFwicmVjdFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRhdGEoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQudmFsdWVzOyB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIC5lbnRlcigpLmFwcGVuZChcInN2ZzpyZWN0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInhcIiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIHhTY2FsZShkLnJlYWxEYXRlKTsgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieVwiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4geVNjYWxlKGQueSkgLSAoKGNoYXJ0SGVpZ2h0KSAtIHlTY2FsZShkLnkwKSk7IH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gKGNoYXJ0SGVpZ2h0KSAtIHlTY2FsZShkLnkpOyB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCB4U2NhbGUucmFuZ2VCYW5kKCkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAub24oJ21vdXNlb3ZlcicsIGZ1bmN0aW9uIChkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbFRpcC5zaG93KGQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vbignbW91c2VvdXQnLCBmdW5jdGlvbiAoZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xUaXAuaGlkZShkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlVG9vbFRpcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnLmRyYXdZQXhpcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJhd1lBeGlzKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25maWcuZHJhd0xlZ2VuZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJhd0xlZ2VuZChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnZGF0YScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLmRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyBjcmVhdGVDaGFydChzY29wZS5kYXRhKTsgfSwgMjUwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0sIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICR0aW1lb3V0KHN0YWNrQmFyLCAwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxuIiwiYW5ndWxhci5tb2R1bGUoXCJlaHJEYXNoYm9hcmRcIilcclxuICAgIC5kaXJlY3RpdmUoXCJ2QmFyQ2hhcnRcIiwgZnVuY3Rpb24gKEJhck9wdGlvbnMpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgZGF0YTogJz0nLFxyXG4gICAgICAgICAgICAgICAgb3B0aW9uczogJz0nLFxyXG4gICAgICAgICAgICAgICAgZ3JvdXA6ICc9JyxcclxuICAgICAgICAgICAgICAgIHVuaXQ6ICc9JyxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY29uZmlnID0gQmFyT3B0aW9ucy5nZW5lcmF0ZU9wdGlvbnMoc2NvcGUub3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdywgaDtcclxuICAgICAgICAgICAgICAgIHZhciB5ID0gc2NvcGUuZ3JvdXAgfHwgJ2dyb3VwJztcclxuICAgICAgICAgICAgICAgIHZhciB4ID0gc2NvcGUudW5pdCB8fCAndW5pdCc7XHJcbiAgICAgICAgICAgICAgICB2YXIgZHJhd24gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHZhciBiYXJUaXA7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3ZnO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBjcmVhdGVDaGFydCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB3ID0gY29uZmlnLndpZHRoID8gY29uZmlnLndpZHRoIDogZWxlbVswXS5vZmZzZXRXaWR0aDtcclxuICAgICAgICAgICAgICAgICAgICBoID0gY29uZmlnLmhlaWdodCA/IGNvbmZpZy5oZWlnaHQgOiBlbGVtWzBdLm9mZnNldEhlaWdodDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc3ZnID0gZDMuc2VsZWN0KGVsZW1bMF0pLmFwcGVuZChcInN2Z1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIHcpLmF0dHIoXCJoZWlnaHRcIiwgaCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHN2Zy5hcHBlbmQoXCJ0ZXh0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInRpdGxlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkeFwiLCB3IC8gMilcclxuICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIDEwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCAxMClcclxuICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgLnRleHQoY29uZmlnLmNoYXJ0VGl0bGUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzdmcuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiY2hhcnRcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoXCIgKyBjb25maWcubWFyZ2luLmxlZnQgKyBcIixcIiArIGNvbmZpZy5tYXJnaW4udG9wICsgXCIpXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzdmcuc2VsZWN0KFwiZy5jaGFydFwiKS5hcHBlbmQoXCJnXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ4LWF4aXNcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoMCw1KVwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZy50b29sdGlwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZVRvb2xUaXAoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZUNoYXJ0KHNjb3BlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgY3JlYXRlVG9vbFRpcCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBiYXJUaXAgPSBkMy50aXAoKS5hdHRyKCdjbGFzcycsICdkMy10aXAnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAub2Zmc2V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMCwgMl07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5kaXJlY3Rpb24oJ2UnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJ0ZXh0LWFsaWduXCIsIFwiY2VudGVyXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5odG1sKGZ1bmN0aW9uIChkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChkW3hdICogMTAwKSAvIDEwMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgc3ZnLmNhbGwoYmFyVGlwKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHVwZGF0ZUNoYXJ0ID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFbeV0gPCBiW3ldID8gMSA6IC0xO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgeVNjYWxlSGVpZ2h0ID0gTWF0aC5tYXgoaCAtIGNvbmZpZy5tYXJnaW4udG9wLCBkYXRhLmxlbmd0aCAqIDEzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEubGVuZ3RoICogMTMgPiBoIC0gY29uZmlnLm1hcmdpbi50b3ApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3ZnLmF0dHIoXCJoZWlnaHRcIiwgKGRhdGEubGVuZ3RoICogMTMgKyBjb25maWcubWFyZ2luLnRvcCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3ZnLmF0dHIoXCJoZWlnaHRcIiwgaCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdChlbGVtWzBdKS5zdHlsZShcImhlaWdodFwiLCBoICsgXCJweFwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHhNYXggPSBjb25maWcubWF4WCB8fCBkMy5tYXgoZGF0YS5maWx0ZXIoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGRbeF0gIT09IEluZmluaXR5OyB9KSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGRbeF07IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB4U2NhbGUgPSBkMy5zY2FsZS5saW5lYXIoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZG9tYWluKFswLCB4TWF4XSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnJhbmdlKFswLCAodyAtIGNvbmZpZy5tYXJnaW4ucmlnaHQgLSBjb25maWcubWFyZ2luLmxlZnQpXSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciB5U2NhbGUgPSBkMy5zY2FsZS5vcmRpbmFsKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmRvbWFpbihkYXRhLm1hcChmdW5jdGlvbiAoZCkgeyByZXR1cm4gZFt5XTsgfSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yYW5nZUJhbmRzKFsxMCwgeVNjYWxlSGVpZ2h0IC0gY29uZmlnLm1hcmdpbi5ib3R0b21dLCAwLjA1KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJhckhlaWdodCA9IHlTY2FsZS5yYW5nZUJhbmQoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHhBeGlzID0gZDMuc3ZnLmF4aXMoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgIC5zY2FsZSh4U2NhbGUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgLm9yaWVudChcInRvcFwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZy50aWNrTnVtYmVycykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB4QXhpcy50aWNrcyg1KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vc3ZnLnNlbGVjdChcImcueC1heGlzXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgLnRyYW5zaXRpb24oKS5kdXJhdGlvbig1MDApXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgLmNhbGwoeEF4aXMpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhLCB5LCB4KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJhckNvbnRhaW5lciA9IHN2Zy5zZWxlY3QoXCJnLmNoYXJ0XCIpLnNlbGVjdEFsbChcImcuYmFyc1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZGF0YShkYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZFt5XTsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGJhckNvbnRhaW5lci5leGl0KClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oKS5kdXJhdGlvbig1MDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5kZWxheShmdW5jdGlvbiAoZCwgaSkgeyByZXR1cm4gaSAqIDIwOyB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSgwLFwiICsgKGggKyAyMDApICsgXCIpXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZW1vdmUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJhckVudGVyID0gYmFyQ29udGFpbmVyLmVudGVyKCkuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiYmFyc1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBmdW5jdGlvbiAoZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwidHJhbnNsYXRlKDAsXCIgKyB5U2NhbGUoZFt5XSkgKyBcIilcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAwKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYmFyRW50ZXIuYXBwZW5kKFwicmVjdFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiYmFyXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieVwiLCAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImZpbGxcIiwgZnVuY3Rpb24gKGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb25maWcuY29sb3JCeSA9PT0gJ25vbmUnID8gY29uZmlnLmNvbG9yIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcihkW2NvbmZpZy5jb2xvckJ5XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5vbihcIm1vdXNlb3ZlclwiLCBiYXJUaXAuc2hvdylcclxuICAgICAgICAgICAgICAgICAgICAgICAgLm9uKFwibW91c2VvdXRcIiwgYmFyVGlwLmhpZGUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBiYXJFbnRlci5hcHBlbmQoXCJ0ZXh0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJiYXItbGFiZWxcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcImVuZFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImZvbnQtc2l6ZVwiLCBcIjEyXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZHhcIiwgLTEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZHlcIiwgXCIuMzVlbVwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYmFyQ29udGFpbmVyLnNlbGVjdChcInJlY3RcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oKS5kdXJhdGlvbig1MDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgZnVuY3Rpb24gKGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkW3hdID09PSBJbmZpbml0eSA/IDAgOiB4U2NhbGUoZFt4XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGJhckhlaWdodCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGJhckNvbnRhaW5lci5zZWxlY3QoXCJ0ZXh0LmJhci1sYWJlbFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudHJhbnNpdGlvbigpLmR1cmF0aW9uKDUwMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIGJhckhlaWdodCAvIDIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uIChkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZFt5XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGJhckNvbnRhaW5lci50cmFuc2l0aW9uKCkuZHVyYXRpb24oMTAwMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAxKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gXCJ0cmFuc2xhdGUoMCxcIiArIHlTY2FsZShkW3ldKSArIFwiKVwiOyB9KTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdkYXRhJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5kYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZHJhd24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyBjcmVhdGVDaGFydCgpOyB9LCAyNTApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlQ2hhcnQoc2NvcGUuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZHJhd24gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sIHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG4iLCJhbmd1bGFyLm1vZHVsZShcImVockRhc2hib2FyZFwiKVxyXG4uZGlyZWN0aXZlKFwiYm94V2hpc2tlclwiLCBmdW5jdGlvbigpe1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICByZXN0cmljdCA6ICdFJyxcclxuICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICBkYXRhOiAnPScsXHJcbiAgICAgICAgICAgIHByb3A6ICc9JyxcclxuICAgICAgICAgICAgZ3JvdXA6ICc9J1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdGVtcGxhdGU6ICcnLFxyXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtKSB7XHJcbiAgICAgICAgICAgIHZhciBkcmF3Q2hhcnQgPSBmdW5jdGlvbihkYXRhLHByb3AsZ3JvdXApIHtcclxuICAgICAgICAgICAgICAgIHZhciBkaXYgPSBlbGVtWzBdO1xyXG4gICAgICAgICAgICAgICAgdmFyIHdpZHRoID0gZGl2Lm9mZnNldFdpZHRoIC8gMyAtIDU7XHJcbiAgICAgICAgICAgICAgICB2YXIgaGVpZ2h0ID0gMzAwO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBtaW4gPSAtMTAsXHJcbiAgICAgICAgICAgICAgICAgICAgbWF4ID0gMTEwO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBjaGFydCA9IGQzLmJveCgpXHJcbiAgICAgICAgICAgICAgICAgICAgLndoaXNrZXJzKGlxcigxLjUpKVxyXG4gICAgICAgICAgICAgICAgICAgIC53aWR0aCh3aWR0aCAvIDMgLSAyNSlcclxuICAgICAgICAgICAgICAgICAgICAuaGVpZ2h0KGhlaWdodCAtIDE1KTtcclxuXHJcbiAgICAgICAgICAgICAgICBjaGFydC5kb21haW4oW21pbiwgbWF4XSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHN2ZyA9IGQzLnNlbGVjdChkaXYpLnNlbGVjdEFsbCgnc3ZnJylcclxuICAgICAgICAgICAgICAgICAgLmRhdGEoZGF0YSlcclxuICAgICAgICAgICAgICAgIC5lbnRlcigpLmFwcGVuZChcInN2Z1wiKVxyXG4gICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiYm94XCIpXHJcbiAgICAgICAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgd2lkdGgpXHJcbiAgICAgICAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGhlaWdodClcclxuICAgICAgICAgICAgICAgIC5hcHBlbmQoXCJnXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoMTAwLDEwKVwiKVxyXG4gICAgICAgICAgICAgICAgICAuY2FsbChjaGFydCk7XHJcblxyXG4gICAgICAgICAgICAgICAgc3ZnLmFwcGVuZChcInRleHRcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZShcIiArICh3aWR0aCAvIDMgLSAyNSkgLyAyICsgXCIsXCIgKyAoaGVpZ2h0IC0gMTUpICsgXCIpXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBcIjE2cHhcIilcclxuICAgICAgICAgICAgICAgICAgICAudGV4dChmdW5jdGlvbihkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkLmdyb3VwO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB2YXIgaXFyID0gZnVuY3Rpb24oaykge1xyXG4gICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihkLCBpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcTEgPSBkLnF1YXJ0aWxlc1swXSxcclxuICAgICAgICAgICAgICAgICAgICBxMyA9IGQucXVhcnRpbGVzWzJdLFxyXG4gICAgICAgICAgICAgICAgICAgIGlxciA9IChxMyAtIHExKSAqIGssXHJcbiAgICAgICAgICAgICAgICAgICAgaSA9IC0xLFxyXG4gICAgICAgICAgICAgICAgICAgIGogPSBkLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChkWysraV0gPCBxMSAtIGlxcik7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoZFstLWpdID4gcTMgKyBpcXIpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtpLCBqXTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnZGF0YScsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLmRhdGEpe1xyXG4gICAgICAgICAgICAgICAgICAgIGRyYXdDaGFydChzY29wZS5kYXRhLCBzY29wZS5wcm9wLCBzY29wZS5ncm91cCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pLCB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn0pO1xyXG4iLCIoZnVuY3Rpb24oKSB7XHJcblxyXG4vLyBJbnNwaXJlZCBieSBodHRwOi8vaW5mb3JtYXRpb25hbmR2aXN1YWxpemF0aW9uLmRlL2Jsb2cvYm94LXBsb3RcclxuZDMuYm94ID0gZnVuY3Rpb24oKSB7XHJcbiAgdmFyIHdpZHRoID0gMSxcclxuICAgICAgaGVpZ2h0ID0gMSxcclxuICAgICAgZHVyYXRpb24gPSAwLFxyXG4gICAgICBkb21haW4gPSBudWxsLFxyXG4gICAgICB2YWx1ZSA9IE51bWJlcixcclxuICAgICAgd2hpc2tlcnMgPSBib3hXaGlza2VycyxcclxuICAgICAgcXVhcnRpbGVzID0gYm94UXVhcnRpbGVzLFxyXG4gICAgICB0aWNrRm9ybWF0ID0gbnVsbDtcclxuXHJcbiAgLy8gRm9yIGVhY2ggc21hbGwgbXVsdGlwbGXigKZcclxuICBmdW5jdGlvbiBib3goZykge1xyXG4gICAgZy5lYWNoKGZ1bmN0aW9uKGQsIGkpIHtcclxuICAgICAgICAvLyBMTTogUmVwbGFjZWQgbWFwKHZhbHVlKSB3aXRoIHVuaXRcclxuICAgICAgZCA9IGQudW5pdC5zb3J0KGQzLmFzY2VuZGluZyk7XHJcbiAgICAgIHZhciBnID0gZDMuc2VsZWN0KHRoaXMpLFxyXG4gICAgICAgICAgbiA9IGQubGVuZ3RoLFxyXG4gICAgICAgICAgbWluID0gZFswXSxcclxuICAgICAgICAgIG1heCA9IGRbbiAtIDFdO1xyXG5cclxuICAgICAgLy8gQ29tcHV0ZSBxdWFydGlsZXMuIE11c3QgcmV0dXJuIGV4YWN0bHkgMyBlbGVtZW50cy5cclxuICAgICAgdmFyIHF1YXJ0aWxlRGF0YSA9IGQucXVhcnRpbGVzID0gcXVhcnRpbGVzKGQpO1xyXG5cclxuICAgICAgLy8gQ29tcHV0ZSB3aGlza2Vycy4gTXVzdCByZXR1cm4gZXhhY3RseSAyIGVsZW1lbnRzLCBvciBudWxsLlxyXG4gICAgICB2YXIgd2hpc2tlckluZGljZXMgPSB3aGlza2VycyAmJiB3aGlza2Vycy5jYWxsKHRoaXMsIGQsIGkpLFxyXG4gICAgICAgICAgd2hpc2tlckRhdGEgPSB3aGlza2VySW5kaWNlcyAmJiB3aGlza2VySW5kaWNlcy5tYXAoZnVuY3Rpb24oaSkgeyByZXR1cm4gZFtpXTsgfSk7XHJcblxyXG4gICAgICAvLyBDb21wdXRlIG91dGxpZXJzLiBJZiBubyB3aGlza2VycyBhcmUgc3BlY2lmaWVkLCBhbGwgZGF0YSBhcmUgXCJvdXRsaWVyc1wiLlxyXG4gICAgICAvLyBXZSBjb21wdXRlIHRoZSBvdXRsaWVycyBhcyBpbmRpY2VzLCBzbyB0aGF0IHdlIGNhbiBqb2luIGFjcm9zcyB0cmFuc2l0aW9ucyFcclxuICAgICAgdmFyIG91dGxpZXJJbmRpY2VzID0gd2hpc2tlckluZGljZXNcclxuICAgICAgICAgID8gZDMucmFuZ2UoMCwgd2hpc2tlckluZGljZXNbMF0pLmNvbmNhdChkMy5yYW5nZSh3aGlza2VySW5kaWNlc1sxXSArIDEsIG4pKVxyXG4gICAgICAgICAgOiBkMy5yYW5nZShuKTtcclxuXHJcbiAgICAgIC8vIENvbXB1dGUgdGhlIG5ldyB4LXNjYWxlLlxyXG4gICAgICB2YXIgeDEgPSBkMy5zY2FsZS5saW5lYXIoKVxyXG4gICAgICAgICAgLmRvbWFpbihkb21haW4gJiYgZG9tYWluLmNhbGwodGhpcywgZCwgaSkgfHwgW21pbiwgbWF4XSlcclxuICAgICAgICAgIC5yYW5nZShbaGVpZ2h0LCAwXSk7XHJcblxyXG4gICAgICAvLyBSZXRyaWV2ZSB0aGUgb2xkIHgtc2NhbGUsIGlmIHRoaXMgaXMgYW4gdXBkYXRlLlxyXG4gICAgICB2YXIgeDAgPSB0aGlzLl9fY2hhcnRfXyB8fCBkMy5zY2FsZS5saW5lYXIoKVxyXG4gICAgICAgICAgLmRvbWFpbihbMCwgSW5maW5pdHldKVxyXG4gICAgICAgICAgLnJhbmdlKHgxLnJhbmdlKCkpO1xyXG5cclxuICAgICAgLy8gU3Rhc2ggdGhlIG5ldyBzY2FsZS5cclxuICAgICAgdGhpcy5fX2NoYXJ0X18gPSB4MTtcclxuXHJcbiAgICAgIC8vIE5vdGU6IHRoZSBib3gsIG1lZGlhbiwgYW5kIGJveCB0aWNrIGVsZW1lbnRzIGFyZSBmaXhlZCBpbiBudW1iZXIsXHJcbiAgICAgIC8vIHNvIHdlIG9ubHkgaGF2ZSB0byBoYW5kbGUgZW50ZXIgYW5kIHVwZGF0ZS4gSW4gY29udHJhc3QsIHRoZSBvdXRsaWVyc1xyXG4gICAgICAvLyBhbmQgb3RoZXIgZWxlbWVudHMgYXJlIHZhcmlhYmxlLCBzbyB3ZSBuZWVkIHRvIGV4aXQgdGhlbSEgVmFyaWFibGVcclxuICAgICAgLy8gZWxlbWVudHMgYWxzbyBmYWRlIGluIGFuZCBvdXQuXHJcblxyXG4gICAgICAvLyBVcGRhdGUgY2VudGVyIGxpbmU6IHRoZSB2ZXJ0aWNhbCBsaW5lIHNwYW5uaW5nIHRoZSB3aGlza2Vycy5cclxuICAgICAgdmFyIGNlbnRlciA9IGcuc2VsZWN0QWxsKFwibGluZS5jZW50ZXJcIilcclxuICAgICAgICAgIC5kYXRhKHdoaXNrZXJEYXRhID8gW3doaXNrZXJEYXRhXSA6IFtdKTtcclxuXHJcbiAgICAgIGNlbnRlci5lbnRlcigpLmluc2VydChcImxpbmVcIiwgXCJyZWN0XCIpXHJcbiAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiY2VudGVyXCIpXHJcbiAgICAgICAgICAuYXR0cihcIngxXCIsIHdpZHRoIC8gMilcclxuICAgICAgICAgIC5hdHRyKFwieTFcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4geDAoZFswXSk7IH0pXHJcbiAgICAgICAgICAuYXR0cihcIngyXCIsIHdpZHRoIC8gMilcclxuICAgICAgICAgIC5hdHRyKFwieTJcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4geDAoZFsxXSk7IH0pXHJcbiAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDFlLTYpXHJcbiAgICAgICAgLnRyYW5zaXRpb24oKVxyXG4gICAgICAgICAgLmR1cmF0aW9uKGR1cmF0aW9uKVxyXG4gICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAxKVxyXG4gICAgICAgICAgLmF0dHIoXCJ5MVwiLCBmdW5jdGlvbihkKSB7IHJldHVybiB4MShkWzBdKTsgfSlcclxuICAgICAgICAgIC5hdHRyKFwieTJcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4geDEoZFsxXSk7IH0pO1xyXG5cclxuICAgICAgY2VudGVyLnRyYW5zaXRpb24oKVxyXG4gICAgICAgICAgLmR1cmF0aW9uKGR1cmF0aW9uKVxyXG4gICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAxKVxyXG4gICAgICAgICAgLmF0dHIoXCJ5MVwiLCBmdW5jdGlvbihkKSB7IHJldHVybiB4MShkWzBdKTsgfSlcclxuICAgICAgICAgIC5hdHRyKFwieTJcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4geDEoZFsxXSk7IH0pO1xyXG5cclxuICAgICAgY2VudGVyLmV4aXQoKS50cmFuc2l0aW9uKClcclxuICAgICAgICAgIC5kdXJhdGlvbihkdXJhdGlvbilcclxuICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMWUtNilcclxuICAgICAgICAgIC5hdHRyKFwieTFcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4geDEoZFswXSk7IH0pXHJcbiAgICAgICAgICAuYXR0cihcInkyXCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHgxKGRbMV0pOyB9KVxyXG4gICAgICAgICAgLnJlbW92ZSgpO1xyXG5cclxuICAgICAgLy8gVXBkYXRlIGlubmVycXVhcnRpbGUgYm94LlxyXG4gICAgICB2YXIgYm94ID0gZy5zZWxlY3RBbGwoXCJyZWN0LmJveFwiKVxyXG4gICAgICAgICAgLmRhdGEoW3F1YXJ0aWxlRGF0YV0pO1xyXG5cclxuICAgICAgYm94LmVudGVyKCkuYXBwZW5kKFwicmVjdFwiKVxyXG4gICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImJveFwiKVxyXG4gICAgICAgICAgLmF0dHIoXCJ4XCIsIDApXHJcbiAgICAgICAgICAuYXR0cihcInlcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4geDAoZFsyXSk7IH0pXHJcbiAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIHdpZHRoKVxyXG4gICAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4geDAoZFswXSkgLSB4MChkWzJdKTsgfSlcclxuICAgICAgICAudHJhbnNpdGlvbigpXHJcbiAgICAgICAgICAuZHVyYXRpb24oZHVyYXRpb24pXHJcbiAgICAgICAgICAuYXR0cihcInlcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4geDEoZFsyXSk7IH0pXHJcbiAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCBmdW5jdGlvbihkKSB7IHJldHVybiB4MShkWzBdKSAtIHgxKGRbMl0pOyB9KTtcclxuXHJcbiAgICAgIGJveC50cmFuc2l0aW9uKClcclxuICAgICAgICAgIC5kdXJhdGlvbihkdXJhdGlvbilcclxuICAgICAgICAgIC5hdHRyKFwieVwiLCBmdW5jdGlvbihkKSB7IHJldHVybiB4MShkWzJdKTsgfSlcclxuICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHgxKGRbMF0pIC0geDEoZFsyXSk7IH0pO1xyXG5cclxuICAgICAgLy8gVXBkYXRlIG1lZGlhbiBsaW5lLlxyXG4gICAgICB2YXIgbWVkaWFuTGluZSA9IGcuc2VsZWN0QWxsKFwibGluZS5tZWRpYW5cIilcclxuICAgICAgICAgIC5kYXRhKFtxdWFydGlsZURhdGFbMV1dKTtcclxuXHJcbiAgICAgIG1lZGlhbkxpbmUuZW50ZXIoKS5hcHBlbmQoXCJsaW5lXCIpXHJcbiAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwibWVkaWFuXCIpXHJcbiAgICAgICAgICAuYXR0cihcIngxXCIsIDApXHJcbiAgICAgICAgICAuYXR0cihcInkxXCIsIHgwKVxyXG4gICAgICAgICAgLmF0dHIoXCJ4MlwiLCB3aWR0aClcclxuICAgICAgICAgIC5hdHRyKFwieTJcIiwgeDApXHJcbiAgICAgICAgLnRyYW5zaXRpb24oKVxyXG4gICAgICAgICAgLmR1cmF0aW9uKGR1cmF0aW9uKVxyXG4gICAgICAgICAgLmF0dHIoXCJ5MVwiLCB4MSlcclxuICAgICAgICAgIC5hdHRyKFwieTJcIiwgeDEpO1xyXG5cclxuICAgICAgbWVkaWFuTGluZS50cmFuc2l0aW9uKClcclxuICAgICAgICAgIC5kdXJhdGlvbihkdXJhdGlvbilcclxuICAgICAgICAgIC5hdHRyKFwieTFcIiwgeDEpXHJcbiAgICAgICAgICAuYXR0cihcInkyXCIsIHgxKTtcclxuXHJcbiAgICAgIC8vIFVwZGF0ZSB3aGlza2Vycy5cclxuICAgICAgdmFyIHdoaXNrZXIgPSBnLnNlbGVjdEFsbChcImxpbmUud2hpc2tlclwiKVxyXG4gICAgICAgICAgLmRhdGEod2hpc2tlckRhdGEgfHwgW10pO1xyXG5cclxuICAgICAgd2hpc2tlci5lbnRlcigpLmluc2VydChcImxpbmVcIiwgXCJjaXJjbGUsIHRleHRcIilcclxuICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ3aGlza2VyXCIpXHJcbiAgICAgICAgICAuYXR0cihcIngxXCIsIDApXHJcbiAgICAgICAgICAuYXR0cihcInkxXCIsIHgwKVxyXG4gICAgICAgICAgLmF0dHIoXCJ4MlwiLCB3aWR0aClcclxuICAgICAgICAgIC5hdHRyKFwieTJcIiwgeDApXHJcbiAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDFlLTYpXHJcbiAgICAgICAgLnRyYW5zaXRpb24oKVxyXG4gICAgICAgICAgLmR1cmF0aW9uKGR1cmF0aW9uKVxyXG4gICAgICAgICAgLmF0dHIoXCJ5MVwiLCB4MSlcclxuICAgICAgICAgIC5hdHRyKFwieTJcIiwgeDEpXHJcbiAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDEpO1xyXG5cclxuICAgICAgd2hpc2tlci50cmFuc2l0aW9uKClcclxuICAgICAgICAgIC5kdXJhdGlvbihkdXJhdGlvbilcclxuICAgICAgICAgIC5hdHRyKFwieTFcIiwgeDEpXHJcbiAgICAgICAgICAuYXR0cihcInkyXCIsIHgxKVxyXG4gICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAxKTtcclxuXHJcbiAgICAgIHdoaXNrZXIuZXhpdCgpLnRyYW5zaXRpb24oKVxyXG4gICAgICAgICAgLmR1cmF0aW9uKGR1cmF0aW9uKVxyXG4gICAgICAgICAgLmF0dHIoXCJ5MVwiLCB4MSlcclxuICAgICAgICAgIC5hdHRyKFwieTJcIiwgeDEpXHJcbiAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDFlLTYpXHJcbiAgICAgICAgICAucmVtb3ZlKCk7XHJcblxyXG4gICAgICAvLyBVcGRhdGUgb3V0bGllcnMuXHJcbiAgICAgIHZhciBvdXRsaWVyID0gZy5zZWxlY3RBbGwoXCJjaXJjbGUub3V0bGllclwiKVxyXG4gICAgICAgICAgLmRhdGEob3V0bGllckluZGljZXMsIE51bWJlcik7XHJcblxyXG4gICAgICBvdXRsaWVyLmVudGVyKCkuaW5zZXJ0KFwiY2lyY2xlXCIsIFwidGV4dFwiKVxyXG4gICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcIm91dGxpZXJcIilcclxuICAgICAgICAgIC5hdHRyKFwiclwiLCA1KVxyXG4gICAgICAgICAgLmF0dHIoXCJjeFwiLCB3aWR0aCAvIDIpXHJcbiAgICAgICAgICAuYXR0cihcImN5XCIsIGZ1bmN0aW9uKGkpIHsgcmV0dXJuIHgwKGRbaV0pOyB9KVxyXG4gICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAxZS02KVxyXG4gICAgICAgIC50cmFuc2l0aW9uKClcclxuICAgICAgICAgIC5kdXJhdGlvbihkdXJhdGlvbilcclxuICAgICAgICAgIC5hdHRyKFwiY3lcIiwgZnVuY3Rpb24oaSkgeyByZXR1cm4geDEoZFtpXSk7IH0pXHJcbiAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDEpO1xyXG5cclxuICAgICAgb3V0bGllci50cmFuc2l0aW9uKClcclxuICAgICAgICAgIC5kdXJhdGlvbihkdXJhdGlvbilcclxuICAgICAgICAgIC5hdHRyKFwiY3lcIiwgZnVuY3Rpb24oaSkgeyByZXR1cm4geDEoZFtpXSk7IH0pXHJcbiAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDEpO1xyXG5cclxuICAgICAgb3V0bGllci5leGl0KCkudHJhbnNpdGlvbigpXHJcbiAgICAgICAgICAuZHVyYXRpb24oZHVyYXRpb24pXHJcbiAgICAgICAgICAuYXR0cihcImN5XCIsIGZ1bmN0aW9uKGkpIHsgcmV0dXJuIHgxKGRbaV0pOyB9KVxyXG4gICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAxZS02KVxyXG4gICAgICAgICAgLnJlbW92ZSgpO1xyXG5cclxuICAgICAgLy8gQ29tcHV0ZSB0aGUgdGljayBmb3JtYXQuXHJcbiAgICAgIHZhciBmb3JtYXQgPSB0aWNrRm9ybWF0IHx8IHgxLnRpY2tGb3JtYXQoOCk7XHJcblxyXG4gICAgICAvLyBVcGRhdGUgYm94IHRpY2tzLlxyXG4gICAgICB2YXIgYm94VGljayA9IGcuc2VsZWN0QWxsKFwidGV4dC5ib3hcIilcclxuICAgICAgICAgIC5kYXRhKHF1YXJ0aWxlRGF0YSk7XHJcblxyXG4gICAgICBib3hUaWNrLmVudGVyKCkuYXBwZW5kKFwidGV4dFwiKVxyXG4gICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImJveFwiKVxyXG4gICAgICAgICAgLmF0dHIoXCJkeVwiLCBcIi4zZW1cIilcclxuICAgICAgICAgIC5hdHRyKFwiZHhcIiwgZnVuY3Rpb24oZCwgaSkgeyByZXR1cm4gaSAmIDEgPyA2IDogLTYgfSlcclxuICAgICAgICAgIC5hdHRyKFwieFwiLCBmdW5jdGlvbihkLCBpKSB7IHJldHVybiBpICYgMSA/IHdpZHRoIDogMCB9KVxyXG4gICAgICAgICAgLmF0dHIoXCJ5XCIsIHgwKVxyXG4gICAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBmdW5jdGlvbihkLCBpKSB7IHJldHVybiBpICYgMSA/IFwic3RhcnRcIiA6IFwiZW5kXCI7IH0pXHJcbiAgICAgICAgICAudGV4dChmb3JtYXQpXHJcbiAgICAgICAgLnRyYW5zaXRpb24oKVxyXG4gICAgICAgICAgLmR1cmF0aW9uKGR1cmF0aW9uKVxyXG4gICAgICAgICAgLmF0dHIoXCJ5XCIsIHgxKTtcclxuXHJcbiAgICAgIGJveFRpY2sudHJhbnNpdGlvbigpXHJcbiAgICAgICAgICAuZHVyYXRpb24oZHVyYXRpb24pXHJcbiAgICAgICAgICAudGV4dChmb3JtYXQpXHJcbiAgICAgICAgICAuYXR0cihcInlcIiwgeDEpO1xyXG5cclxuICAgICAgLy8gVXBkYXRlIHdoaXNrZXIgdGlja3MuIFRoZXNlIGFyZSBoYW5kbGVkIHNlcGFyYXRlbHkgZnJvbSB0aGUgYm94XHJcbiAgICAgIC8vIHRpY2tzIGJlY2F1c2UgdGhleSBtYXkgb3IgbWF5IG5vdCBleGlzdCwgYW5kIHdlIHdhbnQgZG9uJ3Qgd2FudFxyXG4gICAgICAvLyB0byBqb2luIGJveCB0aWNrcyBwcmUtdHJhbnNpdGlvbiB3aXRoIHdoaXNrZXIgdGlja3MgcG9zdC0uXHJcbiAgICAgIHZhciB3aGlza2VyVGljayA9IGcuc2VsZWN0QWxsKFwidGV4dC53aGlza2VyXCIpXHJcbiAgICAgICAgICAuZGF0YSh3aGlza2VyRGF0YSB8fCBbXSk7XHJcblxyXG4gICAgICB3aGlza2VyVGljay5lbnRlcigpLmFwcGVuZChcInRleHRcIilcclxuICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ3aGlza2VyXCIpXHJcbiAgICAgICAgICAuYXR0cihcImR5XCIsIFwiLjNlbVwiKVxyXG4gICAgICAgICAgLmF0dHIoXCJkeFwiLCA2KVxyXG4gICAgICAgICAgLmF0dHIoXCJ4XCIsIHdpZHRoKVxyXG4gICAgICAgICAgLmF0dHIoXCJ5XCIsIHgwKVxyXG4gICAgICAgICAgLnRleHQoZm9ybWF0KVxyXG4gICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAxZS02KVxyXG4gICAgICAgIC50cmFuc2l0aW9uKClcclxuICAgICAgICAgIC5kdXJhdGlvbihkdXJhdGlvbilcclxuICAgICAgICAgIC5hdHRyKFwieVwiLCB4MSlcclxuICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMSk7XHJcblxyXG4gICAgICB3aGlza2VyVGljay50cmFuc2l0aW9uKClcclxuICAgICAgICAgIC5kdXJhdGlvbihkdXJhdGlvbilcclxuICAgICAgICAgIC50ZXh0KGZvcm1hdClcclxuICAgICAgICAgIC5hdHRyKFwieVwiLCB4MSlcclxuICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMSk7XHJcblxyXG4gICAgICB3aGlza2VyVGljay5leGl0KCkudHJhbnNpdGlvbigpXHJcbiAgICAgICAgICAuZHVyYXRpb24oZHVyYXRpb24pXHJcbiAgICAgICAgICAuYXR0cihcInlcIiwgeDEpXHJcbiAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDFlLTYpXHJcbiAgICAgICAgICAucmVtb3ZlKCk7XHJcbiAgICB9KTtcclxuICAgIGQzLnRpbWVyLmZsdXNoKCk7XHJcbiAgfVxyXG5cclxuICBib3gud2lkdGggPSBmdW5jdGlvbih4KSB7XHJcbiAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB3aWR0aDtcclxuICAgIHdpZHRoID0geDtcclxuICAgIHJldHVybiBib3g7XHJcbiAgfTtcclxuXHJcbiAgYm94LmhlaWdodCA9IGZ1bmN0aW9uKHgpIHtcclxuICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGhlaWdodDtcclxuICAgIGhlaWdodCA9IHg7XHJcbiAgICByZXR1cm4gYm94O1xyXG4gIH07XHJcblxyXG4gIGJveC50aWNrRm9ybWF0ID0gZnVuY3Rpb24oeCkge1xyXG4gICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gdGlja0Zvcm1hdDtcclxuICAgIHRpY2tGb3JtYXQgPSB4O1xyXG4gICAgcmV0dXJuIGJveDtcclxuICB9O1xyXG5cclxuICBib3guZHVyYXRpb24gPSBmdW5jdGlvbih4KSB7XHJcbiAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBkdXJhdGlvbjtcclxuICAgIGR1cmF0aW9uID0geDtcclxuICAgIHJldHVybiBib3g7XHJcbiAgfTtcclxuXHJcbiAgYm94LmRvbWFpbiA9IGZ1bmN0aW9uKHgpIHtcclxuICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGRvbWFpbjtcclxuICAgIGRvbWFpbiA9IHggPT0gbnVsbCA/IHggOiBkMy5mdW5jdG9yKHgpO1xyXG4gICAgcmV0dXJuIGJveDtcclxuICB9O1xyXG5cclxuICBib3gudmFsdWUgPSBmdW5jdGlvbih4KSB7XHJcbiAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB2YWx1ZTtcclxuICAgIHZhbHVlID0geDtcclxuICAgIHJldHVybiBib3g7XHJcbiAgfTtcclxuXHJcbiAgYm94LndoaXNrZXJzID0gZnVuY3Rpb24oeCkge1xyXG4gICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gd2hpc2tlcnM7XHJcbiAgICB3aGlza2VycyA9IHg7XHJcbiAgICByZXR1cm4gYm94O1xyXG4gIH07XHJcblxyXG4gIGJveC5xdWFydGlsZXMgPSBmdW5jdGlvbih4KSB7XHJcbiAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBxdWFydGlsZXM7XHJcbiAgICBxdWFydGlsZXMgPSB4O1xyXG4gICAgcmV0dXJuIGJveDtcclxuICB9O1xyXG5cclxuICByZXR1cm4gYm94O1xyXG59O1xyXG5cclxuZnVuY3Rpb24gYm94V2hpc2tlcnMoZCkge1xyXG4gIHJldHVybiBbMCwgZC5sZW5ndGggLSAxXTtcclxufVxyXG5cclxuZnVuY3Rpb24gYm94UXVhcnRpbGVzKGQpIHtcclxuICByZXR1cm4gW1xyXG4gICAgZDMucXVhbnRpbGUoZCwgLjI1KSxcclxuICAgIGQzLnF1YW50aWxlKGQsIC41KSxcclxuICAgIGQzLnF1YW50aWxlKGQsIC43NSlcclxuICBdO1xyXG59XHJcblxyXG59KSgpO1xyXG4iLCJhbmd1bGFyLm1vZHVsZSgnZWhyRGFzaGJvYXJkJylcclxuICAgIC5kaXJlY3RpdmUoXCJidWxsZXRDaGFydFwiLCBmdW5jdGlvbiAoJHRpbWVvdXQpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgZGF0YTogJz0nLFxyXG4gICAgICAgICAgICAgICAgb3V0ZXJQcm9wOiAnPScsXHJcbiAgICAgICAgICAgICAgICBpbm5lclByb3A6ICc9JyxcclxuICAgICAgICAgICAgICAgIGdyb3VwQnk6ICc9JyxcclxuICAgICAgICAgICAgICAgIGZpbHRlcjogJz0nXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGJ1bGxldENoYXJ0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGRpcmVjdGl2ZSB2YXJpYWJsZXNcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3ZnLCB5U2NhbGUsIGNoYXJ0LCB4U2NhbGU7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG91dGVyUHJvcCA9IFwic3RhZmZlZFwiO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpbm5lclByb3AgPSBcImNoYXJnZVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBncm91cCA9IFwicHJvamVjdFwiO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkcmF3biA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBtb250aHNCYWNrID0gMDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNldFRpdGxlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbXlEYXRlID0gbmV3IG1vbWVudCgpLnN1YnRyYWN0KFwibW9udGhcIiwgbW9udGhzQmFjaykuZm9ybWF0KCdNTU1NJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJ0LnNlbGVjdChcIi50aXRsZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRleHQobXlEYXRlICsgXCIgUHJvamVjdCBWYXJpYW5jZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgY3JlYXRlQ2hhcnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB1cCB0aGUgbGVmdCBzaWRlIG1hcmdpbjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1hcmdpbiA9IHsgdG9wOiAxNSwgcmlnaHQ6IDUwLCBib3R0b206IDIwLCBsZWZ0OiA0MCB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdyA9IGVsZW1bMF0ub2Zmc2V0V2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoID0gZWxlbVswXS5vZmZzZXRIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN2ZyA9IGQzLnNlbGVjdChlbGVtWzBdKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZChcInN2Z1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgaClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgdylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vbihcIm1vdXNlb3ZlclwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0KHRoaXMpLnNlbGVjdEFsbChcIi50by1zaG93XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudHJhbnNpdGlvbigpLmR1cmF0aW9uKDUwMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLm9uKFwibW91c2VvdXRcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdCh0aGlzKS5zZWxlY3RBbGwoXCIudG8tc2hvd1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudHJhbnNpdGlvbigpLmR1cmF0aW9uKDUwMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hhcnQgPSBzdmcuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoXCIgKyBtYXJnaW4ubGVmdCArIFwiLFwiICsgKDApICsgXCIpXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hhcnQuYXBwZW5kKFwidGV4dFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImJhY2t3YXJkIHRvLXNob3dcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZHhcIiwgLTEwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkeVwiLCBtYXJnaW4udG9wIC0gNSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCAxMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50ZXh0KCc8JylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcImN1cnNvclwiLCBcInBvaW50ZXJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vbihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5maWx0ZXIoJ2JhY2t3YXJkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9udGhzQmFjaysrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGFydC5hcHBlbmQoXCJ0ZXh0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJmb3J3YXJkIHRvLXNob3dcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkeFwiLCB3IC0gbWFyZ2luLnJpZ2h0IC0gNSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkeVwiLCBtYXJnaW4udG9wIC0gNSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIDEwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIC50ZXh0KCc+JylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwiY3Vyc29yXCIsIFwicG9pbnRlclwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5maWx0ZXIoJ2ZvcndhcmQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vbnRoc0JhY2stLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDApO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hhcnQuYXBwZW5kKFwidGV4dFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInRpdGxlIHRvLXNob3dcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZHhcIiwgKHcgLSBtYXJnaW4ucmlnaHQpIC8gMilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZHlcIiwgbWFyZ2luLnRvcCAtIDUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgMTApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDApO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHVwIHRoZSBzY2FsZXM6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHhTY2FsZSA9IGQzLnNjYWxlLmxpbmVhcigpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmFuZ2UoWzAsIHcgLSBtYXJnaW4ucmlnaHRdKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHlTY2FsZSA9IGQzLnNjYWxlLm9yZGluYWwoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJhbmdlQmFuZHMoW21hcmdpbi50b3AsIGggLSBtYXJnaW4uYm90dG9tXSwgMC4xKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vU2V0IHVwIGF4ZXM6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJ0LmFwcGVuZChcImdcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ4IGF4aXMgdG8tc2hvd1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoMCwgXCIgKyAoaCAtIG1hcmdpbi5ib3R0b20gLSA1KSArIFwiKVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZChcInRleHRcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBcIjhcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR4XCIsICh3IC0gbWFyZ2luLnJpZ2h0KSAvIDIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIDI1KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRleHQoXCJIb3Vyc1wiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZHJhd24gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVDaGFydChzY29wZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgdXBkYXRlQ2hhcnQgPSBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaXRsZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGFydC5zZWxlY3QoXCIuZm9yd2FyZFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwiZGlzcGxheVwiLCBmdW5jdGlvbiAoKSB7IHJldHVybiBtb250aHNCYWNrID49IDEgPyBcImJsb2NrXCIgOiBcIm5vbmVcIjsgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJ0LnNlbGVjdChcIi5iYWNrd2FyZFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwiZGlzcGxheVwiLCBmdW5jdGlvbiAoKSB7IHJldHVybiBtb250aHNCYWNrID49IDMgPyBcIm5vbmVcIiA6IFwiYmxvY2tcIjsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL1NldCB1cCB0aGUgU1ZHOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWF4WCA9IGQzLm1heChkYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gTWF0aC5tYXgoZFtpbm5lclByb3BdLCBkW291dGVyUHJvcF0pOyB9KSAqIDEuMTA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHhTY2FsZS5kb21haW4oWzAsIG1heFhdKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB4QXhpcyA9IGQzLnN2Zy5heGlzKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNjYWxlKHhTY2FsZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRpY2tzKDUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vcmllbnQoXCJib3R0b21cIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGFydC5zZWxlY3QoJy54JylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYWxsKHhBeGlzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHlTY2FsZS5kb21haW4oZGF0YS5tYXAoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGRbZ3JvdXBdOyB9KSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5uZXJCYXJIZWlnaHQgPSB5U2NhbGUucmFuZ2VCYW5kKCkgKiAwLjY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERhdGEgYmluZGluZzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJhcnNDb250ID0gY2hhcnQuc2VsZWN0QWxsKFwiZy5iYXJzXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZGF0YShkYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZFtncm91cF07IH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYmFyc0NvbnQudHJhbnNpdGlvbigpLmR1cmF0aW9uKDUwMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBcInRyYW5zbGF0ZSgwLCBcIiArIHlTY2FsZShkW2dyb3VwXSkgKyBcIilcIjsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBiYXJzQ29udC5zZWxlY3QoXCJyZWN0Lm91dGVyLWJhclwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgeVNjYWxlLnJhbmdlQmFuZCgpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oKS5kdXJhdGlvbig1MDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiB4U2NhbGUoZFtvdXRlclByb3BdKTsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBiYXJzQ29udC5zZWxlY3QoXCJyZWN0LmlubmVyLWJhclwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCBpbm5lckJhckhlaWdodClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ5XCIsICh5U2NhbGUucmFuZ2VCYW5kKCkgLSBpbm5lckJhckhlaWdodCkgLyAyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAudHJhbnNpdGlvbigpLmR1cmF0aW9uKDUwMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4geFNjYWxlKGRbaW5uZXJQcm9wXSk7IH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYmFyc0NvbnQuc2VsZWN0KFwidGV4dFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZHlcIiwgeVNjYWxlLnJhbmdlQmFuZCgpIC8gMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBjb250YWluZXIgcGVyIG9ic2VydmF0aW9uOjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJhckVudGVyID0gYmFyc0NvbnQuZW50ZXIoKS5hcHBlbmQoXCJnXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiYmFyc1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIFwidHJhbnNsYXRlKDAsIFwiICsgeVNjYWxlKGRbZ3JvdXBdKSArIFwiKVwiOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZCBPdXRlciBiYXJcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmFyRW50ZXIuYXBwZW5kKFwicmVjdFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcIm91dGVyLWJhclwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgeVNjYWxlLnJhbmdlQmFuZCgpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4geFNjYWxlKGRbb3V0ZXJQcm9wXSk7IH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImZpbGxcIiwgXCJibGFja1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAwLjMpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9BZGQgSW5uZXJCYXJcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmFyRW50ZXIuYXBwZW5kKFwicmVjdFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiaW5uZXItYmFyXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGlubmVyQmFySGVpZ2h0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInlcIiwgKHlTY2FsZS5yYW5nZUJhbmQoKSAtIGlubmVyQmFySGVpZ2h0KSAvIDIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIHhTY2FsZShkW2lubmVyUHJvcF0pOyB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImZpbGxcIiwgXCJzdGVlbGJsdWVcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAwLjgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIGdyb3VwIG5hbWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmFyRW50ZXIuYXBwZW5kKFwidGV4dFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcIm5hbWUtbW9udGhcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJlbmRcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZG9taW5hbnQtYmFzZWxpbmVcIiwgXCJjZW50cmFsXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImZvbnQtc2l6ZVwiLCBcIjEwXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR4XCIsIC0xKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkeVwiLCB5U2NhbGUucmFuZ2VCYW5kKCkgLyAyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRleHQoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGRbZ3JvdXBdOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhcnNDb250LmV4aXQoKS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goXCJkYXRhXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLmRhdGEgJiYgIWRyYXduKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVDaGFydChzY29wZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZUNoYXJ0KHNjb3BlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgJHRpbWVvdXQoYnVsbGV0Q2hhcnQsIDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG4iLCJhbmd1bGFyLm1vZHVsZShcImVockRhc2hib2FyZFwiKVxyXG4gICAgLmZhY3RvcnkoXCJMaW5lT3B0aW9uc1wiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZGVmYXVsdHM6IFtcclxuICAgICAgICAgICAgeyAncHJvcE5hbWUnOiAnbWFyZ2luJywgJ2RlZmF1bHRWYWx1ZSc6IHsgXCJ0b3BcIjogMCwgXCJsZWZ0XCI6IDAsIFwicmlnaHRcIjogMCwgXCJib3R0b21cIjogMCB9IH0sXHJcbiAgICAgICAgICAgIHsgJ3Byb3BOYW1lJzogJ2NvbG9yJywgJ2RlZmF1bHRWYWx1ZSc6ICdzdGVlbGJsdWUnIH0sXHJcbiAgICAgICAgICAgIHsgJ3Byb3BOYW1lJzogJ3hBeGlzRnJlcScsICdkZWZhdWx0VmFsdWUnOiAnJyB9LFxyXG4gICAgICAgICAgICB7ICdwcm9wTmFtZSc6ICd5TWF4JywgJ2RlZmF1bHRWYWx1ZSc6ICcnIH0sXHJcbiAgICAgICAgICAgIHsgJ3Byb3BOYW1lJzogJ2NvbG9yQnknLCAnZGVmYXVsdFZhbHVlJzogJ25vbmUnIH0sXHJcbiAgICAgICAgICAgIHsgJ3Byb3BOYW1lJzogJ3Rvb2x0aXAnLCAnZGVmYXVsdFZhbHVlJzogdHJ1ZSB9LFxyXG4gICAgICAgICAgICB7ICdwcm9wTmFtZSc6ICdmaXRUb0hlaWdodCcsICdkZWZhdWx0VmFsdWUnOiB0cnVlIH0sXHJcbiAgICAgICAgICAgIHsgJ3Byb3BOYW1lJzogJ3JhZGl1cycsICdkZWZhdWx0VmFsdWUnOiAzIH0sXHJcbiAgICAgICAgICAgIHsgJ3Byb3BOYW1lJzogJ3dpZHRoJywgJ2RlZmF1bHRWYWx1ZSc6IG51bGwgfSxcclxuICAgICAgICAgICAgeyAncHJvcE5hbWUnOiAnaGVpZ2h0JywgJ2RlZmF1bHRWYWx1ZSc6IG51bGwgfSxcclxuICAgICAgICAgICAgeydwcm9wTmFtZSc6ICd0aXRsZScsICdkZWZhdWx0VmFsdWUnOiAnJ31cclxuICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgZ2VuZXJhdGVPcHRpb25zOiBmdW5jdGlvbiAob3B0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvbnRyb2xzID0gb3B0aW9ucyA/IG9wdGlvbnMgOiB7fTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGVmYXVsdHMuZm9yRWFjaChmdW5jdGlvbiAoZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghY29udHJvbHMuaGFzT3duUHJvcGVydHkoZC5wcm9wTmFtZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbHNbZC5wcm9wTmFtZV0gPSBkLmRlZmF1bHRWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb250cm9scztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbn0pO1xyXG4iLCJhbmd1bGFyLm1vZHVsZSgnZWhyRGFzaGJvYXJkJylcclxuICAgIC5kaXJlY3RpdmUoXCJsaW5lQ2hhcnRcIiwgZnVuY3Rpb24gKENoYXJ0T3B0aW9ucykge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgIGRhdGE6ICc9JyxcclxuICAgICAgICAgICAgb3B0aW9uczogJz0nLFxyXG4gICAgICAgICAgICBkYXRlOiAnPScsXHJcbiAgICAgICAgICAgIGdyb3VwOiAnPScsXHJcbiAgICAgICAgICAgIHVuaXQ6ICc9J1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtKSB7XHJcbiAgICAgICAgICAgIHZhciBjb25maWcgPSBDaGFydE9wdGlvbnMuZ2VuZXJhdGVPcHRpb25zKHNjb3BlLm9wdGlvbnMpO1xyXG4gICAgICAgICAgICB2YXIgdywgaDtcclxuICAgICAgICAgICAgdmFyIHVuaXQgPSBzY29wZS51bml0O1xyXG4gICAgICAgICAgICB2YXIgZGF0ZSA9IHNjb3BlLmRhdGU7XHJcbiAgICAgICAgICAgIHZhciBncm91cCA9IHNjb3BlLmdyb3VwO1xyXG4gICAgICAgICAgICB2YXIgZHJhd24gPSBmYWxzZTtcclxuICAgICAgICAgICAgdmFyIGNvbG9yID0gY29uZmlnLmNvbG9yU2NhbGU7XHJcbiAgICAgICAgICAgIHZhciBsaW5lVGlwO1xyXG4gICAgICAgICAgICB2YXIgZm9ybWF0RGF0ZSA9IGQzLnRpbWUuZm9ybWF0KFwiJW0vJWQvJVlcIik7XHJcblxyXG4gICAgICAgICAgICB2YXIgY3JlYXRlQ2hhcnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB3ID0gZWxlbVswXS5vZmZzZXRXaWR0aDtcclxuICAgICAgICAgICAgICAgIGggPSBlbGVtWzBdLm9mZnNldEhlaWdodDtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHcsIGgpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBzdmcgPSBkMy5zZWxlY3QoZWxlbVswXSkuYXBwZW5kKFwic3ZnXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInN2Zy1jaGFydFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgdykuYXR0cihcImhlaWdodFwiLCBoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgY2hhcnQgPSBzdmcuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJjaGFydFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKDAsMClcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgY2hhcnQuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwieC1heGlzXCIpXHJcbiAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKDAsXCIgKyAoaCAtIDEwMCkgKyBcIilcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgY2hhcnQuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwieS1heGlzXCIpXHJcbiAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKDgwLDApXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZChcInRleHRcIilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInJvdGF0ZSgtOTApXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIC00MClcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR4XCIsIC0oaCAtIDEwMCkgLyAyKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZHlcIiwgXCIuNzFlbVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRleHQoY29uZmlnLnlTY2FsZUxhYmVsKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL2lmIChjb25maWcudG9vbHRpcCkge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgY3JlYXRlVG9vbFRpcCgpO1xyXG4gICAgICAgICAgICAgICAgLy99XHJcblxyXG4gICAgICAgICAgICAgICAgdXBkYXRlQ2hhcnQoc2NvcGUuZGF0YSk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAvL3ZhciBjcmVhdGVUb29sVGlwID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAvLyAgICBsaW5lVGlwID0gZDMudGlwKCkuYXR0cignY2xhc3MnLCAnZDMtdGlwJylcclxuICAgICAgICAgICAgLy8gICAgICAgIC5vZmZzZXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgIHJldHVybiBbMCwgMl1cclxuICAgICAgICAgICAgLy8gICAgICAgIH0pXHJcbiAgICAgICAgICAgIC8vICAgICAgICAuZGlyZWN0aW9uKCdlJylcclxuICAgICAgICAgICAgLy8gICAgICAgIC5zdHlsZShcInRleHQtYWxpZ25cIiwgXCJjZW50ZXJcIilcclxuICAgICAgICAgICAgLy8gICAgICAgIC5odG1sKGZ1bmN0aW9uIChkKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgcmV0dXJuIGRbeF07XHJcbiAgICAgICAgICAgIC8vICAgICAgICB9KTtcclxuICAgICAgICAgICAgLy8gICAgZDMuc2VsZWN0KFwic3ZnXCIpLmNhbGwobGluZVRpcCk7XHJcbiAgICAgICAgICAgIC8vfTtcclxuXHJcbiAgICAgICAgICAgIHZhciB1cGRhdGVDaGFydCA9IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2hhcnQgPSAgZDMuc2VsZWN0KFwic3ZnLnN2Zy1jaGFydFwiKS5zZWxlY3QoXCJnLmNoYXJ0XCIpO1xyXG4gICAgICAgICAgICAgICAgZGF0YSA9IGRhdGEubWFwKGZ1bmN0aW9uIChkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdW5pdDogZFt1bml0XSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZTogZFtkYXRlXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXA6IGRbZ3JvdXBdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWFsRGF0ZTogZm9ybWF0RGF0ZS5wYXJzZShkW2RhdGVdKVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBkYXRhID0gXy5zb3J0QnkoZGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuICtkLnJlYWxEYXRlOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL1NldCB1cCBTY2FsZXNcclxuICAgICAgICAgICAgICAgIHZhciBtaW5WYWwgPSAwO1xyXG4gICAgICAgICAgICAgICAgdmFyIG1heFZhbCA9IGQzLm1heChkYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC51bml0OyB9KTtcclxuICAgICAgICAgICAgICAgIC8vIGdpdmUgMTAlIGJ1ZmZlcnMgb24gYm90aCBzaWRlc1xyXG4gICAgICAgICAgICAgICAgbWF4VmFsID0gbWF4VmFsICsgKG1heFZhbCAqIDAuMDUpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHlTY2FsZSA9IGQzLnNjYWxlLmxpbmVhcigpXHJcbiAgICAgICAgICAgICAgICAgICAgLmRvbWFpbihbbWluVmFsLCBtYXhWYWxdKVxyXG4gICAgICAgICAgICAgICAgICAgIC5yYW5nZShbKGgtMTAwKSwgMF0pO1xyXG4gICAgICAgICAgICAgICAgdmFyIHhTY2FsZSA9IGQzLnRpbWUuc2NhbGUoKVxyXG4gICAgICAgICAgICAgICAgICAgIC5yYW5nZShbODAsIHcgLSA0MF0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmRvbWFpbihkMy5leHRlbnQoZGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQucmVhbERhdGU7IH0pKTtcclxuICAgICAgICAgICAgICAgIHZhciB4QXhpcyA9IGQzLnN2Zy5heGlzKClcclxuICAgICAgICAgICAgICAgICAgICAuc2NhbGUoeFNjYWxlKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aWNrRm9ybWF0KGQzLnRpbWUuZm9ybWF0KFwiJW0tJXlcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRpY2tQYWRkaW5nKDYpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRpY2tzKGQzLnRpbWUubW9udGgsIDEpXHJcbiAgICAgICAgICAgICAgICAgICAgLm9yaWVudChcImJvdHRvbVwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgeUF4aXMgPSBkMy5zdmcuYXhpcygpXHJcbiAgICAgICAgICAgICAgICAgICAgLnNjYWxlKHlTY2FsZSlcclxuICAgICAgICAgICAgICAgICAgICAub3JpZW50KFwibGVmdFwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL2NoYXJ0LmFwcGVuZChcImxpbmVcIilcclxuICAgICAgICAgICAgICAgIC8vICAgIC5hdHRyKFwieDFcIiwgeFNjYWxlKGQzLm1pbihkYXRhLCBmdW5jdGlvbihkKSB7IHJldHVybiBkLnJlYWxEYXRlOyB9KSkpXHJcbiAgICAgICAgICAgICAgICAvLyAgICAuYXR0cihcIngyXCIsIHhTY2FsZShkMy5tYXgoZGF0YSwgZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5yZWFsRGF0ZTsgfSkpKVxyXG4gICAgICAgICAgICAgICAgLy8gICAgLmF0dHIoXCJ5MVwiLCB5U2NhbGUoMTAwKSlcclxuICAgICAgICAgICAgICAgIC8vICAgIC5hdHRyKFwieTJcIiwgeVNjYWxlKDEwMCkpXHJcbiAgICAgICAgICAgICAgICAvLyAgICAuc3R5bGUoXCJzdHJva2VcIiwgXCJibGFja1wiKVxyXG4gICAgICAgICAgICAgICAgLy8gICAgLnN0eWxlKFwidHJva2Utd2lkdGhcIiwgMilcclxuICAgICAgICAgICAgICAgIC8vICAgIC5zdHlsZShcInN0cm9rZS1kYXNoYXJyYXlcIiwgKFwiMywgM1wiKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGdyb3VwcyA9IGQzLm5lc3QoKVxyXG4gICAgICAgICAgICAgICAgICAgIC5rZXkoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuZ3JvdXA7IH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmVudHJpZXMoZGF0YSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGxpbmUgPSBkMy5zdmcubGluZSgpXHJcblx0XHRcdFx0XHQuaW50ZXJwb2xhdGUoXCJsaW5lYXJcIilcclxuXHRcdFx0XHRcdC54KGZ1bmN0aW9uIChkKSB7IHJldHVybiB4U2NhbGUoZC5yZWFsRGF0ZSk7IH0pXHJcblx0XHRcdFx0XHQueShmdW5jdGlvbiAoZCkgeyByZXR1cm4geVNjYWxlKGQudW5pdCk7IH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICB2YXIgbGluZXMgPSBjaGFydC5zZWxlY3RBbGwoXCJwYXRoXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmRhdGEoZ3JvdXBzLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5rZXk7IH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGxpbmVzLnRyYW5zaXRpb24oKVxyXG4gICAgICAgICAgICAgICAgICAgIC5lYXNlKFwibGluZWFyXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmR1cmF0aW9uKDEwMDApXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkXCIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBsaW5lKGQudmFsdWVzKTsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgbGluZXMuZW50ZXIoKS5hcHBlbmQoXCJwYXRoXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImxpbmVcIilcclxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJzdHJva2VcIiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGNvbG9yKGQua2V5KTsgfSlcclxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsIFwibm9uZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZS13aWR0aFwiLCA1KVxyXG4gICAgICAgICAgICAgICAgICAgIC50cmFuc2l0aW9uKClcclxuICAgICAgICAgICAgICAgICAgICAuZWFzZShcImxpbmVhclwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5kdXJhdGlvbigxMDAwKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZFwiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gbGluZShkLnZhbHVlcyk7IH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vQXhlc1xyXG4gICAgICAgICAgICAgICAgZDMuc2VsZWN0KFwiZy54LWF4aXNcIikuY2FsbCh4QXhpcyk7XHJcbiAgICAgICAgICAgICAgICBkMy5zZWxlY3QoXCJnLnktYXhpc1wiKS5jYWxsKHlBeGlzKTtcclxuXHJcbiAgICAgICAgICAgICAgICBsaW5lcy5leGl0KCkucmVtb3ZlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9MZWdlbmRcclxuICAgICAgICAgICAgICAgIHZhciBsZWdlbmQgPSBjaGFydC5zZWxlY3RBbGwoXCIubGVnZW5kXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmRhdGEoXy51bmlxKF8ucGx1Y2soZGF0YSwgJ2dyb3VwJykpKVxyXG4gICAgICAgICAgICAgICAgICAuZW50ZXIoKS5hcHBlbmQoXCJnXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImxlZ2VuZFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGZ1bmN0aW9uIChkLCBpKSB7IHJldHVybiBcInRyYW5zbGF0ZSgwLFwiICsgaSAqIDIwICsgXCIpXCI7IH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGxlZ2VuZC5hcHBlbmQoXCJyZWN0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ4XCIsIHcgLSA3MilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIDE4KVxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIDE4KVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcImZpbGxcIiwgY29sb3IpO1xyXG5cclxuICAgICAgICAgICAgICAgIGxlZ2VuZC5hcHBlbmQoXCJ0ZXh0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ4XCIsIHcgLSA5NilcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInlcIiwgOSlcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIFwiLjM1ZW1cIilcclxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJ0ZXh0LWFuY2hvclwiLCBcImVuZFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uIChkKSB7IHJldHVybiBkOyB9KTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnZGF0YScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5kYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFkcmF3bikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgY3JlYXRlQ2hhcnQoKTsgfSwgMjUwKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVDaGFydChzY29wZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZHJhd24gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCB0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59KTtcclxuIiwiYW5ndWxhci5tb2R1bGUoXCJlaHJEYXNoYm9hcmRcIilcclxuICAgIC5kaXJlY3RpdmUoXCJzaW1wbGVMaW5lQ2hhcnRcIiwgZnVuY3Rpb24gKCR0aW1lb3V0LCBMaW5lT3B0aW9ucykge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgIGRhdGE6ICc9JyxcclxuICAgICAgICAgICAgb3B0aW9uczogJz0nLFxyXG4gICAgICAgICAgICBkYXRlOiAnPScsXHJcbiAgICAgICAgICAgIHVuaXQ6ICc9J1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtKSB7XHJcbiAgICAgICAgICAgIHZhciBsaW5lQ2hhcnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY29uZmlnID0gTGluZU9wdGlvbnMuZ2VuZXJhdGVPcHRpb25zKHNjb3BlLm9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHcsIGg7XHJcbiAgICAgICAgICAgICAgICB2YXIgdW5pdCA9IHNjb3BlLnVuaXQ7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGF0ZSA9IHNjb3BlLmRhdGU7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmFkaXVzID0gY29uZmlnLnJhZGl1cztcclxuICAgICAgICAgICAgICAgIHZhciBsaW5lVGlwLCBzdmcsIHhTY2FsZSwgeVNjYWxlO1xyXG4gICAgICAgICAgICAgICAgLy92YXIgZm9ybWF0TW9udGggPSBkMy50aW1lLmZvcm1hdChcIiVZLSVtLSVkXCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGZvcm1hdE1vbnRoTGFiZWwgPSBkMy50aW1lLmZvcm1hdChcIiViLSV5XCIpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBjcmVhdGVDaGFydCA9IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdyA9IGNvbmZpZy53aWR0aCA/IGNvbmZpZy53aWR0aCA6IGVsZW1bMF0ub2Zmc2V0V2lkdGggLSAyMDtcclxuICAgICAgICAgICAgICAgICAgICBoID0gY29uZmlnLmhlaWdodCA/IGNvbmZpZy5oZWlnaHQgOiBlbGVtWzBdLm9mZnNldEhlaWdodDtcclxuICAgICAgICAgICAgICAgICAgICBzdmcgPSBkMy5zZWxlY3QoZWxlbVswXSkuYXBwZW5kKFwic3ZnXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJzdmctc2ltcGxlLWxpbmVcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCB3KS5hdHRyKFwiaGVpZ2h0XCIsIGgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5vbihcIm1vdXNlb3ZlclwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkMy5zZWxlY3QodGhpcykuc2VsZWN0QWxsKFwiLnRvLXNob3dcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oKS5kdXJhdGlvbig1MDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5vbihcIm1vdXNlb3V0XCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdCh0aGlzKS5zZWxlY3RBbGwoXCIudG8tc2hvd1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50cmFuc2l0aW9uKCkuZHVyYXRpb24oNTAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgY2hhcnQgPSBzdmcuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiY2hhcnRcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoMCwwKVwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2hhcnQuYXBwZW5kKFwidGV4dFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwidGl0bGUgdG8tc2hvd1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR4XCIsIHcgLyAyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIDEwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgMTApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRleHQoY29uZmlnLnRpdGxlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDApO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjaGFydC5hcHBlbmQoXCJnXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ4LWF4aXMtdGltZSB0by1zaG93XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKDAsXCIgKyAoaCAtIDI1KSArIFwiKVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDApO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjaGFydC5hcHBlbmQoXCJnXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwieS1heGlzLXRpbWVcIilcclxuICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKDgwLDApXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnLnRvb2x0aXApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlVG9vbFRpcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGRhdGEubWFwKGZ1bmN0aW9uIChkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bml0OiBkW3VuaXRdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9kYXRlOiBkW2RhdGVdLnN1YnN0cmluZygwLCAxMCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFsRGF0ZTogZFtkYXRlXSAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICthLnJlYWxEYXRlIC0gYi5yZWFsRGF0ZTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHVwIHNjYWxlc1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBtaW5WYWwgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBtYXhWYWwgPSBkMy5tYXgoZGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQudW5pdDsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEdpdmUgMTAlIGJ1ZmZlcnMgb24gYm90aCBzaWRlc1xyXG4gICAgICAgICAgICAgICAgICAgIG1heFZhbCA9IG1heFZhbCArIChtYXhWYWwgKiAwLjA1KTtcclxuICAgICAgICAgICAgICAgICAgICB5U2NhbGUgPSBkMy5zY2FsZS5saW5lYXIoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZG9tYWluKFttaW5WYWwsIGNvbmZpZy55TWF4XSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnJhbmdlKFsoaCAtIDEwKSwgMTBdKTtcclxuICAgICAgICAgICAgICAgICAgICB4U2NhbGUgPSBkMy50aW1lLnNjYWxlKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnJhbmdlKFsxNSwgdy0yMF0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5kb21haW4oZDMuZXh0ZW50KGRhdGEsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLnJlYWxEYXRlOyB9KSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZUNoYXJ0KGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgY3JlYXRlTGluZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjaGFydCA9IHN2Zy5zZWxlY3QoXCJnLmNoYXJ0XCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjaGFydC5hcHBlbmQoXCJsaW5lXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieDFcIiwgMTUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieDJcIiwgdyAtIDIwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInkxXCIsIHlTY2FsZShjb25maWcuc3RyYWlnaHRMaW5lKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ5MlwiLCB5U2NhbGUoY29uZmlnLnN0cmFpZ2h0TGluZSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZVwiLCBcImJsYWNrXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMC40KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2hhcnQuYXBwZW5kKFwidGV4dFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwidG8tc2hvd1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR4XCIsICh3IC0gMjApKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIHlTY2FsZShjb25maWcuc3RyYWlnaHRMaW5lKSArIDIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZm9udC1zaXplXCIsIDgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRleHQoY29uZmlnLnN0cmFpZ2h0TGluZSArIFwiJVwiKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGNyZWF0ZVRvb2xUaXAgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGluZVRpcCA9IGQzLnRpcCgpLmF0dHIoJ2NsYXNzJywgJ2QzLXRpcCcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5vZmZzZXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFstOCwgMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5kaXJlY3Rpb24oJ24nKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJ0ZXh0LWFsaWduXCIsIFwiY2VudGVyXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5odG1sKGZ1bmN0aW9uIChkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChkLnVuaXQgKiAxMDApIC8gMTAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBzdmcuY2FsbChsaW5lVGlwKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHVwZGF0ZUNoYXJ0ID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBjcmVhdGVMaW5lKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNoYXJ0ID0gc3ZnLnNlbGVjdChcImcuY2hhcnRcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciB4QXhpcyA9IGQzLnN2Zy5heGlzKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnNjYWxlKHhTY2FsZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRpY2tGb3JtYXQoZm9ybWF0TW9udGhMYWJlbClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRpY2tQYWRkaW5nKDYpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aWNrcyhkMy50aW1lLm1vbnRoLCBjb25maWcueEF4aXNGcmVxKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAub3JpZW50KFwiYm90dG9tXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgeUF4aXMgPSBkMy5zdmcuYXhpcygpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zY2FsZSh5U2NhbGUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aWNrcyg2KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAub3JpZW50KFwibGVmdFwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxpbmUgPSBkMy5zdmcubGluZSgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC54KGZ1bmN0aW9uIChkKSB7IHJldHVybiB4U2NhbGUoZC5yZWFsRGF0ZSk7IH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC55KGZ1bmN0aW9uIChkKSB7IHJldHVybiB5U2NhbGUoZC51bml0KTsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNoYXJ0LmFwcGVuZChcInBhdGhcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmRhdHVtKGRhdGEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJsaW5lc1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJzdHJva2VcIiwgY29uZmlnLmNvbG9yKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudHJhbnNpdGlvbigpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5lYXNlKFwibGluZWFyXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5kdXJhdGlvbigxMDAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImRcIiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGxpbmUoZCk7IH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBBeGVzXHJcbiAgICAgICAgICAgICAgICAgICAgc3ZnLnNlbGVjdChcImcueC1heGlzLXRpbWVcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhbGwoeEF4aXMpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLy8vIEF4ZXNcclxuICAgICAgICAgICAgICAgICAgICAvL2QzLnNlbGVjdChcImcueS1heGlzLXRpbWVcIilcclxuICAgICAgICAgICAgICAgICAgICAvLyAgICAuY2FsbCh5QXhpcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vQ2lyY2xlc1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjaXJjbGVzID0gY2hhcnQuc2VsZWN0QWxsKFwiY2lyY2xlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5kYXRhKGRhdGEpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjaXJjbGVzLmVudGVyKCkuYXBwZW5kKFwiY2lyY2xlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcImZpbGxcIiwgY29uZmlnLmNvbG9yKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInJcIiwgcmFkaXVzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAub24oJ21vdXNlb3ZlcicsIGZ1bmN0aW9uIChkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkMy5zZWxlY3QodGhpcykudHJhbnNpdGlvbigpLmR1cmF0aW9uKDUwMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInJcIiwgKHJhZGl1cyArIChyYWRpdXMgKiAwLjkpKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lVGlwLnNob3coZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5vbignbW91c2VvdXQnLCBmdW5jdGlvbiAoZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0KHRoaXMpLnRyYW5zaXRpb24oKS5kdXJhdGlvbig1MDApLmF0dHIoXCJyXCIsIHJhZGl1cyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lVGlwLmhpZGUoZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjaXJjbGVzLnRyYW5zaXRpb24oKS5kdXJhdGlvbigxMDAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZWFzZShcImJvdW5jZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImN4XCIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiB4U2NhbGUoZC5yZWFsRGF0ZSk7IH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiY3lcIiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIHlTY2FsZShkLnVuaXQpOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2lyY2xlcy5leGl0KCkucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnZGF0YScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVDaGFydChzY29wZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCB0cnVlKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgJHRpbWVvdXQobGluZUNoYXJ0LCAwKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59KTtcclxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
